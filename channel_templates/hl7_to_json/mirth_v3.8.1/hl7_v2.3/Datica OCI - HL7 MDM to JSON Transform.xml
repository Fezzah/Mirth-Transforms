<channel version="3.8.1">
  <id>6a27e181-4776-46d7-b862-5cc4968ec8e7</id>
  <nextMetaDataId>2</nextMetaDataId>
  <name>Datica OCI - HL7 MDM to JSON Transform</name>
  <description>Transform MDM HL7 to JSON</description>
  <revision>37</revision>
  <sourceConnector version="3.8.1">
    <metaDataId>0</metaDataId>
    <name>sourceConnector</name>
    <properties class="com.mirth.connect.connectors.vm.VmReceiverProperties" version="3.8.1">
      <pluginProperties/>
      <sourceConnectorProperties version="3.8.1">
        <responseVariable>None</responseVariable>
        <respondAfterProcessing>true</respondAfterProcessing>
        <processBatch>false</processBatch>
        <firstResponse>false</firstResponse>
        <processingThreads>1</processingThreads>
        <resourceIds class="linked-hash-map">
          <entry>
            <string>Default Resource</string>
            <string>[Default Resource]</string>
          </entry>
        </resourceIds>
        <queueBufferSize>1000</queueBufferSize>
      </sourceConnectorProperties>
    </properties>
    <transformer version="3.8.1">
      <elements>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.8.1">
          <name>Create the JSON wrapper</name>
          <sequenceNumber>0</sequenceNumber>
          <enabled>true</enabled>
          <script>// Wrapper for the JSON object that we&apos;ll construct
var hl7JSON = {
	&quot;message_type&quot; : &quot;MDM&quot;,
	&quot;content&quot; : {}
};

// Save the wrapper in a channelMap variable for later usage
channelMap.put(&quot;hl7JSON&quot;, JSON.stringify(hl7JSON));</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.8.1">
          <name>MSH (Message Header) Segment</name>
          <sequenceNumber>1</sequenceNumber>
          <enabled>true</enabled>
          <script>// MSH
var msh = {};

// MSH.1, fieldSeparator
if (msg[&apos;MSH&apos;][&apos;MSH.1&apos;][&apos;MSH.1.1&apos;].toString() != &quot;&quot;) {msh.fieldSeparator = msg[&apos;MSH&apos;][&apos;MSH.1&apos;][&apos;MSH.1.1&apos;].toString(); }

// MSH.2, encodingCharacters
if (msg[&apos;MSH&apos;][&apos;MSH.2&apos;][&apos;MSH.2.1&apos;].toString() != &quot;&quot;) {msh.fieldSeparator = msg[&apos;MSH&apos;][&apos;MSH.2&apos;][&apos;MSH.2.1&apos;].toString(); }

// MSH.3, sendingApplication
msh.sendingApplication = {};
if (msg[&apos;MSH&apos;][&apos;MSH.3&apos;][&apos;MSH.3.1&apos;].toString() != &quot;&quot;) {msh.sendingApplication.namespaceId = msg[&apos;MSH&apos;][&apos;MSH.3&apos;][&apos;MSH.3.1&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.3&apos;][&apos;MSH.3.2&apos;].toString() != &quot;&quot;) {msh.sendingApplication.universalId = msg[&apos;MSH&apos;][&apos;MSH.3&apos;][&apos;MSH.3.2&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.3&apos;][&apos;MSH.3.3&apos;].toString() != &quot;&quot;) {msh.sendingApplication.universalIdType = msg[&apos;MSH&apos;][&apos;MSH.3&apos;][&apos;MSH.3.3&apos;].toString(); }
if (Object.keys(msh.sendingApplication).length == 0) {
	delete msh.sendingApplication;
}

// MSH.4, sendingFacility
msh.sendingFacility = {};
if (msg[&apos;MSH&apos;][&apos;MSH.4&apos;][&apos;MSH.4.1&apos;].toString() != &quot;&quot;) {msh.sendingFacility.namespaceId = msg[&apos;MSH&apos;][&apos;MSH.4&apos;][&apos;MSH.4.1&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.4&apos;][&apos;MSH.4.2&apos;].toString() != &quot;&quot;) {msh.sendingFacility.universalId = msg[&apos;MSH&apos;][&apos;MSH.4&apos;][&apos;MSH.4.2&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.4&apos;][&apos;MSH.4.3&apos;].toString() != &quot;&quot;) {msh.sendingFacility.universalIdType = msg[&apos;MSH&apos;][&apos;MSH.4&apos;][&apos;MSH.4.3&apos;].toString(); }
if (Object.keys(msh.sendingFacility).length == 0) {
	delete msh.sendingFacility;
}

// MSH.5, receivingApplication
msh.receivingApplication = {};
if (msg[&apos;MSH&apos;][&apos;MSH.5&apos;][&apos;MSH.5.1&apos;].toString() != &quot;&quot;) {msh.receivingApplication.namespaceId = msg[&apos;MSH&apos;][&apos;MSH.5&apos;][&apos;MSH.5.1&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.5&apos;][&apos;MSH.5.2&apos;].toString() != &quot;&quot;) {msh.receivingApplication.universalId = msg[&apos;MSH&apos;][&apos;MSH.5&apos;][&apos;MSH.5.2&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.5&apos;][&apos;MSH.5.3&apos;].toString() != &quot;&quot;) {msh.receivingApplication.universalIdType = msg[&apos;MSH&apos;][&apos;MSH.5&apos;][&apos;MSH.5.3&apos;].toString(); }
if (Object.keys(msh.receivingApplication).length == 0) {
	delete msh.receivingApplication;
}

// MSH.6, receivingFacility
msh.receivingFacility = {};
if (msg[&apos;MSH&apos;][&apos;MSH.6&apos;][&apos;MSH.6.1&apos;].toString() != &quot;&quot;) {msh.receivingFacility.namespaceId = msg[&apos;MSH&apos;][&apos;MSH.6&apos;][&apos;MSH.6.1&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.6&apos;][&apos;MSH.6.2&apos;].toString() != &quot;&quot;) {msh.receivingFacility.universalId = msg[&apos;MSH&apos;][&apos;MSH.6&apos;][&apos;MSH.6.2&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.6&apos;][&apos;MSH.6.3&apos;].toString() != &quot;&quot;) {msh.receivingFacility.universalIdType = msg[&apos;MSH&apos;][&apos;MSH.6&apos;][&apos;MSH.6.3&apos;].toString(); }
if (Object.keys(msh.receivingFacility).length == 0) {
	delete msh.receivingFacility;
}

// MSH.7, dateTimeOfMessage
if (msg[&apos;MSH&apos;][&apos;MSH.7&apos;][&apos;MSH.7.1&apos;].toString() != &quot;&quot;) {msh.dateTimeOfMessage = msg[&apos;MSH&apos;][&apos;MSH.7&apos;][&apos;MSH.7.1&apos;].toString(); }

// MSH.8, security
if (msg[&apos;MSH&apos;][&apos;MSH.8&apos;][&apos;MSH.8.1&apos;].toString() != &quot;&quot;) {msh.security = msg[&apos;MSH&apos;][&apos;MSH.8&apos;][&apos;MSH.8.1&apos;].toString(); }

// MSH.9, messageType
msh.messageType = {};
if (msg[&apos;MSH&apos;][&apos;MSH.9&apos;][&apos;MSH.9.1&apos;].toString() != &quot;&quot;) {msh.messageType.messageType = msg[&apos;MSH&apos;][&apos;MSH.9&apos;][&apos;MSH.9.1&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.9&apos;][&apos;MSH.9.2&apos;].toString() != &quot;&quot;) {msh.messageType.triggerEvent = msg[&apos;MSH&apos;][&apos;MSH.9&apos;][&apos;MSH.9.2&apos;].toString(); }
if (Object.keys(msh.messageType).length == 0) {
	delete msh.messageType;
}

// MSH.10, messageControlID
if (msg[&apos;MSH&apos;][&apos;MSH.10&apos;][&apos;MSH.10.1&apos;].toString() != &quot;&quot;) {msh.messageControlID = msg[&apos;MSH&apos;][&apos;MSH.10&apos;][&apos;MSH.10.1&apos;].toString(); }

// MSH.11, processingID
msh.processingID = {};
if (msg[&apos;MSH&apos;][&apos;MSH.11&apos;][&apos;MSH.11.1&apos;].toString() != &quot;&quot;) {msh.processingID.processingID = msg[&apos;MSH&apos;][&apos;MSH.11&apos;][&apos;MSH.11.1&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.11&apos;][&apos;MSH.11.2&apos;].toString() != &quot;&quot;) {msh.processingID.processingMode = msg[&apos;MSH&apos;][&apos;MSH.11&apos;][&apos;MSH.11.2&apos;].toString(); }
if (Object.keys(msh.processingID).length == 0) {
	delete msh.processingID;
}

// MSH.12, versionID
if (msg[&apos;MSH&apos;][&apos;MSH.12&apos;][&apos;MSH.12.1&apos;].toString() != &quot;&quot;) {msh.versionID = msg[&apos;MSH&apos;][&apos;MSH.12&apos;][&apos;MSH.12.1&apos;].toString(); }

// MSH.13, sequenceNumber
if (msg[&apos;MSH&apos;][&apos;MSH.13&apos;][&apos;MSH.13.1&apos;].toString() != &quot;&quot;) {msh.sequenceNumber = msg[&apos;MSH&apos;][&apos;MSH.13&apos;][&apos;MSH.13.1&apos;].toString(); }

// MSH.14, continuationPointer
if (msg[&apos;MSH&apos;][&apos;MSH.14&apos;][&apos;MSH.14.1&apos;].toString() != &quot;&quot;) {msh.continuationPointer = msg[&apos;MSH&apos;][&apos;MSH.14&apos;][&apos;MSH.14.1&apos;].toString(); }

// MSH.15, acceptAcknowledgmentType
if (msg[&apos;MSH&apos;][&apos;MSH.15&apos;][&apos;MSH.15.1&apos;].toString() != &quot;&quot;) {msh.acceptAcknowledgmentType = msg[&apos;MSH&apos;][&apos;MSH.15&apos;][&apos;MSH.15.1&apos;].toString(); }

// MSH.16, applicationAcknowledgmentType
if (msg[&apos;MSH&apos;][&apos;MSH.16&apos;][&apos;MSH.16.1&apos;].toString() != &quot;&quot;) {msh.applicationAcknowledgmentType = msg[&apos;MSH&apos;][&apos;MSH.16&apos;][&apos;MSH.16.1&apos;].toString(); }

// MSH.17, countryCode
if (msg[&apos;MSH&apos;][&apos;MSH.17&apos;][&apos;MSH.17.1&apos;].toString() != &quot;&quot;) {msh.countryCode = msg[&apos;MSH&apos;][&apos;MSH.17&apos;][&apos;MSH.17.1&apos;].toString(); }

// MSH.18, characterSet
msh.characterSet = [];
for each (field in msg[&apos;MSH&apos;][&apos;MSH.18&apos;]) {
	if (field[&apos;MSH.18.1&apos;].toString() != &quot;&quot;) {msh.characterSet.push(field[&apos;MSH.18.1&apos;].toString()); }
}
if (msh.characterSet.length == 0) {
	delete msh.characterSet;
}

// MSH.19, principalLanguageOfMessage
msh.principalLanguageOfMessage = {};
if (msg[&apos;MSH&apos;][&apos;MSH.19&apos;][&apos;MSH.19.1&apos;].toString() != &quot;&quot;) {msh.principalLanguageOfMessage.id = msg[&apos;MSH&apos;][&apos;MSH.19&apos;][&apos;MSH.19.1&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.19&apos;][&apos;MSH.19.2&apos;].toString() != &quot;&quot;) {msh.principalLanguageOfMessage.text = msg[&apos;MSH&apos;][&apos;MSH.19&apos;][&apos;MSH.19.2&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.19&apos;][&apos;MSH.19.3&apos;].toString() != &quot;&quot;) {msh.principalLanguageOfMessage.codingSystem = msg[&apos;MSH&apos;][&apos;MSH.19&apos;][&apos;MSH.19.3&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.19&apos;][&apos;MSH.19.4&apos;].toString() != &quot;&quot;) {msh.principalLanguageOfMessage.altId = msg[&apos;MSH&apos;][&apos;MSH.19&apos;][&apos;MSH.19.4&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.19&apos;][&apos;MSH.19.5&apos;].toString() != &quot;&quot;) {msh.principalLanguageOfMessage.altText = msg[&apos;MSH&apos;][&apos;MSH.19&apos;][&apos;MSH.19.5&apos;].toString(); }
if (msg[&apos;MSH&apos;][&apos;MSH.19&apos;][&apos;MSH.19.6&apos;].toString() != &quot;&quot;) {msh.principalLanguageOfMessage.altCodingSystem = msg[&apos;MSH&apos;][&apos;MSH.19&apos;][&apos;MSH.19.6&apos;].toString(); }
if (Object.keys(msh.principalLanguageOfMessage).length == 0) {
	delete msh.principalLanguageOfMessage;
}

// Optional: save a copy of the completed MSH segment for reference later
//channelMap.put(&quot;msh&quot;, msh); // uncomment to save

// If it has content, add the MSH segment to the hl7JSON object
if (msh &amp;&amp; Object.keys(msh).length != 0) {
	var hl7JSON = JSON.parse($(&apos;hl7JSON&apos;));
	hl7JSON.content.MSH = msh;
	channelMap.put(&quot;hl7JSON&quot;, JSON.stringify(hl7JSON));
}</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.8.1">
          <name>EVN (Event) Segment</name>
          <sequenceNumber>2</sequenceNumber>
          <enabled>true</enabled>
          <script>// EVN
var evn;
if (msg[&apos;EVN&apos;].length() &gt; 0) {
	evn = [];
	var index = 0;
	for each (seg in msg.EVN) {
		evn[index] = {};

		// EVN.1, eventType
		if (seg[&apos;EVN.1&apos;][&apos;EVN.1.1&apos;].toString() != &quot;&quot;) { evn[index].eventType = seg[&apos;EVN.1&apos;][&apos;EVN.1.1&apos;].toString(); }

		// EVN.2, recordedDateTime
		if (seg[&apos;EVN.2&apos;][&apos;EVN.2.1&apos;].toString() != &quot;&quot;) { evn[index].recordedDateTime = seg[&apos;EVN.2&apos;][&apos;EVN.2.1&apos;].toString(); }

		// EVN.3, plannedEventDateTime
		if (seg[&apos;EVN.3&apos;][&apos;EVN.3.1&apos;].toString() != &quot;&quot;) { evn[index].plannedEventDateTime = seg[&apos;EVN.3&apos;][&apos;EVN.3.1&apos;].toString(); }

		// EVN.4, eventReasonCode
		if (seg[&apos;EVN.4&apos;][&apos;EVN.4.1&apos;].toString() != &quot;&quot;) { evn[index].eventReasonCode = seg[&apos;EVN.4&apos;][&apos;EVN.4.1&apos;].toString(); }

		// EVN.5, operatorId
		evn[index].operatorId = {};
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.1&apos;].toString() != &quot;&quot;) { evn[index].operatorId.id = seg[&apos;EVN.5&apos;][&apos;EVN.5.1&apos;].toString(); }
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.2&apos;].toString() != &quot;&quot;) { evn[index].operatorId.lastName = seg[&apos;EVN.5&apos;][&apos;EVN.5.2&apos;].toString(); }
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.3&apos;].toString() != &quot;&quot;) { evn[index].operatorId.firstName = seg[&apos;EVN.5&apos;][&apos;EVN.5.3&apos;].toString(); }
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.4&apos;].toString() != &quot;&quot;) { evn[index].operatorId.middleInitOrName = seg[&apos;EVN.5&apos;][&apos;EVN.5.4&apos;].toString(); }
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.5&apos;].toString() != &quot;&quot;) { evn[index].operatorId.suffix = seg[&apos;EVN.5&apos;][&apos;EVN.5.5&apos;].toString(); }
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.6&apos;].toString() != &quot;&quot;) { evn[index].operatorId.prefix = seg[&apos;EVN.5&apos;][&apos;EVN.5.6&apos;].toString(); }
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.7&apos;].toString() != &quot;&quot;) { evn[index].operatorId.degree = seg[&apos;EVN.5&apos;][&apos;EVN.5.7&apos;].toString(); }
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.8&apos;].toString() != &quot;&quot;) { evn[index].operatorId.sourceTable = seg[&apos;EVN.5&apos;][&apos;EVN.5.8&apos;].toString(); }
		evn[index].operatorId.assigningAuthority = {};
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.9&apos;][&apos;EVN.5.9.1&apos;].toString() != &quot;&quot;) { evn[index].operatorId.assigningAuthority.id = seg[&apos;EVN.5&apos;][&apos;EVN.5.9&apos;][&apos;EVN.5.9.1&apos;].toString(); }
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.9&apos;][&apos;EVN.5.9.2&apos;].toString() != &quot;&quot;) { evn[index].operatorId.assigningAuthority.universalId = seg[&apos;EVN.5&apos;][&apos;EVN.5.9&apos;][&apos;EVN.5.9.2&apos;].toString(); }
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.9&apos;][&apos;EVN.5.9.3&apos;].toString() != &quot;&quot;) { evn[index].operatorId.assigningAuthority.universalIdType = seg[&apos;EVN.5&apos;][&apos;EVN.5.9&apos;][&apos;EVN.5.9.3&apos;].toString(); }
		if (Object.keys(evn[index].operatorId.assigningAuthority).length == 0) {
			if (seg[&apos;EVN.5&apos;][&apos;EVN.5.9&apos;].toString() != &quot;&quot;) { evn[index].operatorId.assigningAuthority.id = seg[&apos;EVN.5&apos;][&apos;EVN.5.9&apos;].toString(); }
			else delete evn[index].operatorId.assigningAuthority;
		}
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.10&apos;].toString() != &quot;&quot;) { evn[index].operatorId.nameTypeCode = seg[&apos;EVN.5&apos;][&apos;EVN.5.10&apos;].toString(); }
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.11&apos;].toString() != &quot;&quot;) { evn[index].operatorId.identifierCheckDigit = seg[&apos;EVN.5&apos;][&apos;EVN.5.11&apos;].toString(); }
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.12&apos;].toString() != &quot;&quot;) { evn[index].operatorId.codeIdentifyingCheckDigitScheme = seg[&apos;EVN.5&apos;][&apos;EVN.5.12&apos;].toString(); }
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.13&apos;].toString() != &quot;&quot;) { evn[index].operatorId.identifierTypeCode = seg[&apos;EVN.5&apos;][&apos;EVN.5.13&apos;].toString(); }
		evn[index].operatorId.assigningFacility = {};
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.14&apos;][&apos;EVN.5.14.1&apos;].toString() != &quot;&quot;) { evn[index].operatorId.assigningFacility.id = seg[&apos;EVN.5&apos;][&apos;EVN.5.14&apos;][&apos;EVN.5.14.1&apos;].toString(); }
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.14&apos;][&apos;EVN.5.14.2&apos;].toString() != &quot;&quot;) { evn[index].operatorId.assigningFacility.universalId = seg[&apos;EVN.5&apos;][&apos;EVN.5.14&apos;][&apos;EVN.5.14.2&apos;].toString(); }
		if (seg[&apos;EVN.5&apos;][&apos;EVN.5.14&apos;][&apos;EVN.5.14.3&apos;].toString() != &quot;&quot;) { evn[index].operatorId.assigningFacility.universalIdType = seg[&apos;EVN.5&apos;][&apos;EVN.5.14&apos;][&apos;EVN.5.14.3&apos;].toString(); }
		if (Object.keys(evn[index].operatorId.assigningFacility).length == 0) {
			if (seg[&apos;EVN.5&apos;][&apos;EVN.5.14&apos;].toString() != &quot;&quot;) { evn[index].operatorId.assigningFacility.id = seg[&apos;EVN.5&apos;][&apos;EVN.5.14&apos;].toString(); }
			else delete evn[index].operatorId.assigningFacility;
		}
		if (Object.keys(evn[index].operatorId).length == 0) {
			delete evn[index].operatorId;
		}

		// EVN.6, eventOccurred
		if (seg[&apos;EVN.6&apos;][&apos;EVN.6.1&apos;].toString() != &quot;&quot;) { evn[index].eventOccurred = seg[&apos;EVN.6&apos;][&apos;EVN.6.1&apos;].toString(); }

		// clean up EVN and increment index
		if (Object.keys(evn[index]).length == 0) {
			delete evn[index];
		} else {
			index++;
		}
	}
}

// Optional: save a copy of the completed EVN segment for reference later
//channelMap.put(&quot;evn&quot;, evn); // uncomment to save

// If it has content, add the EVN segment to the hl7JSON object
if (evn &amp;&amp; Object.keys(evn).length != 0) {
	var hl7JSON = JSON.parse($(&apos;hl7JSON&apos;));
	hl7JSON.content.EVN = evn;
	channelMap.put(&quot;hl7JSON&quot;, JSON.stringify(hl7JSON));
}</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.8.1">
          <name>PID (Patient Identification), PD1 (Patient Demographic), and related NTE (Note) Segments</name>
          <sequenceNumber>3</sequenceNumber>
          <enabled>true</enabled>
          <script>// PID; includes PD1 and NTE
var pid;
if (msg[&apos;PID&apos;].length() &gt; 0) {
	pid = [];
	var index = 0;
	for each (seg in msg.PID) {
		pid[index] = {};

		// PID.1, setId
		if (seg[&apos;PID.1&apos;][&apos;PID.1.1&apos;].toString() != &quot;&quot;) { pid[index].setId = seg[&apos;PID.1&apos;][&apos;PID.1.1&apos;].toString(); }

		// PID.2, externalId
		pid[index].externalId = {};
		if (seg[&apos;PID.2&apos;][&apos;PID.2.1&apos;].toString() != &quot;&quot;) { pid[index].externalId.id = seg[&apos;PID.2&apos;][&apos;PID.2.1&apos;].toString(); }
		if (seg[&apos;PID.2&apos;][&apos;PID.2.2&apos;].toString() != &quot;&quot;) { pid[index].externalId.identifierCheckDigit = seg[&apos;PID.2&apos;][&apos;PID.2.2&apos;].toString(); }
		if (seg[&apos;PID.2&apos;][&apos;PID.2.3&apos;].toString() != &quot;&quot;) { pid[index].externalId.codeIdentifyingCheckDigitScheme = seg[&apos;PID.2&apos;][&apos;PID.2.3&apos;].toString(); }
		pid[index].externalId.assigningAuthority = {};
		if (seg[&apos;PID.2&apos;][&apos;PID.2.4&apos;][&apos;PID.2.4.1&apos;].toString() != &quot;&quot;) { pid[index].externalId.assigningAuthority.namespaceId = seg[&apos;PID.2&apos;][&apos;PID.2.4&apos;][&apos;PID.2.4.1&apos;].toString(); }
		if (seg[&apos;PID.2&apos;][&apos;PID.2.4&apos;][&apos;PID.2.4.2&apos;].toString() != &quot;&quot;) { pid[index].externalId.assigningAuthority.universalId = seg[&apos;PID.2&apos;][&apos;PID.2.4&apos;][&apos;PID.2.4.2&apos;].toString(); }
		if (seg[&apos;PID.2&apos;][&apos;PID.2.4&apos;][&apos;PID.2.4.3&apos;].toString() != &quot;&quot;) { pid[index].externalId.assigningAuthority.universalIdType = seg[&apos;PID.2&apos;][&apos;PID.2.4&apos;][&apos;PID.2.4.3&apos;].toString(); }
		if (Object.keys(pid[index].externalId.assigningAuthority).length == 0) {
			if (seg[&apos;PID.2&apos;][&apos;PID.2.4&apos;].toString() != &quot;&quot;) { pid[index].externalId.assigningAuthority.namespaceId = seg[&apos;PID.2&apos;][&apos;PID.2.4&apos;].toString(); }
			else delete pid[index].externalId.assigningAuthority;
		}
		if (seg[&apos;PID.2&apos;][&apos;PID.2.5&apos;].toString() != &quot;&quot;) { pid[index].externalId.idTypeCode = seg[&apos;PID.2&apos;][&apos;PID.2.5&apos;].toString(); }
		pid[index].externalId.assigningFacility = {};
		if (seg[&apos;PID.2&apos;][&apos;PID.2.6&apos;][&apos;PID.2.6.1&apos;].toString() != &quot;&quot;) { pid[index].externalId.assigningFacility.namespaceId = seg[&apos;PID.2&apos;][&apos;PID.2.6&apos;][&apos;PID.2.6.1&apos;].toString(); }
		if (seg[&apos;PID.2&apos;][&apos;PID.2.6&apos;][&apos;PID.2.6.2&apos;].toString() != &quot;&quot;) { pid[index].externalId.assigningFacility.universalId = seg[&apos;PID.2&apos;][&apos;PID.2.6&apos;][&apos;PID.2.6.2&apos;].toString(); }
		if (seg[&apos;PID.2&apos;][&apos;PID.2.6&apos;][&apos;PID.2.6.3&apos;].toString() != &quot;&quot;) { pid[index].externalId.assigningFacility.universalIdType = seg[&apos;PID.2&apos;][&apos;PID.2.6&apos;][&apos;PID.2.6.3&apos;].toString(); }
		if (Object.keys(pid[index].externalId.assigningFacility).length == 0) {
			if (seg[&apos;PID.2&apos;][&apos;PID.2.6&apos;].toString() != &quot;&quot;) { pid[index].externalId.assigningFacility.namespaceId = seg[&apos;PID.2&apos;][&apos;PID.2.6&apos;].toString(); }
			else delete pid[index].externalId.assigningFacility;
		}
		if (Object.keys(pid[index].externalId).length == 0) {
			delete pid[index].externalId;
		}

		// PID.3, internalId
		pid[index].internalId = [];
		for each (field in seg[&apos;PID.3&apos;]) {
			var block = {};
			if (field[&apos;PID.3.1&apos;].toString() != &quot;&quot;) { block.id = field[&apos;PID.3.1&apos;].toString(); }
			if (field[&apos;PID.3.2&apos;].toString() != &quot;&quot;) { block.identifierCheckDigit = field[&apos;PID.3.2&apos;].toString(); }
			if (field[&apos;PID.3.3&apos;].toString() != &quot;&quot;) { block.codeIdentifyingCheckDigitScheme = field[&apos;PID.3.3&apos;].toString(); }
			block.assigningAuthority = {};
			if (field[&apos;PID.3.4&apos;][&apos;PID.3.4.1&apos;].toString() != &quot;&quot;) { block.assigningAuthority.namespaceId = field[&apos;PID.3.4&apos;][&apos;PID.3.4.1&apos;].toString(); }
			if (field[&apos;PID.3.4&apos;][&apos;PID.3.4.2&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalId = field[&apos;PID.3.4&apos;][&apos;PID.3.4.2&apos;].toString(); }
			if (field[&apos;PID.3.4&apos;][&apos;PID.3.4.3&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalIdType = field[&apos;PID.3.4&apos;][&apos;PID.3.4.3&apos;].toString(); }
			if (Object.keys(block.assigningAuthority).length == 0) {
				if (field[&apos;PID.3.4&apos;].toString() != &quot;&quot;) { block.assigningAuthority.namespaceId = field[&apos;PID.3.4&apos;].toString(); }
				else delete block.assigningAuthority;
			}
			if (field[&apos;PID.3.5&apos;].toString() != &quot;&quot;) { block.idTypeCode = field[&apos;PID.3.5&apos;].toString(); }
			block.assigningFacility = {};
			if (field[&apos;PID.3.6&apos;][&apos;PID.3.6.1&apos;].toString() != &quot;&quot;) { block.assigningFacility.namespaceId = field[&apos;PID.3.6&apos;][&apos;PID.3.6.1&apos;].toString(); }
			if (field[&apos;PID.3.6&apos;][&apos;PID.3.6.2&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalId = field[&apos;PID.3.6&apos;][&apos;PID.3.6.2&apos;].toString(); }
			if (field[&apos;PID.3.6&apos;][&apos;PID.3.6.3&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalIdType = field[&apos;PID.3.6&apos;][&apos;PID.3.6.3&apos;].toString(); }
			if (Object.keys(block.assigningFacility).length == 0) {
				if (field[&apos;PID.3.6&apos;].toString() != &quot;&quot;) { block.assigningFacility.namespaceId = field[&apos;PID.3.6&apos;].toString(); }
				else delete block.assigningFacility;
			}
			if (Object.keys(block).length &gt; 0) {
				pid[index].internalId.push(block);
			}
		}
		if (pid[index].internalId.length == 0) {
			delete pid[index].internalId;
		}

		// PID.4, alternateId
		pid[index].alternateId = [];
		for each (field in seg[&apos;PID.4&apos;]) {
			var block = {};
			if (field[&apos;PID.4.1&apos;].toString() != &quot;&quot;) { block.id = field[&apos;PID.4.1&apos;].toString(); }
			if (field[&apos;PID.4.2&apos;].toString() != &quot;&quot;) { block.identifierCheckDigit = field[&apos;PID.4.2&apos;].toString(); }
			if (field[&apos;PID.4.3&apos;].toString() != &quot;&quot;) { block.codeIdentifyingCheckDigitScheme = field[&apos;PID.4.3&apos;].toString(); }
			block.assigningAuthority = {};
			if (field[&apos;PID.4.4&apos;][&apos;PID.4.4.1&apos;].toString() != &quot;&quot;) { block.assigningAuthority.namespaceId = field[&apos;PID.4.4&apos;][&apos;PID.4.4.1&apos;].toString(); }
			if (field[&apos;PID.4.4&apos;][&apos;PID.4.4.2&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalId = field[&apos;PID.4.4&apos;][&apos;PID.4.4.2&apos;].toString(); }
			if (field[&apos;PID.4.4&apos;][&apos;PID.4.4.3&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalIdType = field[&apos;PID.4.4&apos;][&apos;PID.4.4.3&apos;].toString(); }
			if (Object.keys(block.assigningAuthority).length == 0) {
				if (field[&apos;PID.4.4&apos;].toString() != &quot;&quot;) { block.assigningAuthority.namespaceId = field[&apos;PID.4.4&apos;].toString(); }
				else delete block.assigningAuthority;
			}
			if (field[&apos;PID.4.5&apos;].toString() != &quot;&quot;) { block.idTypeCode = field[&apos;PID.4.5&apos;].toString(); }
			block.assigningFacility = {};
			if (field[&apos;PID.4.6&apos;][&apos;PID.4.6.1&apos;].toString() != &quot;&quot;) { block.assigningFacility.namespaceId = field[&apos;PID.4.6&apos;][&apos;PID.4.6.1&apos;].toString(); }
			if (field[&apos;PID.4.6&apos;][&apos;PID.4.6.2&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalId = field[&apos;PID.4.6&apos;][&apos;PID.4.6.2&apos;].toString(); }
			if (field[&apos;PID.4.6&apos;][&apos;PID.4.6.3&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalIdType = field[&apos;PID.4.6&apos;][&apos;PID.4.6.3&apos;].toString(); }
			if (Object.keys(block.assigningFacility).length == 0) {
				if (field[&apos;PID.4.6&apos;].toString() != &quot;&quot;) { block.assigningFacility.namespaceId = field[&apos;PID.4.6&apos;].toString(); }
				else delete block.assigningFacility;
			}
			if (Object.keys(block).length &gt; 0) {
				pid[index].alternateId.push(block);
			}
		}
		if (pid[index].alternateId.length == 0) {
			delete pid[index].alternateId;
		}

		// PID.5, patientName
		pid[index].patientName = [];
		for each (field in seg[&apos;PID.5&apos;]) {
			var block = {};
			if (field[&apos;PID.5.1&apos;].toString() != &quot;&quot;) { block.lastName = field[&apos;PID.5.1&apos;].toString(); }
			if (field[&apos;PID.5.2&apos;].toString() != &quot;&quot;) { block.firstName = field[&apos;PID.5.2&apos;].toString(); }
			if (field[&apos;PID.5.3&apos;].toString() != &quot;&quot;) { block.middleInitOrName = field[&apos;PID.5.3&apos;].toString(); }
			if (field[&apos;PID.5.4&apos;].toString() != &quot;&quot;) { block.suffix = field[&apos;PID.5.4&apos;].toString(); }
			if (field[&apos;PID.5.5&apos;].toString() != &quot;&quot;) { block.prefix = field[&apos;PID.5.5&apos;].toString(); }
			if (field[&apos;PID.5.6&apos;].toString() != &quot;&quot;) { block.degree = field[&apos;PID.5.6&apos;].toString(); }
			if (field[&apos;PID.5.7&apos;].toString() != &quot;&quot;) { block.nameTypeCode = field[&apos;PID.5.7&apos;].toString(); }
			if (Object.keys(block).length &gt; 0) {
				pid[index].patientName.push(block);
			}	
		}
		if (pid[index].patientName.length == 0) {
			delete pid[index].patientName;
		}

		// PID.6, mothersMaidenName
		pid[index].mothersMaidenName = {};
		if (seg[&apos;PID.6&apos;][&apos;PID.6.1&apos;].toString() != &quot;&quot;) { pid[index].mothersMaidenName.lastName = seg[&apos;PID.6&apos;][&apos;PID.6.1&apos;].toString(); }
		if (seg[&apos;PID.6&apos;][&apos;PID.6.2&apos;].toString() != &quot;&quot;) { pid[index].mothersMaidenName.firstName = seg[&apos;PID.6&apos;][&apos;PID.6.2&apos;].toString(); }
		if (seg[&apos;PID.6&apos;][&apos;PID.6.3&apos;].toString() != &quot;&quot;) { pid[index].mothersMaidenName.middleInitOrName = seg[&apos;PID.6&apos;][&apos;PID.6.3&apos;].toString(); }
		if (seg[&apos;PID.6&apos;][&apos;PID.6.4&apos;].toString() != &quot;&quot;) { pid[index].mothersMaidenName.suffix = seg[&apos;PID.6&apos;][&apos;PID.6.4&apos;].toString(); }
		if (seg[&apos;PID.6&apos;][&apos;PID.6.5&apos;].toString() != &quot;&quot;) { pid[index].mothersMaidenName.prefix = seg[&apos;PID.6&apos;][&apos;PID.6.5&apos;].toString(); }
		if (seg[&apos;PID.6&apos;][&apos;PID.6.6&apos;].toString() != &quot;&quot;) { pid[index].mothersMaidenName.degree = seg[&apos;PID.6&apos;][&apos;PID.6.6&apos;].toString(); }
		if (seg[&apos;PID.6&apos;][&apos;PID.6.7&apos;].toString() != &quot;&quot;) { pid[index].mothersMaidenName.nameTypeCode = seg[&apos;PID.6&apos;][&apos;PID.6.7&apos;].toString(); }
		if (Object.keys(pid[index].mothersMaidenName).length == 0) {
			delete pid[index].mothersMaidenName;
		}

		// PID.7, dateTimeBirth
		if (seg[&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString() != &quot;&quot;) {pid[index].dateTimeBirth = seg[&apos;PID.7&apos;][&apos;PID.7.1&apos;].toString(); }
		
		// PID.8, sex
		if (seg[&apos;PID.8&apos;][&apos;PID.8.1&apos;].toString() != &quot;&quot;) {pid[index].sex = seg[&apos;PID.8&apos;][&apos;PID.8.1&apos;].toString(); }
		
		// PID.9, alias
		pid[index].alias = [];
		for each (field in seg[&apos;PID.9&apos;]) {
			var block = {};
			if (field[&apos;PID.9.1&apos;].toString() != &quot;&quot;) { block.lastName = field[&apos;PID.9.1&apos;].toString(); }
			if (field[&apos;PID.9.2&apos;].toString() != &quot;&quot;) { block.firstName = field[&apos;PID.9.2&apos;].toString(); }
			if (field[&apos;PID.9.3&apos;].toString() != &quot;&quot;) { block.middleInitOrName = field[&apos;PID.9.3&apos;].toString(); }
			if (field[&apos;PID.9.4&apos;].toString() != &quot;&quot;) { block.suffix = field[&apos;PID.9.4&apos;].toString(); }
			if (field[&apos;PID.9.5&apos;].toString() != &quot;&quot;) { block.prefix = field[&apos;PID.9.5&apos;].toString(); }
			if (field[&apos;PID.9.6&apos;].toString() != &quot;&quot;) { block.degree = field[&apos;PID.9.6&apos;].toString(); }
			if (field[&apos;PID.9.7&apos;].toString() != &quot;&quot;) { block.nameTypeCode = field[&apos;PID.9.7&apos;].toString(); }
			if (Object.keys(block).length &gt; 0) {
				pid[index].alias.push(block);
			}	
		}
		if (pid[index].alias.length == 0) {
			delete pid[index].alias;
		}

		// PID.10, race
		if (seg[&apos;PID.10&apos;][&apos;PID.10.1&apos;].toString() != &quot;&quot;) {pid[index].race = seg[&apos;PID.10&apos;][&apos;PID.10.1&apos;].toString(); }
		
		// PID.11, address
		pid[index].address = [];
		for each (field in seg[&apos;PID.11&apos;]) {
			var block = {};
			if (field[&apos;PID.11.1&apos;].toString() != &quot;&quot;) { block.streetAddress = field[&apos;PID.11.1&apos;].toString(); }
			if (field[&apos;PID.11.2&apos;].toString() != &quot;&quot;) { block.otherDesignation = field[&apos;PID.11.2&apos;].toString(); }
			if (field[&apos;PID.11.3&apos;].toString() != &quot;&quot;) { block.city = field[&apos;PID.11.3&apos;].toString(); }
			if (field[&apos;PID.11.4&apos;].toString() != &quot;&quot;) { block.stateOrProvince = field[&apos;PID.11.4&apos;].toString(); }
			if (field[&apos;PID.11.5&apos;].toString() != &quot;&quot;) { block.zip = field[&apos;PID.11.5&apos;].toString(); }
			if (field[&apos;PID.11.6&apos;].toString() != &quot;&quot;) { block.country = field[&apos;PID.11.6&apos;].toString(); }
			if (field[&apos;PID.11.7&apos;].toString() != &quot;&quot;) { block.addressType = field[&apos;PID.11.7&apos;].toString(); }
			if (field[&apos;PID.11.8&apos;].toString() != &quot;&quot;) { block.otherGeographicDesignation = field[&apos;PID.11.8&apos;].toString(); }
			if (field[&apos;PID.11.9&apos;].toString() != &quot;&quot;) { block.countyOrParishCode = field[&apos;PID.11.9&apos;].toString(); }
			if (field[&apos;PID.11.10&apos;].toString() != &quot;&quot;) { block.censusTract = field[&apos;PID.11.10&apos;].toString(); }
			if (Object.keys(block).length &gt; 0) {
				pid[index].address.push(block);
			}
		}
		if (pid[index].address.length == 0) {
			delete pid[index].address;
		}

		// PID.12, countyCode
		if (seg[&apos;PID.12&apos;][&apos;PID.12.1&apos;].toString() != &quot;&quot;) {pid[index].countyCode = seg[&apos;PID.12&apos;][&apos;PID.12.1&apos;].toString(); }
		
		// PID.13, homePhone
		pid[index].homePhone = [];
		for each (field in seg[&apos;PID.13&apos;]) {
			var block = {};
			if (field[&apos;PID.13.1&apos;].toString() != &quot;&quot;) { block.number = field[&apos;PID.13.1&apos;].toString(); }
			if (field[&apos;PID.13.2&apos;].toString() != &quot;&quot;) { block.telecommunicationUseCode = field[&apos;PID.13.2&apos;].toString(); }
			if (field[&apos;PID.13.3&apos;].toString() != &quot;&quot;) { block.telecommunicationEquipmentType = field[&apos;PID.13.3&apos;].toString(); }
			if (field[&apos;PID.13.4&apos;].toString() != &quot;&quot;) { block.emailAddress = field[&apos;PID.13.4&apos;].toString(); }
			if (field[&apos;PID.13.5&apos;].toString() != &quot;&quot;) { block.countryCode = field[&apos;PID.13.5&apos;].toString(); }
			if (field[&apos;PID.13.6&apos;].toString() != &quot;&quot;) { block.areaCityCode = field[&apos;PID.13.6&apos;].toString(); }
			if (field[&apos;PID.13.7&apos;].toString() != &quot;&quot;) { block.phoneNumber = field[&apos;PID.13.7&apos;].toString(); }
			if (field[&apos;PID.13.8&apos;].toString() != &quot;&quot;) { block.extension = field[&apos;PID.13.8&apos;].toString(); }
			if (field[&apos;PID.13.9&apos;].toString() != &quot;&quot;) { block.text = field[&apos;PID.13.9&apos;].toString(); }
			if (Object.keys(block).length &gt; 0) {
				pid[index].homePhone.push(block);
			}
		}
		if (pid[index].homePhone.length == 0) {
			delete pid[index].homePhone;
		}

		// PID.14, businessPhone
		pid[index].businessPhone = [];
		for each (field in seg[&apos;PID.14&apos;]) {
			var block = {};
			if (field[&apos;PID.14.1&apos;].toString() != &quot;&quot;) { block.number = field[&apos;PID.14.1&apos;].toString(); }
			if (field[&apos;PID.14.2&apos;].toString() != &quot;&quot;) { block.telecommunicationUseCode = field[&apos;PID.14.2&apos;].toString(); }
			if (field[&apos;PID.14.3&apos;].toString() != &quot;&quot;) { block.telecommunicationEquipmentType = field[&apos;PID.14.3&apos;].toString(); }
			if (field[&apos;PID.14.4&apos;].toString() != &quot;&quot;) { block.emailAddress = field[&apos;PID.14.4&apos;].toString(); }
			if (field[&apos;PID.14.5&apos;].toString() != &quot;&quot;) { block.countryCode = field[&apos;PID.14.5&apos;].toString(); }
			if (field[&apos;PID.14.6&apos;].toString() != &quot;&quot;) { block.areaCityCode = field[&apos;PID.14.6&apos;].toString(); }
			if (field[&apos;PID.14.7&apos;].toString() != &quot;&quot;) { block.phoneNumber = field[&apos;PID.14.7&apos;].toString(); }
			if (field[&apos;PID.14.8&apos;].toString() != &quot;&quot;) { block.extension = field[&apos;PID.14.8&apos;].toString(); }
			if (field[&apos;PID.14.9&apos;].toString() != &quot;&quot;) { block.text = field[&apos;PID.14.9&apos;].toString(); }
			if (Object.keys(block).length &gt; 0) {
				pid[index].businessPhone.push(block);
			}
		}
		if (pid[index].businessPhone.length == 0) {
			delete pid[index].businessPhone;
		}

		// PID.15, primaryLanguage
		pid[index].primaryLanguage = {};
		if (seg[&apos;PID.15&apos;][&apos;PID.15.1&apos;].toString() != &quot;&quot;) { pid[index].primaryLanguage.id = seg[&apos;PID.15&apos;][&apos;PID.15.1&apos;].toString(); }
		if (seg[&apos;PID.15&apos;][&apos;PID.15.2&apos;].toString() != &quot;&quot;) { pid[index].primaryLanguage.text = seg[&apos;PID.15&apos;][&apos;PID.15.2&apos;].toString(); }
		if (seg[&apos;PID.15&apos;][&apos;PID.15.3&apos;].toString() != &quot;&quot;) { pid[index].primaryLanguage.codingSystem = seg[&apos;PID.15&apos;][&apos;PID.15.3&apos;].toString(); }
		if (seg[&apos;PID.15&apos;][&apos;PID.15.4&apos;].toString() != &quot;&quot;) { pid[index].primaryLanguage.altId = seg[&apos;PID.15&apos;][&apos;PID.15.4&apos;].toString(); }
		if (seg[&apos;PID.15&apos;][&apos;PID.15.5&apos;].toString() != &quot;&quot;) { pid[index].primaryLanguage.altText = seg[&apos;PID.15&apos;][&apos;PID.15.5&apos;].toString(); }
		if (seg[&apos;PID.15&apos;][&apos;PID.15.6&apos;].toString() != &quot;&quot;) { pid[index].primaryLanguage.altCodingSystem = seg[&apos;PID.15&apos;][&apos;PID.15.6&apos;].toString(); }
		if (Object.keys(pid[index].primaryLanguage).length == 0) {
			delete pid[index].primaryLanguage;
		}

		// PID.16, maritalStatus
		if (seg[&apos;PID.16&apos;][&apos;PID.16.1&apos;].toString() != &quot;&quot;) {pid[index].maritalStatus = seg[&apos;PID.16&apos;][&apos;PID.16.1&apos;].toString(); }
		
		// PID.17, religion
		if (seg[&apos;PID.17&apos;][&apos;PID.17.1&apos;].toString() != &quot;&quot;) {pid[index].religion = seg[&apos;PID.17&apos;][&apos;PID.17.1&apos;].toString(); }

		// PID.18, patientAccountNumber
		pid[index].patientAccountNumber = {};
		if (seg[&apos;PID.18&apos;][&apos;PID.18.1&apos;].toString() != &quot;&quot;) { pid[index].patientAccountNumber.id = seg[&apos;PID.18&apos;][&apos;PID.18.1&apos;].toString(); }
		if (seg[&apos;PID.18&apos;][&apos;PID.18.2&apos;].toString() != &quot;&quot;) { pid[index].patientAccountNumber.identifierCheckDigit = seg[&apos;PID.18&apos;][&apos;PID.18.2&apos;].toString(); }
		if (seg[&apos;PID.18&apos;][&apos;PID.18.3&apos;].toString() != &quot;&quot;) { pid[index].patientAccountNumber.codeIdentifyingCheckDigitScheme = seg[&apos;PID.18&apos;][&apos;PID.18.3&apos;].toString(); }
		pid[index].patientAccountNumber.assigningAuthority = {};
		if (seg[&apos;PID.18&apos;][&apos;PID.18.4&apos;][&apos;PID.18.4.1&apos;].toString() != &quot;&quot;) { pid[index].patientAccountNumber.assigningAuthority.namespaceId = seg[&apos;PID.18&apos;][&apos;PID.18.4&apos;][&apos;PID.18.4.1&apos;].toString(); }
		if (seg[&apos;PID.18&apos;][&apos;PID.18.4&apos;][&apos;PID.18.4.2&apos;].toString() != &quot;&quot;) { pid[index].patientAccountNumber.assigningAuthority.universalId = seg[&apos;PID.18&apos;][&apos;PID.18.4&apos;][&apos;PID.18.4.2&apos;].toString(); }
		if (seg[&apos;PID.18&apos;][&apos;PID.18.4&apos;][&apos;PID.18.4.3&apos;].toString() != &quot;&quot;) { pid[index].patientAccountNumber.assigningAuthority.universalIdType = seg[&apos;PID.18&apos;][&apos;PID.18.4&apos;][&apos;PID.18.4.3&apos;].toString(); }
		if (Object.keys(pid[index].patientAccountNumber.assigningAuthority).length == 0) {
			if (seg[&apos;PID.18&apos;][&apos;PID.18.4&apos;].toString() != &quot;&quot;) { pid[index].patientAccountNumber.assigningAuthority.namespaceId = seg[&apos;PID.18&apos;][&apos;PID.18.4&apos;].toString(); }
			else delete pid[index].patientAccountNumber.assigningAuthority;
		}
		if (seg[&apos;PID.18&apos;][&apos;PID.18.5&apos;].toString() != &quot;&quot;) { pid[index].patientAccountNumber.idTypeCode = seg[&apos;PID.18&apos;][&apos;PID.18.5&apos;].toString(); }
		pid[index].patientAccountNumber.assigningFacility = {};
		if (seg[&apos;PID.18&apos;][&apos;PID.18.6&apos;][&apos;PID.18.6.1&apos;].toString() != &quot;&quot;) { pid[index].patientAccountNumber.assigningFacility.namespaceId = seg[&apos;PID.18&apos;][&apos;PID.18.6&apos;][&apos;PID.18.6.1&apos;].toString(); }
		if (seg[&apos;PID.18&apos;][&apos;PID.18.6&apos;][&apos;PID.18.6.2&apos;].toString() != &quot;&quot;) { pid[index].patientAccountNumber.assigningFacility.universalId = seg[&apos;PID.18&apos;][&apos;PID.18.6&apos;][&apos;PID.18.6.2&apos;].toString(); }
		if (seg[&apos;PID.18&apos;][&apos;PID.18.6&apos;][&apos;PID.18.6.3&apos;].toString() != &quot;&quot;) { pid[index].patientAccountNumber.assigningFacility.universalIdType = seg[&apos;PID.18&apos;][&apos;PID.18.6&apos;][&apos;PID.18.6.3&apos;].toString(); }
		if (Object.keys(pid[index].patientAccountNumber.assigningFacility).length == 0) {
			if (seg[&apos;PID.18&apos;][&apos;PID.18.6&apos;].toString() != &quot;&quot;) { pid[index].patientAccountNumber.assigningFacility.namespaceId = seg[&apos;PID.18&apos;][&apos;PID.18.6&apos;].toString(); }
			else delete pid[index].patientAccountNumber.assigningFacility;
		}
		if (Object.keys(pid[index].patientAccountNumber).length == 0) {
			delete pid[index].patientAccountNumber;
		}

		// PID.19, ssn
		if (seg[&apos;PID.19&apos;][&apos;PID.19.1&apos;].toString() != &quot;&quot;) {pid[index].ssn = seg[&apos;PID.19&apos;][&apos;PID.19.1&apos;].toString(); }
		
		// PID.20, driversLicenseNumber
		pid[index].driversLicenseNumber = {};
		if (seg[&apos;PID.20&apos;][&apos;PID.20.1&apos;].toString() != &quot;&quot;) {pid[index].driversLicenseNumber.licenseNumber = seg[&apos;PID.20&apos;][&apos;PID.20.1&apos;].toString(); }
		if (seg[&apos;PID.20&apos;][&apos;PID.20.2&apos;].toString() != &quot;&quot;) {pid[index].driversLicenseNumber.issuingStateProvinceCountry = seg[&apos;PID.20&apos;][&apos;PID.20.2&apos;].toString(); }
		if (seg[&apos;PID.20&apos;][&apos;PID.20.3&apos;].toString() != &quot;&quot;) {pid[index].driversLicenseNumber.expirationDate = seg[&apos;PID.20&apos;][&apos;PID.20.3&apos;].toString(); }
		if (Object.keys(pid[index].driversLicenseNumber).length == 0) {
			delete pid[index].driversLicenseNumber;
		}

		// PID.21, mothersId
		pid[index].mothersId = [];
		for each (field in seg[&apos;PID.21&apos;]) {
			var block = {};
			if (field[&apos;PID.21.1&apos;].toString() != &quot;&quot;) { block.id = field[&apos;PID.21.1&apos;].toString(); }
			if (field[&apos;PID.21.2&apos;].toString() != &quot;&quot;) { block.identifierCheckDigit = field[&apos;PID.21.2&apos;].toString(); }
			if (field[&apos;PID.21.3&apos;].toString() != &quot;&quot;) { block.codeIdentifyingCheckDigitScheme = field[&apos;PID.21.3&apos;].toString(); }
			block.assigningAuthority = {};
			if (field[&apos;PID.21.4&apos;][&apos;PID.21.4.1&apos;].toString() != &quot;&quot;) { block.assigningAuthority.namespaceId = field[&apos;PID.21.4&apos;][&apos;PID.21.4.1&apos;].toString(); }
			if (field[&apos;PID.21.4&apos;][&apos;PID.21.4.2&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalId = field[&apos;PID.21.4&apos;][&apos;PID.21.4.2&apos;].toString(); }
			if (field[&apos;PID.21.4&apos;][&apos;PID.21.4.3&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalIdType = field[&apos;PID.21.4&apos;][&apos;PID.21.4.3&apos;].toString(); }
			if (Object.keys(block.assigningAuthority).length == 0) {
				if (field[&apos;PID.21.4&apos;].toString() != &quot;&quot;) { block.assigningAuthority.namespaceId = field[&apos;PID.21.4&apos;].toString(); }
				else delete block.assigningAuthority;
			}
			if (field[&apos;PID.21.5&apos;].toString() != &quot;&quot;) { block.idTypeCode = field[&apos;PID.21.5&apos;].toString(); }
			block.assigningFacility = {};
			if (field[&apos;PID.21.6&apos;][&apos;PID.21.6.1&apos;].toString() != &quot;&quot;) { block.assigningFacility.namespaceId = field[&apos;PID.21.6&apos;][&apos;PID.21.6.1&apos;].toString(); }
			if (field[&apos;PID.21.6&apos;][&apos;PID.21.6.2&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalId = field[&apos;PID.21.6&apos;][&apos;PID.21.6.2&apos;].toString(); }
			if (field[&apos;PID.21.6&apos;][&apos;PID.21.6.3&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalIdType = field[&apos;PID.21.6&apos;][&apos;PID.21.6.3&apos;].toString(); }
			if (Object.keys(block.assigningFacility).length == 0) {
				if (field[&apos;PID.21.6&apos;].toString() != &quot;&quot;) { block.assigningAuthority.namespaceId = field[&apos;PID.21.6&apos;].toString(); }
				else delete block.assigningFacility;
			}
			if (Object.keys(block).length &gt; 0) {
				pid[index].mothersId.push(block);
			}
		}
		if (pid[index].mothersId.length == 0) {
			delete pid[index].mothersId;
		}

		// PID.22, ethnicGroup
		if (seg[&apos;PID.22&apos;][&apos;PID.22.1&apos;].toString() != &quot;&quot;) {pid[index].ethnicGroup = seg[&apos;PID.22&apos;][&apos;PID.22.1&apos;].toString(); }
		
		// PID.23, birthPlace
		if (seg[&apos;PID.23&apos;][&apos;PID.23.1&apos;].toString() != &quot;&quot;) {pid[index].birthPlace = seg[&apos;PID.23&apos;][&apos;PID.23.1&apos;].toString(); }
		
		// PID.24, multipleBirthIndicator
		if (seg[&apos;PID.24&apos;][&apos;PID.24.1&apos;].toString() != &quot;&quot;) {pid[index].multipleBirthIndicator = seg[&apos;PID.24&apos;][&apos;PID.24.1&apos;].toString(); }
		
		// PID.25, birthOrder
		if (seg[&apos;PID.25&apos;][&apos;PID.25.1&apos;].toString() != &quot;&quot;) {pid[index].birthOrder = seg[&apos;PID.25&apos;][&apos;PID.25.1&apos;].toString(); }
		
		// PID.26, citizenship
		pid[index].citizenship = [];
		for each (field in seg[&apos;PID.26&apos;]) {
			if (field[&apos;PID.26.1&apos;].toString() != &quot;&quot;) {
				pid[index].citizenship.push(field[&apos;PID.26.1&apos;].toString());
			}
		}
		if (pid[index].citizenship.length == 0) {
			delete pid[index].citizenship;
		}
		
		// PID.27, veteranStatus
		pid[index].veteranStatus = {};
		if (seg[&apos;PID.27&apos;][&apos;PID.27.1&apos;].toString() != &quot;&quot;) { pid[index].veteranStatus.id = seg[&apos;PID.27&apos;][&apos;PID.27.1&apos;].toString(); }
		if (seg[&apos;PID.27&apos;][&apos;PID.27.2&apos;].toString() != &quot;&quot;) { pid[index].veteranStatus.text = seg[&apos;PID.27&apos;][&apos;PID.27.2&apos;].toString(); }
		if (seg[&apos;PID.27&apos;][&apos;PID.27.3&apos;].toString() != &quot;&quot;) { pid[index].veteranStatus.codingSystem = seg[&apos;PID.27&apos;][&apos;PID.27.3&apos;].toString(); }
		if (seg[&apos;PID.27&apos;][&apos;PID.27.4&apos;].toString() != &quot;&quot;) { pid[index].veteranStatus.altId = seg[&apos;PID.27&apos;][&apos;PID.27.4&apos;].toString(); }
		if (seg[&apos;PID.27&apos;][&apos;PID.27.5&apos;].toString() != &quot;&quot;) { pid[index].veteranStatus.altText = seg[&apos;PID.27&apos;][&apos;PID.27.5&apos;].toString(); }
		if (seg[&apos;PID.27&apos;][&apos;PID.27.6&apos;].toString() != &quot;&quot;) { pid[index].veteranStatus.altCodingSystem = seg[&apos;PID.27&apos;][&apos;PID.27.6&apos;].toString(); }
		if (Object.keys(pid[index].veteranStatus).length == 0) {
			delete pid[index].veteranStatus;
		}

		// PID.28, nationality
		pid[index].nationality = {};
		if (seg[&apos;PID.28&apos;][&apos;PID.28.1&apos;].toString() != &quot;&quot;) { pid[index].nationality.id = seg[&apos;PID.28&apos;][&apos;PID.28.1&apos;].toString(); }
		if (seg[&apos;PID.28&apos;][&apos;PID.28.2&apos;].toString() != &quot;&quot;) { pid[index].nationality.text = seg[&apos;PID.28&apos;][&apos;PID.28.2&apos;].toString(); }
		if (seg[&apos;PID.28&apos;][&apos;PID.28.3&apos;].toString() != &quot;&quot;) { pid[index].nationality.codingSystem = seg[&apos;PID.28&apos;][&apos;PID.28.3&apos;].toString(); }
		if (seg[&apos;PID.28&apos;][&apos;PID.28.4&apos;].toString() != &quot;&quot;) { pid[index].nationality.altId = seg[&apos;PID.28&apos;][&apos;PID.28.4&apos;].toString(); }
		if (seg[&apos;PID.28&apos;][&apos;PID.28.5&apos;].toString() != &quot;&quot;) { pid[index].nationality.altText = seg[&apos;PID.28&apos;][&apos;PID.28.5&apos;].toString(); }
		if (seg[&apos;PID.28&apos;][&apos;PID.28.6&apos;].toString() != &quot;&quot;) { pid[index].nationality.altCodingSystem = seg[&apos;PID.28&apos;][&apos;PID.28.6&apos;].toString(); }
		if (Object.keys(pid[index].nationality).length == 0) {
			delete pid[index].nationality;
		}

		// PID.29, deathDateTime
		if (seg[&apos;PID.29&apos;][&apos;PID.29.1&apos;].toString() != &quot;&quot;) {pid[index].deathDateTime = seg[&apos;PID.29&apos;][&apos;PID.29.1&apos;].toString(); }
		
		// PID.30, deathIndicator
		if (seg[&apos;PID.30&apos;][&apos;PID.30.1&apos;].toString() != &quot;&quot;) {pid[index].deathIndicator = seg[&apos;PID.30&apos;][&apos;PID.30.1&apos;].toString(); }

		// PD1 (PID)
		var pd1;
		var pd1Group = getSegmentsAfter(msg,seg,&apos;PD1&apos;,false,[&apos;PV1&apos;].toString());
		if (pd1Group.length &gt; 0) {
			pid[index].PD1 = [];
			var indexPD1 = 0;
			for each (pd1Seg in pd1Group) {
				pid[index].PD1[indexPD1] = {};

				// PD1.1, livingDependency
				pid[index].PD1[indexPD1].livingDependency = [];
				for each (field in pd1Seg[&apos;PD1.1&apos;]) {
					if (field[&apos;PD1.1.1&apos;].toString() != &quot;&quot;) {
						pid[index].PD1[indexPD1].livingDependency.push(field[&apos;PD1.1.1&apos;].toString());
					}
				}
				if (pid[index].PD1[indexPD1].livingDependency.length == 0) {
					delete pid[index].PD1[indexPD1].livingDependency;
				}
				
				// PD1.2, livingArrangement
				if (pd1Seg[&apos;PD1.2&apos;][&apos;PD1.2.1&apos;].toString() != &quot;&quot;) { pid[index].PD1[indexPD1].livingArrangement = pd1Seg[&apos;PD1.2&apos;][&apos;PD1.2.1&apos;].toString(); }

				// PD1.3, patientPrimaryFacility
				pid[index].PD1[indexPD1].patientPrimaryFacility = [];
				for each (field in pd1Seg[&apos;PD1.3&apos;]) {
					var block = {};
					if (field[&apos;PD1.3.1&apos;].toString() != &quot;&quot;) { block.organizationName = field[&apos;PD1.3.1&apos;].toString(); }
					if (field[&apos;PD1.3.2&apos;].toString() != &quot;&quot;) { block.organizationNameTypeCode = field[&apos;PD1.3.2&apos;].toString(); }
					if (field[&apos;PD1.3.3&apos;].toString() != &quot;&quot;) { block.idNumber = field[&apos;PD1.3.3&apos;].toString(); }
					if (field[&apos;PD1.3.4&apos;].toString() != &quot;&quot;) { block.identifierCheckDigit = field[&apos;PD1.3.4&apos;].toString(); }
					if (field[&apos;PD1.3.5&apos;].toString() != &quot;&quot;) { block.codeIdentifyingCheckDigitScheme = field[&apos;PD1.3.5&apos;].toString(); }
					block.assigningAuthority = {};
					if (field[&apos;PD1.3.6&apos;][&apos;PD1.3.6.1&apos;].toString() != &quot;&quot;) { block.assigningAuthority.namespaceId = field[&apos;PD1.3.6&apos;][&apos;PD1.3.6.1&apos;].toString(); }
					if (field[&apos;PD1.3.6&apos;][&apos;PD1.3.6.2&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalId = field[&apos;PD1.3.6&apos;][&apos;PD1.3.6.2&apos;].toString(); }
					if (field[&apos;PD1.3.6&apos;][&apos;PD1.3.6.3&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalIdType = field[&apos;PD1.3.6&apos;][&apos;PD1.3.6.3&apos;].toString(); }
					if (Object.keys(block.assigningAuthority).length == 0) {
						if (field[&apos;PD1.3.6&apos;].toString() != &quot;&quot;) { block.assigningAuthority.namespaceId = field[&apos;PD1.3.6&apos;].toString(); }
						else delete block.assigningAuthority;
					}
					if (field[&apos;PD1.3.7&apos;].toString() != &quot;&quot;) { block.idTypeCode = field[&apos;PD1.3.7&apos;].toString(); }
					block.assigningFacility = {};
					if (field[&apos;PD1.3.8&apos;][&apos;PD1.3.8.1&apos;].toString() != &quot;&quot;) { block.assigningFacility.namespaceId = field[&apos;PD1.3.8&apos;][&apos;PD1.3.8.1&apos;].toString(); }
					if (field[&apos;PD1.3.8&apos;][&apos;PD1.3.8.2&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalId = field[&apos;PD1.3.8&apos;][&apos;PD1.3.8.2&apos;].toString(); }
					if (field[&apos;PD1.3.8&apos;][&apos;PD1.3.8.3&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalIdType = field[&apos;PD1.3.8&apos;][&apos;PD1.3.8.3&apos;].toString(); }
					if (Object.keys(block.assigningFacility).length == 0) {
						if (field[&apos;PD1.3.8&apos;].toString() != &quot;&quot;) { block.assigningFacility.namespaceId = field[&apos;PD1.3.8&apos;].toString(); }
						else delete block.assigningFacility;
					}
					if (Object.keys(block).length &gt; 0) {
						pid[index].PD1[indexPD1].patientPrimaryFacility.push(block);
					}
				}
				if (pid[index].PD1[indexPD1].patientPrimaryFacility.length == 0) {
					delete pid[index].PD1[indexPD1].patientPrimaryFacility;
				}

				// PD1.4, primaryCareProvider
				pid[index].PD1[indexPD1].primaryCareProvider = [];
				for each (field in pd1Seg[&apos;PD1.4&apos;]) {
					var block = {};
					if (field[&apos;PD1.4.1&apos;].toString() != &quot;&quot;) { block.id = field[&apos;PD1.4.1&apos;].toString(); }
					if (field[&apos;PD1.4.2&apos;].toString() != &quot;&quot;) { block.lastName = field[&apos;PD1.4.2&apos;].toString(); }
					if (field[&apos;PD1.4.3&apos;].toString() != &quot;&quot;) { block.firstName = field[&apos;PD1.4.3&apos;].toString(); }
					if (field[&apos;PD1.4.4&apos;].toString() != &quot;&quot;) { block.middleInitOrName = field[&apos;PD1.4.4&apos;].toString(); }
					if (field[&apos;PD1.4.5&apos;].toString() != &quot;&quot;) { block.suffix = field[&apos;PD1.4.5&apos;].toString(); }
					if (field[&apos;PD1.4.6&apos;].toString() != &quot;&quot;) { block.prefix = field[&apos;PD1.4.6&apos;].toString(); }
					if (field[&apos;PD1.4.7&apos;].toString() != &quot;&quot;) { block.degree = field[&apos;PD1.4.7&apos;].toString(); }
					if (field[&apos;PD1.4.8&apos;].toString() != &quot;&quot;) { block.sourceTable = field[&apos;PD1.4.8&apos;].toString(); }
					block.assigningAuthority = {};
					if (field[&apos;PD1.4.9&apos;][&apos;PD1.4.9.1&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;PD1.4.9&apos;][&apos;PD1.4.9.1&apos;].toString(); }
					if (field[&apos;PD1.4.9&apos;][&apos;PD1.4.9.2&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalId = field[&apos;PD1.4.9&apos;][&apos;PD1.4.9.2&apos;].toString(); }
					if (field[&apos;PD1.4.9&apos;][&apos;PD1.4.9.3&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalIdType = field[&apos;PD1.4.9&apos;][&apos;PD1.4.9.3&apos;].toString(); }
					if (Object.keys(block.assigningAuthority).length == 0) {
						if (field[&apos;PD1.4.9&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;PD1.4.9&apos;].toString(); }
						else delete block.assigningAuthority;
					}
					if (field[&apos;PD1.4.10&apos;].toString() != &quot;&quot;) { block.nameTypeCode = field[&apos;PD1.4.10&apos;].toString(); }
					if (field[&apos;PD1.4.11&apos;].toString() != &quot;&quot;) { block.identifierCheckDigit = field[&apos;PD1.4.11&apos;].toString(); }
					if (field[&apos;PD1.4.12&apos;].toString() != &quot;&quot;) { block.codeIdentifyingCheckDigitScheme = field[&apos;PD1.4.12&apos;].toString(); }
					if (field[&apos;PD1.4.13&apos;].toString() != &quot;&quot;) { block.identifierTypeCode = field[&apos;PD1.4.13&apos;].toString(); }
					block.assigningFacility = {};
					if (field[&apos;PD1.4.14&apos;][&apos;PD1.4.14.1&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;PD1.4.14&apos;][&apos;PD1.4.14.1&apos;].toString(); }
					if (field[&apos;PD1.4.14&apos;][&apos;PD1.4.14.2&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalId = field[&apos;PD1.4.14&apos;][&apos;PD1.4.14.2&apos;].toString(); }
					if (field[&apos;PD1.4.14&apos;][&apos;PD1.4.14.3&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalIdType = field[&apos;PD1.4.14&apos;][&apos;PD1.4.14.3&apos;].toString(); }
					if (Object.keys(block.assigningFacility).length == 0) {
						if (field[&apos;PD1.4.14&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;PD1.4.14&apos;].toString(); }
						else delete block.assigningFacility;
					}
					if (Object.keys(block).length &gt; 0) {
						pid[index].PD1[indexPD1].primaryCareProvider.push(block);
					}
				}
				if (pid[index].PD1[indexPD1].primaryCareProvider.length == 0) {
					delete pid[index].PD1[indexPD1].primaryCareProvider;
				}

				// PD1.5, studentIndicator
				if (pd1Seg[&apos;PD1.5&apos;][&apos;PD1.5.1&apos;].toString() != &quot;&quot;) { pid[index].PD1[indexPD1].studentIndicator = pd1Seg[&apos;PD1.5&apos;][&apos;PD1.5.1&apos;].toString(); }
				
				// PD1.6, handicap
				if (pd1Seg[&apos;PD1.6&apos;][&apos;PD1.6.1&apos;].toString() != &quot;&quot;) { pid[index].PD1[indexPD1].handicap = pd1Seg[&apos;PD1.6&apos;][&apos;PD1.6.1&apos;].toString(); }
				
				// PD1.7, livingWillCode
				if (pd1Seg[&apos;PD1.7&apos;][&apos;PD1.7.1&apos;].toString() != &quot;&quot;) { pid[index].PD1[indexPD1].livingWillCode = pd1Seg[&apos;PD1.7&apos;][&apos;PD1.7.1&apos;].toString(); }
				
				// PD1.8, organDonorCode
				if (pd1Seg[&apos;PD1.8&apos;][&apos;PD1.8.1&apos;].toString() != &quot;&quot;) { pid[index].PD1[indexPD1].organDonorCode = pd1Seg[&apos;PD1.8&apos;][&apos;PD1.8.1&apos;].toString(); }
				
				// PD1.9, separateBill
				if (pd1Seg[&apos;PD1.9&apos;][&apos;PD1.9.1&apos;].toString() != &quot;&quot;) { pid[index].PD1[indexPD1].separateBill = pd1Seg[&apos;PD1.9&apos;][&apos;PD1.9.1&apos;].toString(); }
				
				// PD1.10, duplicatePatient
				pid[index].PD1[indexPD1].duplicatePatient = [];
				for each (field in pd1Seg[&apos;PD1.10&apos;]) {
					var block = {};
					if (field[&apos;PD1.10.1&apos;].toString() != &quot;&quot;) { block.id = field[&apos;PD1.10.1&apos;].toString(); }
					if (field[&apos;PD1.10.2&apos;].toString() != &quot;&quot;) { block.identifierCheckDigit = field[&apos;PD1.10.2&apos;].toString(); }
					if (field[&apos;PD1.10.3&apos;].toString() != &quot;&quot;) { block.codeIdentifyingCheckDigitScheme = field[&apos;PD1.10.3&apos;].toString(); }
					block.assigningAuthority = {};
					if (field[&apos;PD1.10.4&apos;][&apos;PD1.10.4.1&apos;].toString() != &quot;&quot;) { block.assigningAuthority.namespaceId = field[&apos;PD1.10.4&apos;][&apos;PD1.10.4.1&apos;].toString(); }
					if (field[&apos;PD1.10.4&apos;][&apos;PD1.10.4.2&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalId = field[&apos;PD1.10.4&apos;][&apos;PD1.10.4.2&apos;].toString(); }
					if (field[&apos;PD1.10.4&apos;][&apos;PD1.10.4.3&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalIdType = field[&apos;PD1.10.4&apos;][&apos;PD1.10.4.3&apos;].toString(); }
					if (Object.keys(block.assigningAuthority).length == 0) {
						if (field[&apos;PD1.10.4&apos;].toString() != &quot;&quot;) { block.assigningAuthority.namespaceId = field[&apos;PD1.10.4&apos;].toString(); }
						else delete block.assigningAuthority;
					}
					if (field[&apos;PD1.10.5&apos;].toString() != &quot;&quot;) { block.idTypeCode = field[&apos;PD1.10.5&apos;].toString(); }
					block.assigningFacility = {};
					if (field[&apos;PD1.10.6&apos;][&apos;PD1.10.6.1&apos;].toString() != &quot;&quot;) { block.assigningFacility.namespaceId = field[&apos;PD1.10.6&apos;][&apos;PD1.10.6.1&apos;].toString(); }
					if (field[&apos;PD1.10.6&apos;][&apos;PD1.10.6.2&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalId = field[&apos;PD1.10.6&apos;][&apos;PD1.10.6.2&apos;].toString(); }
					if (field[&apos;PD1.10.6&apos;][&apos;PD1.10.6.3&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalIdType = field[&apos;PD1.10.6&apos;][&apos;PD1.10.6.3&apos;].toString(); }
					if (Object.keys(block.assigningFacility).length == 0) {
						if (field[&apos;PD1.10.6&apos;].toString() != &quot;&quot;) { block.assigningFacility.namespaceId = field[&apos;PD1.10.6&apos;].toString(); }
						else delete block.assigningFacility;
					}
					if (Object.keys(block).length &gt; 0) {
						pid[index].PD1[indexPD1].duplicatePatient.push(block);
					}
				}
				if (pid[index].PD1[indexPD1].duplicatePatient.length == 0) {
					delete pid[index].PD1[indexPD1].duplicatePatient;
				}

				// PD1.11, publicityIndicator
				pid[index].PD1[indexPD1].publicityIndicator = {};
				if (pd1Seg[&apos;PD1.11&apos;][&apos;PD1.11.1&apos;].toString() != &quot;&quot;) { pid[index].PD1[indexPD1].publicityIndicator.id = pd1Seg[&apos;PD1.11&apos;][&apos;PD1.11.1&apos;].toString(); }
				if (pd1Seg[&apos;PD1.11&apos;][&apos;PD1.11.2&apos;].toString() != &quot;&quot;) { pid[index].PD1[indexPD1].publicityIndicator.text = pd1Seg[&apos;PD1.11&apos;][&apos;PD1.11.2&apos;].toString(); }
				if (pd1Seg[&apos;PD1.11&apos;][&apos;PD1.11.3&apos;].toString() != &quot;&quot;) { pid[index].PD1[indexPD1].publicityIndicator.codingSystem = pd1Seg[&apos;PD1.11&apos;][&apos;PD1.11.3&apos;].toString(); }
				if (pd1Seg[&apos;PD1.11&apos;][&apos;PD1.11.4&apos;].toString() != &quot;&quot;) { pid[index].PD1[indexPD1].publicityIndicator.altId = pd1Seg[&apos;PD1.11&apos;][&apos;PD1.11.4&apos;].toString(); }
				if (pd1Seg[&apos;PD1.11&apos;][&apos;PD1.11.5&apos;].toString() != &quot;&quot;) { pid[index].PD1[indexPD1].publicityIndicator.altText = pd1Seg[&apos;PD1.11&apos;][&apos;PD1.11.5&apos;].toString(); }
				if (pd1Seg[&apos;PD1.11&apos;][&apos;PD1.11.6&apos;].toString() != &quot;&quot;) { pid[index].PD1[indexPD1].publicityIndicator.altCodingSystem = pd1Seg[&apos;PD1.11&apos;][&apos;PD1.11.6&apos;].toString(); }
				if (Object.keys(pid[index].PD1[indexPD1].publicityIndicator).length == 0) {
					delete pid[index].PD1[indexPD1].publicityIndicator;
				}
				
				// PD1.12, protectionIndicator
				if (pd1Seg[&apos;PD1.12&apos;][&apos;PD1.12.1&apos;].toString() != &quot;&quot;) { pid[index].PD1[indexPD1].protectionIndicator = pd1Seg[&apos;PD1.12&apos;][&apos;PD1.12.1&apos;].toString(); }

				// clean up PD1 and increment index
				if (Object.keys(pid[index].PD1[indexPD1]).length == 0) {
					delete pid[index].PD1[indexPD1];
				} else {
					indexPD1++;
				}
			}
		}

		// NTE
		var nteGroup = getSegmentsAfter(msg,seg,&apos;NTE&apos;,false,[&apos;PV1&apos;].toString());
		if (nteGroup.length &gt; 0) {
			pid[index].NTE = [];
			var indexNTE = 0;
			for each (nteSeg in nteGroup) {
				pid[index].NTE[indexNTE] = {};

				// NTE.1, setId
				if (nteSeg[&apos;NTE.1&apos;][&apos;NTE.1.1&apos;].toString() != &quot;&quot;) { pid[index].NTE[indexNTE].setId = nteSeg[&apos;NTE.1&apos;][&apos;NTE.1.1&apos;].toString(); }

				// NTE.2, sourceOfComment
				if (nteSeg[&apos;NTE.2&apos;][&apos;NTE.2.1&apos;].toString() != &quot;&quot;) { pid[index].NTE[indexNTE].sourceOfComment = nteSeg[&apos;NTE.2&apos;][&apos;NTE.2.1&apos;].toString(); }

				// NTE.3, comment
				pid[index].NTE[indexNTE].comment = [];
				for each (field in nteSeg[&apos;NTE.3&apos;]) {
					var block = {};
					if (field[&apos;NTE.3.1&apos;].toString() != &quot;&quot;) { 
						pid[index].NTE[indexNTE].comment.push(field[&apos;NTE.3.1&apos;].toString());
					}
				}
				if (pid[index].NTE[indexNTE].comment.length == 0) {
					delete pid[index].NTE[indexNTE].comment;
				}

				// clean up NTE and increment index
				if (Object.keys(pid[index].NTE[indexNTE]).length == 0) {
					delete pid[index].NTE[indexNTE];
				} else {
					indexNTE++;
				}
			}
		}

		// clean up PID and increment index
		if (Object.keys(pid[index]).length == 0) {
			delete pid[index];
		} else {
			index++;
		}
	}
}

// Optional: save a copy of the completed PID segment for reference later
//channelMap.put(&quot;pid&quot;, pid); // uncomment to save

// If it has content, add the PID segment to the hl7JSON object
if (pid &amp;&amp; Object.keys(pid).length != 0) {
	var hl7JSON = JSON.parse($(&apos;hl7JSON&apos;));
	hl7JSON.content.PID = pid;
	channelMap.put(&quot;hl7JSON&quot;, JSON.stringify(hl7JSON));
}</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.8.1">
          <name>PV1 (Patient Visit) Segment</name>
          <sequenceNumber>4</sequenceNumber>
          <enabled>true</enabled>
          <script>// PV1 (standalone)
var pv1;
if (msg[&apos;PV1&apos;].length() &gt; 0) {
	pv1 = [];
	var index = 0;
	for each (seg in msg.PV1) {
		pv1[index] = {};

		// PV1.1, setId
		if (seg[&apos;PV1.1&apos;][&apos;PV1.1.1&apos;].toString() != &quot;&quot;) { pv1[index].setId = seg[&apos;PV1.1&apos;][&apos;PV1.1.1&apos;].toString(); }

		// PV1.2, patientClass
		if (seg[&apos;PV1.2&apos;][&apos;PV1.2.1&apos;].toString() != &quot;&quot;) { pv1[index].patientClass = seg[&apos;PV1.2&apos;][&apos;PV1.2.1&apos;].toString(); }

		// PV1.3, assignedPatientLocation
		pv1[index].assignedPatientLocation = {};
		if (seg[&apos;PV1.3&apos;][&apos;PV1.3.1&apos;].toString() != &quot;&quot;) { pv1[index].assignedPatientLocation.pointOfCare = seg[&apos;PV1.3&apos;][&apos;PV1.3.1&apos;].toString(); }
		if (seg[&apos;PV1.3&apos;][&apos;PV1.3.2&apos;].toString() != &quot;&quot;) { pv1[index].assignedPatientLocation.room = seg[&apos;PV1.3&apos;][&apos;PV1.3.2&apos;].toString(); }
		if (seg[&apos;PV1.3&apos;][&apos;PV1.3.3&apos;].toString() != &quot;&quot;) { pv1[index].assignedPatientLocation.bed = seg[&apos;PV1.3&apos;][&apos;PV1.3.3&apos;].toString(); }
		pv1[index].assignedPatientLocation.facility = {};
		if (seg[&apos;PV1.3&apos;][&apos;PV1.3.4&apos;][&apos;PV1.3.4.1&apos;].toString() != &quot;&quot;) { pv1[index].assignedPatientLocation.facility.nameSpaceId =  seg[&apos;PV1.3&apos;][&apos;PV1.3.4&apos;][&apos;PV1.3.4.1&apos;].toString(); }
		if (seg[&apos;PV1.3&apos;][&apos;PV1.3.4&apos;][&apos;PV1.3.4.2&apos;].toString() != &quot;&quot;) { pv1[index].assignedPatientLocation.facility.universalId =  seg[&apos;PV1.3&apos;][&apos;PV1.3.4&apos;][&apos;PV1.3.4.2&apos;].toString(); }
		if (seg[&apos;PV1.3&apos;][&apos;PV1.3.4&apos;][&apos;PV1.3.4.3&apos;].toString() != &quot;&quot;) { pv1[index].assignedPatientLocation.facility.universalIdType =  seg[&apos;PV1.3&apos;][&apos;PV1.3.4&apos;][&apos;PV1.3.4.3&apos;].toString(); }
		if (Object.keys(pv1[index].assignedPatientLocation.facility).length == 0) {
			if (seg[&apos;PV1.3&apos;][&apos;PV1.3.4&apos;].toString() != &quot;&quot;) { pv1[index].assignedPatientLocation.facility.nameSpaceId = seg[&apos;PV1.3&apos;][&apos;PV1.3.4&apos;].toString(); }
			else delete pv1[index].assignedPatientLocation.facility;
		}
		if (seg[&apos;PV1.3&apos;][&apos;PV1.3.5&apos;].toString() != &quot;&quot;) { pv1[index].assignedPatientLocation.locationStatus = seg[&apos;PV1.3&apos;][&apos;PV1.3.5&apos;].toString(); }
		if (seg[&apos;PV1.3&apos;][&apos;PV1.3.6&apos;].toString() != &quot;&quot;) { pv1[index].assignedPatientLocation.personLocationType = seg[&apos;PV1.3&apos;][&apos;PV1.3.6&apos;].toString(); }
		if (seg[&apos;PV1.3&apos;][&apos;PV1.3.7&apos;].toString() != &quot;&quot;) { pv1[index].assignedPatientLocation.building = seg[&apos;PV1.3&apos;][&apos;PV1.3.7&apos;].toString(); }
		if (seg[&apos;PV1.3&apos;][&apos;PV1.3.8&apos;].toString() != &quot;&quot;) { pv1[index].assignedPatientLocation.floor = seg[&apos;PV1.3&apos;][&apos;PV1.3.8&apos;].toString(); }
		if (seg[&apos;PV1.3&apos;][&apos;PV1.3.9&apos;].toString() != &quot;&quot;) { pv1[index].assignedPatientLocation.locationDescription = seg[&apos;PV1.3&apos;][&apos;PV1.3.9&apos;].toString(); }
		if (Object.keys(pv1[index].assignedPatientLocation).length == 0) {
			delete pv1[index].assignedPatientLocation;
		}

		// PV1.4, admissionType
		if (seg[&apos;PV1.4&apos;][&apos;PV1.4.1&apos;].toString() != &quot;&quot;) { pv1[index].admissionType = seg[&apos;PV1.4&apos;][&apos;PV1.4.1&apos;].toString(); }

		// PV1.5, preadmitNumber
		pv1[index].preadmitNumber = {};
		if (seg[&apos;PV1.5&apos;][&apos;PV1.5.1&apos;].toString() != &quot;&quot;) { pv1[index].preadmitNumber.id = seg[&apos;PV1.5&apos;][&apos;PV1.5.1&apos;].toString(); }
		if (seg[&apos;PV1.5&apos;][&apos;PV1.5.2&apos;].toString() != &quot;&quot;) { pv1[index].preadmitNumber.identifierCheckDigit = seg[&apos;PV1.5&apos;][&apos;PV1.5.2&apos;].toString(); }
		if (seg[&apos;PV1.5&apos;][&apos;PV1.5.3&apos;].toString() != &quot;&quot;) { pv1[index].preadmitNumber.codeIdentifyingCheckDigitScheme = seg[&apos;PV1.5&apos;][&apos;PV1.5.3&apos;].toString(); }
		pv1[index].preadmitNumber.assigningAuthority = {};
		if (seg[&apos;PV1.5&apos;][&apos;PV1.5.4&apos;][&apos;PV1.5.4.1&apos;].toString() != &quot;&quot;) { pv1[index].preadmitNumber.assigningAuthority.namespaceId = seg[&apos;PV1.5&apos;][&apos;PV1.5.4&apos;][&apos;PV1.5.4.1&apos;].toString(); }
		if (seg[&apos;PV1.5&apos;][&apos;PV1.5.4&apos;][&apos;PV1.5.4.2&apos;].toString() != &quot;&quot;) { pv1[index].preadmitNumber.assigningAuthority.universalId = seg[&apos;PV1.5&apos;][&apos;PV1.5.4&apos;][&apos;PV1.5.4.2&apos;].toString(); }
		if (seg[&apos;PV1.5&apos;][&apos;PV1.5.4&apos;][&apos;PV1.5.4.3&apos;].toString() != &quot;&quot;) { pv1[index].preadmitNumber.assigningAuthority.universalIdType = seg[&apos;PV1.5&apos;][&apos;PV1.5.4&apos;][&apos;PV1.5.4.3&apos;].toString(); }
		if (Object.keys(pv1[index].preadmitNumber.assigningAuthority).length == 0) {
			if (seg[&apos;PV1.5&apos;][&apos;PV1.5.4&apos;].toString() != &quot;&quot;) { pv1[index].preadmitNumber.assigningAuthority.namespaceId = seg[&apos;PV1.5&apos;][&apos;PV1.5.4&apos;].toString(); }
			else delete pv1[index].preadmitNumber.assigningAuthority;
		}
		if (seg[&apos;PV1.5&apos;][&apos;PV1.5.5&apos;].toString() != &quot;&quot;) { pv1[index].preadmitNumber.idTypeCode = seg[&apos;PV1.5&apos;][&apos;PV1.5.5&apos;].toString(); }
		pv1[index].preadmitNumber.assigningFacility = {};
		if (seg[&apos;PV1.5&apos;][&apos;PV1.5.6&apos;][&apos;PV1.5.6.1&apos;].toString() != &quot;&quot;) { pv1[index].preadmitNumber.assigningFacility.namespaceId = seg[&apos;PV1.5&apos;][&apos;PV1.5.6&apos;][&apos;PV1.5.6.1&apos;].toString(); }
		if (seg[&apos;PV1.5&apos;][&apos;PV1.5.6&apos;][&apos;PV1.5.6.2&apos;].toString() != &quot;&quot;) { pv1[index].preadmitNumber.assigningFacility.universalId = seg[&apos;PV1.5&apos;][&apos;PV1.5.6&apos;][&apos;PV1.5.6.2&apos;].toString(); }
		if (seg[&apos;PV1.5&apos;][&apos;PV1.5.6&apos;][&apos;PV1.5.6.3&apos;].toString() != &quot;&quot;) { pv1[index].preadmitNumber.assigningFacility.universalIdType = seg[&apos;PV1.5&apos;][&apos;PV1.5.6&apos;][&apos;PV1.5.6.3&apos;].toString(); }
		if (Object.keys(pv1[index].preadmitNumber.assigningFacility).length == 0) {
			if (seg[&apos;PV1.5&apos;][&apos;PV1.5.6&apos;].toString() != &quot;&quot;) { pv1[index].preadmitNumber.assigningFacility.namespaceId = seg[&apos;PV1.5&apos;][&apos;PV1.5.6&apos;].toString(); }
			else delete pv1[index].preadmitNumber.assigningFacility;
		}
		if (Object.keys(pv1[index].preadmitNumber).length == 0) {
			delete pv1[index].preadmitNumber;
		}

		// PV1.6, priorPatientLocation
		pv1[index].priorPatientLocation = {};
		if (seg[&apos;PV1.6&apos;][&apos;PV1.6.1&apos;].toString() != &quot;&quot;) { pv1[index].priorPatientLocation.pointOfCare = seg[&apos;PV1.6&apos;][&apos;PV1.6.1&apos;].toString(); }
		if (seg[&apos;PV1.6&apos;][&apos;PV1.6.2&apos;].toString() != &quot;&quot;) { pv1[index].priorPatientLocation.room = seg[&apos;PV1.6&apos;][&apos;PV1.6.2&apos;].toString(); }
		if (seg[&apos;PV1.6&apos;][&apos;PV1.6.3&apos;].toString() != &quot;&quot;) { pv1[index].priorPatientLocation.bed = seg[&apos;PV1.6&apos;][&apos;PV1.6.3&apos;].toString(); }
		pv1[index].priorPatientLocation.facility = {};
		if (seg[&apos;PV1.6&apos;][&apos;PV1.6.4&apos;][&apos;PV1.6.4.1&apos;].toString() != &quot;&quot;) { pv1[index].priorPatientLocation.facility.nameSpaceId =  seg[&apos;PV1.6&apos;][&apos;PV1.6.4&apos;][&apos;PV1.6.4.1&apos;].toString(); }
		if (seg[&apos;PV1.6&apos;][&apos;PV1.6.4&apos;][&apos;PV1.6.4.2&apos;].toString() != &quot;&quot;) { pv1[index].priorPatientLocation.facility.universalId =  seg[&apos;PV1.6&apos;][&apos;PV1.6.4&apos;][&apos;PV1.6.4.2&apos;].toString(); }
		if (seg[&apos;PV1.6&apos;][&apos;PV1.6.4&apos;][&apos;PV1.6.4.3&apos;].toString() != &quot;&quot;) { pv1[index].priorPatientLocation.facility.universalIdType =  seg[&apos;PV1.6&apos;][&apos;PV1.6.4&apos;][&apos;PV1.6.4.3&apos;].toString(); }
		if (Object.keys(pv1[index].priorPatientLocation.facility).length == 0) {
			if (seg[&apos;PV1.6&apos;][&apos;PV1.6.4&apos;].toString() != &quot;&quot;) { pv1[index].priorPatientLocation.facility.nameSpaceId = seg[&apos;PV1.6&apos;][&apos;PV1.6.4&apos;].toString(); }
			else delete pv1[index].priorPatientLocation.facility;
		}
		if (seg[&apos;PV1.6&apos;][&apos;PV1.6.5&apos;].toString() != &quot;&quot;) { pv1[index].priorPatientLocation.locationStatus = seg[&apos;PV1.6&apos;][&apos;PV1.6.5&apos;].toString(); }
		if (seg[&apos;PV1.6&apos;][&apos;PV1.6.6&apos;].toString() != &quot;&quot;) { pv1[index].priorPatientLocation.personLocationType = seg[&apos;PV1.6&apos;][&apos;PV1.6.6&apos;].toString(); }
		if (seg[&apos;PV1.6&apos;][&apos;PV1.6.7&apos;].toString() != &quot;&quot;) { pv1[index].priorPatientLocation.building = seg[&apos;PV1.6&apos;][&apos;PV1.6.7&apos;].toString(); }
		if (seg[&apos;PV1.6&apos;][&apos;PV1.6.8&apos;].toString() != &quot;&quot;) { pv1[index].priorPatientLocation.floor = seg[&apos;PV1.6&apos;][&apos;PV1.6.8&apos;].toString(); }
		if (seg[&apos;PV1.6&apos;][&apos;PV1.6.9&apos;].toString() != &quot;&quot;) { pv1[index].priorPatientLocation.locationDescription = seg[&apos;PV1.6&apos;][&apos;PV1.6.9&apos;].toString(); }
		if (Object.keys(pv1[index].priorPatientLocation).length == 0) {
			delete pv1[index].priorPatientLocation;
		}

		// PV1.7, attendingDoctor
		pv1[index].attendingDoctor = [];
		for each (field in seg[&apos;PV1.7&apos;]) {
			var block = {};
			if (field[&apos;PV1.7.1&apos;].toString() != &quot;&quot;) { block.id = field[&apos;PV1.7.1&apos;].toString(); }
			if (field[&apos;PV1.7.2&apos;].toString() != &quot;&quot;) { block.lastName = field[&apos;PV1.7.2&apos;].toString(); }
			if (field[&apos;PV1.7.3&apos;].toString() != &quot;&quot;) { block.firstName = field[&apos;PV1.7.3&apos;].toString(); }
			if (field[&apos;PV1.7.4&apos;].toString() != &quot;&quot;) { block.middleInitOrName = field[&apos;PV1.7.4&apos;].toString(); }
			if (field[&apos;PV1.7.5&apos;].toString() != &quot;&quot;) { block.suffix = field[&apos;PV1.7.5&apos;].toString(); }
			if (field[&apos;PV1.7.6&apos;].toString() != &quot;&quot;) { block.prefix = field[&apos;PV1.7.6&apos;].toString(); }
			if (field[&apos;PV1.7.7&apos;].toString() != &quot;&quot;) { block.degree = field[&apos;PV1.7.7&apos;].toString(); }
			if (field[&apos;PV1.7.8&apos;].toString() != &quot;&quot;) { block.sourceTable = field[&apos;PV1.7.8&apos;].toString(); }
			block.assigningAuthority = {};
			if (field[&apos;PV1.7.9&apos;][&apos;PV1.7.9.1&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;PV1.7.9&apos;][&apos;PV1.7.9.1&apos;].toString(); }
			if (field[&apos;PV1.7.9&apos;][&apos;PV1.7.9.2&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalId = field[&apos;PV1.7.9&apos;][&apos;PV1.7.9.2&apos;].toString(); }
			if (field[&apos;PV1.7.9&apos;][&apos;PV1.7.9.3&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalIdType = field[&apos;PV1.7.9&apos;][&apos;PV1.7.9.3&apos;].toString(); }
			if (Object.keys(block.assigningAuthority).length == 0) {
				if (field[&apos;PV1.7.9&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;PV1.7.9&apos;].toString(); }
				else delete block.assigningAuthority;
			}
			if (field[&apos;PV1.7.10&apos;].toString() != &quot;&quot;) { block.nameTypeCode = field[&apos;PV1.7.10&apos;].toString(); }
			if (field[&apos;PV1.7.11&apos;].toString() != &quot;&quot;) { block.identifierCheckDigit = field[&apos;PV1.7.11&apos;].toString(); }
			if (field[&apos;PV1.7.12&apos;].toString() != &quot;&quot;) { block.codeIdentifyingCheckDigitScheme = field[&apos;PV1.7.12&apos;].toString(); }
			if (field[&apos;PV1.7.13&apos;].toString() != &quot;&quot;) { block.identifierTypeCode = field[&apos;PV1.7.13&apos;].toString(); }
			block.assigningFacility = {};
			if (field[&apos;PV1.7.14&apos;][&apos;PV1.7.14.1&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;PV1.7.14&apos;][&apos;PV1.7.14.1&apos;].toString(); }
			if (field[&apos;PV1.7.14&apos;][&apos;PV1.7.14.2&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalId = field[&apos;PV1.7.14&apos;][&apos;PV1.7.14.2&apos;].toString(); }
			if (field[&apos;PV1.7.14&apos;][&apos;PV1.7.14.3&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalIdType = field[&apos;PV1.7.14&apos;][&apos;PV1.7.14.3&apos;].toString(); }
			if (Object.keys(block.assigningFacility).length == 0) {
				if (field[&apos;PV1.7.14&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;PV1.7.14&apos;].toString(); }
				else delete block.assigningFacility;
			}
			if (Object.keys(block).length &gt; 0) {
				pv1[index].attendingDoctor.push(block);
			}
		}
		if (pv1[index].attendingDoctor.length == 0) {
			delete pv1[index].attendingDoctor;
		}

		// PV1.8, referringDoctor
		pv1[index].referringDoctor = [];
		for each (field in seg[&apos;PV1.8&apos;]) {
			var block = {};
			if (field[&apos;PV1.8.1&apos;].toString() != &quot;&quot;) { block.id = field[&apos;PV1.8.1&apos;].toString(); }
			if (field[&apos;PV1.8.2&apos;].toString() != &quot;&quot;) { block.lastName = field[&apos;PV1.8.2&apos;].toString(); }
			if (field[&apos;PV1.8.3&apos;].toString() != &quot;&quot;) { block.firstName = field[&apos;PV1.8.3&apos;].toString(); }
			if (field[&apos;PV1.8.4&apos;].toString() != &quot;&quot;) { block.middleInitOrName = field[&apos;PV1.8.4&apos;].toString(); }
			if (field[&apos;PV1.8.5&apos;].toString() != &quot;&quot;) { block.suffix = field[&apos;PV1.8.5&apos;].toString(); }
			if (field[&apos;PV1.8.6&apos;].toString() != &quot;&quot;) { block.prefix = field[&apos;PV1.8.6&apos;].toString(); }
			if (field[&apos;PV1.8.7&apos;].toString() != &quot;&quot;) { block.degree = field[&apos;PV1.8.7&apos;].toString(); }
			if (field[&apos;PV1.8.8&apos;].toString() != &quot;&quot;) { block.sourceTable = field[&apos;PV1.8.8&apos;].toString(); }
			block.assigningAuthority = {};
			if (field[&apos;PV1.8.9&apos;][&apos;PV1.8.9.1&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;PV1.8.9&apos;][&apos;PV1.8.9.1&apos;].toString(); }
			if (field[&apos;PV1.8.9&apos;][&apos;PV1.8.9.2&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalId = field[&apos;PV1.8.9&apos;][&apos;PV1.8.9.2&apos;].toString(); }
			if (field[&apos;PV1.8.9&apos;][&apos;PV1.8.9.3&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalIdType = field[&apos;PV1.8.9&apos;][&apos;PV1.8.9.3&apos;].toString(); }
			if (Object.keys(block.assigningAuthority).length == 0) {
				if (field[&apos;PV1.8.9&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;PV1.8.9&apos;].toString(); }
				else delete block.assigningAuthority;
			}
			if (field[&apos;PV1.8.10&apos;].toString() != &quot;&quot;) { block.nameTypeCode = field[&apos;PV1.8.10&apos;].toString(); }
			if (field[&apos;PV1.8.11&apos;].toString() != &quot;&quot;) { block.identifierCheckDigit = field[&apos;PV1.8.11&apos;].toString(); }
			if (field[&apos;PV1.8.12&apos;].toString() != &quot;&quot;) { block.codeIdentifyingCheckDigitScheme = field[&apos;PV1.8.12&apos;].toString(); }
			if (field[&apos;PV1.8.13&apos;].toString() != &quot;&quot;) { block.identifierTypeCode = field[&apos;PV1.8.13&apos;].toString(); }
			block.assigningFacility = {};
			if (field[&apos;PV1.8.14&apos;][&apos;PV1.8.14.1&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;PV1.8.14&apos;][&apos;PV1.8.14.1&apos;].toString(); }
			if (field[&apos;PV1.8.14&apos;][&apos;PV1.8.14.2&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalId = field[&apos;PV1.8.14&apos;][&apos;PV1.8.14.2&apos;].toString(); }
			if (field[&apos;PV1.8.14&apos;][&apos;PV1.8.14.3&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalIdType = field[&apos;PV1.8.14&apos;][&apos;PV1.8.14.3&apos;].toString(); }
			if (Object.keys(block.assigningFacility).length == 0) {
				if (field[&apos;PV1.8.14&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;PV1.8.14&apos;].toString(); }
				else delete block.assigningFacility;
			}
			if (Object.keys(block).length &gt; 0) {
				pv1[index].referringDoctor.push(block);
			}
		}
		if (pv1[index].referringDoctor.length == 0) {
			delete pv1[index].referringDoctor;
		}
		
		// PV1.9, consultingDoctor
		pv1[index].consultingDoctor = [];
		for each (field in seg[&apos;PV1.9&apos;]) {
			var block = {};
			if (field[&apos;PV1.9.1&apos;].toString() != &quot;&quot;) { block.id = field[&apos;PV1.9.1&apos;].toString(); }
			if (field[&apos;PV1.9.2&apos;].toString() != &quot;&quot;) { block.lastName = field[&apos;PV1.9.2&apos;].toString(); }
			if (field[&apos;PV1.9.3&apos;].toString() != &quot;&quot;) { block.firstName = field[&apos;PV1.9.3&apos;].toString(); }
			if (field[&apos;PV1.9.4&apos;].toString() != &quot;&quot;) { block.middleInitOrName = field[&apos;PV1.9.4&apos;].toString(); }
			if (field[&apos;PV1.9.5&apos;].toString() != &quot;&quot;) { block.suffix = field[&apos;PV1.9.5&apos;].toString(); }
			if (field[&apos;PV1.9.6&apos;].toString() != &quot;&quot;) { block.prefix = field[&apos;PV1.9.6&apos;].toString(); }
			if (field[&apos;PV1.9.7&apos;].toString() != &quot;&quot;) { block.degree = field[&apos;PV1.9.7&apos;].toString(); }
			if (field[&apos;PV1.9.8&apos;].toString() != &quot;&quot;) { block.sourceTable = field[&apos;PV1.9.8&apos;].toString(); }
			block.assigningAuthority = {};
			if (field[&apos;PV1.9.9&apos;][&apos;PV1.9.9.1&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;PV1.9.9&apos;][&apos;PV1.9.9.1&apos;].toString(); }
			if (field[&apos;PV1.9.9&apos;][&apos;PV1.9.9.2&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalId = field[&apos;PV1.9.9&apos;][&apos;PV1.9.9.2&apos;].toString(); }
			if (field[&apos;PV1.9.9&apos;][&apos;PV1.9.9.3&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalIdType = field[&apos;PV1.9.9&apos;][&apos;PV1.9.9.3&apos;].toString(); }
			if (Object.keys(block.assigningAuthority).length == 0) {
				if (field[&apos;PV1.9.9&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;PV1.9.9&apos;].toString(); }
				else delete block.assigningAuthority;
			}
			if (field[&apos;PV1.9.10&apos;].toString() != &quot;&quot;) { block.nameTypeCode = field[&apos;PV1.9.10&apos;].toString(); }
			if (field[&apos;PV1.9.11&apos;].toString() != &quot;&quot;) { block.identifierCheckDigit = field[&apos;PV1.9.11&apos;].toString(); }
			if (field[&apos;PV1.9.12&apos;].toString() != &quot;&quot;) { block.codeIdentifyingCheckDigitScheme = field[&apos;PV1.9.12&apos;].toString(); }
			if (field[&apos;PV1.9.13&apos;].toString() != &quot;&quot;) { block.identifierTypeCode = field[&apos;PV1.9.13&apos;].toString(); }
			block.assigningFacility = {};
			if (field[&apos;PV1.9.14&apos;][&apos;PV1.9.14.1&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;PV1.9.14&apos;][&apos;PV1.9.14.1&apos;].toString(); }
			if (field[&apos;PV1.9.14&apos;][&apos;PV1.9.14.2&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalId = field[&apos;PV1.9.14&apos;][&apos;PV1.9.14.2&apos;].toString(); }
			if (field[&apos;PV1.9.14&apos;][&apos;PV1.9.14.3&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalIdType = field[&apos;PV1.9.14&apos;][&apos;PV1.9.14.3&apos;].toString(); }
			if (Object.keys(block.assigningFacility).length == 0) {
				if (field[&apos;PV1.9.14&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;PV1.9.14&apos;].toString(); }
				else delete block.assigningFacility;
			}
			if (Object.keys(block).length &gt; 0) {
				pv1[index].consultingDoctor.push(block);
			}
		}
		if (pv1[index].consultingDoctor.length == 0) {
			delete pv1[index].consultingDoctor;
		}
		
		// PV1.10, hospitalService
		if (seg[&apos;PV1.10&apos;][&apos;PV1.10.1&apos;].toString() != &quot;&quot;) { pv1[index].hospitalService = seg[&apos;PV1.10&apos;][&apos;PV1.10.1&apos;].toString(); }

		// PV1.11, temporaryLocation
		pv1[index].temporaryLocation = {};
		if (seg[&apos;PV1.11&apos;][&apos;PV1.11.1&apos;].toString() != &quot;&quot;) { pv1[index].temporaryLocation.pointOfCare = seg[&apos;PV1.11&apos;][&apos;PV1.11.1&apos;].toString(); }
		if (seg[&apos;PV1.11&apos;][&apos;PV1.11.2&apos;].toString() != &quot;&quot;) { pv1[index].temporaryLocation.room = seg[&apos;PV1.11&apos;][&apos;PV1.11.2&apos;].toString(); }
		if (seg[&apos;PV1.11&apos;][&apos;PV1.11.3&apos;].toString() != &quot;&quot;) { pv1[index].temporaryLocation.bed = seg[&apos;PV1.11&apos;][&apos;PV1.11.3&apos;].toString(); }
		pv1[index].temporaryLocation.facility = {};
		if (seg[&apos;PV1.11&apos;][&apos;PV1.11.4&apos;][&apos;PV1.11.4.1&apos;].toString() != &quot;&quot;) { pv1[index].temporaryLocation.facility.nameSpaceId =  seg[&apos;PV1.11&apos;][&apos;PV1.11.4&apos;][&apos;PV1.11.4.1&apos;].toString(); }
		if (seg[&apos;PV1.11&apos;][&apos;PV1.11.4&apos;][&apos;PV1.11.4.2&apos;].toString() != &quot;&quot;) { pv1[index].temporaryLocation.facility.universalId =  seg[&apos;PV1.11&apos;][&apos;PV1.11.4&apos;][&apos;PV1.11.4.2&apos;].toString(); }
		if (seg[&apos;PV1.11&apos;][&apos;PV1.11.4&apos;][&apos;PV1.11.4.3&apos;].toString() != &quot;&quot;) { pv1[index].temporaryLocation.facility.universalIdType =  seg[&apos;PV1.11&apos;][&apos;PV1.11.4&apos;][&apos;PV1.11.4.3&apos;].toString(); }
		if (Object.keys(pv1[index].temporaryLocation.facility).length == 0) {
			if (seg[&apos;PV1.11&apos;][&apos;PV1.11.4&apos;].toString() != &quot;&quot;) { pv1[index].temporaryLocation.facility.nameSpaceId = seg[&apos;PV1.11&apos;][&apos;PV1.11.4&apos;].toString(); }
			else delete pv1[index].temporaryLocation.facility;
		}
		if (seg[&apos;PV1.11&apos;][&apos;PV1.11.5&apos;].toString() != &quot;&quot;) { pv1[index].temporaryLocation.locationStatus = seg[&apos;PV1.11&apos;][&apos;PV1.11.5&apos;].toString(); }
		if (seg[&apos;PV1.11&apos;][&apos;PV1.11.6&apos;].toString() != &quot;&quot;) { pv1[index].temporaryLocation.personLocationType = seg[&apos;PV1.11&apos;][&apos;PV1.11.6&apos;].toString(); }
		if (seg[&apos;PV1.11&apos;][&apos;PV1.11.7&apos;].toString() != &quot;&quot;) { pv1[index].temporaryLocation.building = seg[&apos;PV1.11&apos;][&apos;PV1.11.7&apos;].toString(); }
		if (seg[&apos;PV1.11&apos;][&apos;PV1.11.8&apos;].toString() != &quot;&quot;) { pv1[index].temporaryLocation.floor = seg[&apos;PV1.11&apos;][&apos;PV1.11.8&apos;].toString(); }
		if (seg[&apos;PV1.11&apos;][&apos;PV1.11.9&apos;].toString() != &quot;&quot;) { pv1[index].temporaryLocation.locationDescription = seg[&apos;PV1.11&apos;][&apos;PV1.11.9&apos;].toString(); }
		if (Object.keys(pv1[index].temporaryLocation).length == 0) {
			delete pv1[index].temporaryLocation;
		}

		// PV1.12, preadmitTestIndicator
		if (seg[&apos;PV1.12&apos;][&apos;PV1.12.1&apos;].toString() != &quot;&quot;) { pv1[index].preadmitTestIndicator = seg[&apos;PV1.12&apos;][&apos;PV1.12.1&apos;].toString(); }

		// PV1.13, readmissionIndicator
		if (seg[&apos;PV1.13&apos;][&apos;PV1.13.1&apos;].toString() != &quot;&quot;) { pv1[index].readmissionIndicator = seg[&apos;PV1.13&apos;][&apos;PV1.13.1&apos;].toString(); }

		// PV1.14, admitSource
		if (seg[&apos;PV1.14&apos;][&apos;PV1.14.1&apos;].toString() != &quot;&quot;) { pv1[index].admitSource = seg[&apos;PV1.14&apos;][&apos;PV1.14.1&apos;].toString(); }

		// PV1.15, ambulatoryStatus
		pv1[index].ambulatoryStatus = [];
		for each (field in seg[&apos;PV1.15&apos;]) {
			if (field[&apos;PV1.15.1&apos;].toString() != &quot;&quot;) {
				pv1[index].ambulatoryStatus.push(field[&apos;PV1.15.1&apos;].toString());
			}
		}
		if (pv1[index].ambulatoryStatus.length == 0){
			delete pv1[index].ambulatoryStatus;
		}

		// PV1.16, vipIndicator
		if (seg[&apos;PV1.16&apos;][&apos;PV1.16.1&apos;].toString() != &quot;&quot;) { pv1[index].vipIndicator = seg[&apos;PV1.16&apos;][&apos;PV1.16.1&apos;].toString(); }

		// PV1.17, admittingDoctor
		pv1[index].admittingDoctor = [];
		for each (field in seg[&apos;PV1.17&apos;]) {
			var block = {};
			if (field[&apos;PV1.17.1&apos;].toString() != &quot;&quot;) { block.id = field[&apos;PV1.17.1&apos;].toString(); }
			if (field[&apos;PV1.17.2&apos;].toString() != &quot;&quot;) { block.lastName = field[&apos;PV1.17.2&apos;].toString(); }
			if (field[&apos;PV1.17.3&apos;].toString() != &quot;&quot;) { block.firstName = field[&apos;PV1.17.3&apos;].toString(); }
			if (field[&apos;PV1.17.4&apos;].toString() != &quot;&quot;) { block.middleInitOrName = field[&apos;PV1.17.4&apos;].toString(); }
			if (field[&apos;PV1.17.5&apos;].toString() != &quot;&quot;) { block.suffix = field[&apos;PV1.17.5&apos;].toString(); }
			if (field[&apos;PV1.17.6&apos;].toString() != &quot;&quot;) { block.prefix = field[&apos;PV1.17.6&apos;].toString(); }
			if (field[&apos;PV1.17.7&apos;].toString() != &quot;&quot;) { block.degree = field[&apos;PV1.17.7&apos;].toString(); }
			if (field[&apos;PV1.17.8&apos;].toString() != &quot;&quot;) { block.sourceTable = field[&apos;PV1.17.8&apos;].toString(); }
			block.assigningAuthority = {};
			if (field[&apos;PV1.17.9&apos;][&apos;PV1.17.9.1&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;PV1.17.9&apos;][&apos;PV1.17.9.1&apos;].toString(); }
			if (field[&apos;PV1.17.9&apos;][&apos;PV1.17.9.2&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalId = field[&apos;PV1.17.9&apos;][&apos;PV1.17.9.2&apos;].toString(); }
			if (field[&apos;PV1.17.9&apos;][&apos;PV1.17.9.3&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalIdType = field[&apos;PV1.17.9&apos;][&apos;PV1.17.9.3&apos;].toString(); }
			if (Object.keys(block.assigningAuthority).length == 0) {
				if (field[&apos;PV1.17.9&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;PV1.17.9&apos;].toString(); }
				else delete block.assigningAuthority;
			}
			if (field[&apos;PV1.17.10&apos;].toString() != &quot;&quot;) { block.nameTypeCode = field[&apos;PV1.17.10&apos;].toString(); }
			if (field[&apos;PV1.17.11&apos;].toString() != &quot;&quot;) { block.identifierCheckDigit = field[&apos;PV1.17.11&apos;].toString(); }
			if (field[&apos;PV1.17.12&apos;].toString() != &quot;&quot;) { block.codeIdentifyingCheckDigitScheme = field[&apos;PV1.17.12&apos;].toString(); }
			if (field[&apos;PV1.17.13&apos;].toString() != &quot;&quot;) { block.identifierTypeCode = field[&apos;PV1.17.13&apos;].toString(); }
			block.assigningFacility = {};
			if (field[&apos;PV1.17.14&apos;][&apos;PV1.17.14.1&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;PV1.17.14&apos;][&apos;PV1.17.14.1&apos;].toString(); }
			if (field[&apos;PV1.17.14&apos;][&apos;PV1.17.14.2&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalId = field[&apos;PV1.17.14&apos;][&apos;PV1.17.14.2&apos;].toString(); }
			if (field[&apos;PV1.17.14&apos;][&apos;PV1.17.14.3&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalIdType = field[&apos;PV1.17.14&apos;][&apos;PV1.17.14.3&apos;].toString(); }
			if (Object.keys(block.assigningFacility).length == 0) {
				if (field[&apos;PV1.17.14&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;PV1.17.14&apos;].toString(); }
				else delete block.assigningFacility;
			}
			if (Object.keys(block).length &gt; 0) {
				pv1[index].admittingDoctor.push(block);
			}
		}
		if (pv1[index].admittingDoctor.length == 0) {
			delete pv1[index].admittingDoctor;
		}
		
		// PV1.18, patientType
		if (seg[&apos;PV1.18&apos;][&apos;PV1.18.1&apos;].toString() != &quot;&quot;) { pv1[index].patientType = seg[&apos;PV1.18&apos;][&apos;PV1.18.1&apos;].toString(); }

		// PV1.19, visitNumber
		pv1[index].visitNumber = {};
		if (seg[&apos;PV1.19&apos;][&apos;PV1.19.1&apos;].toString() != &quot;&quot;) { pv1[index].visitNumber.id = seg[&apos;PV1.19&apos;][&apos;PV1.19.1&apos;].toString(); }
		if (seg[&apos;PV1.19&apos;][&apos;PV1.19.2&apos;].toString() != &quot;&quot;) { pv1[index].visitNumber.identifierCheckDigit = seg[&apos;PV1.19&apos;][&apos;PV1.19.2&apos;].toString(); }
		if (seg[&apos;PV1.19&apos;][&apos;PV1.19.3&apos;].toString() != &quot;&quot;) { pv1[index].visitNumber.codeIdentifyingCheckDigitScheme = seg[&apos;PV1.19&apos;][&apos;PV1.19.3&apos;].toString(); }
		pv1[index].visitNumber.assigningAuthority = {};
		if (seg[&apos;PV1.19&apos;][&apos;PV1.19.4&apos;][&apos;PV1.19.4.1&apos;].toString() != &quot;&quot;) { pv1[index].visitNumber.assigningAuthority.namespaceId = seg[&apos;PV1.19&apos;][&apos;PV1.19.4&apos;][&apos;PV1.19.4.1&apos;].toString(); }
		if (seg[&apos;PV1.19&apos;][&apos;PV1.19.4&apos;][&apos;PV1.19.4.2&apos;].toString() != &quot;&quot;) { pv1[index].visitNumber.assigningAuthority.universalId = seg[&apos;PV1.19&apos;][&apos;PV1.19.4&apos;][&apos;PV1.19.4.2&apos;].toString(); }
		if (seg[&apos;PV1.19&apos;][&apos;PV1.19.4&apos;][&apos;PV1.19.4.3&apos;].toString() != &quot;&quot;) { pv1[index].visitNumber.assigningAuthority.universalIdType = seg[&apos;PV1.19&apos;][&apos;PV1.19.4&apos;][&apos;PV1.19.4.3&apos;].toString(); }
		if (Object.keys(pv1[index].visitNumber.assigningAuthority).length == 0) {
			if (seg[&apos;PV1.19&apos;][&apos;PV1.19.4&apos;].toString() != &quot;&quot;) { pv1[index].visitNumber.assigningAuthority.namespaceId = seg[&apos;PV1.19&apos;][&apos;PV1.19.4&apos;].toString(); }
			else delete pv1[index].visitNumber.assigningAuthority;
		}
		if (seg[&apos;PV1.19&apos;][&apos;PV1.19.5&apos;].toString() != &quot;&quot;) { pv1[index].visitNumber.idTypeCode = seg[&apos;PV1.19&apos;][&apos;PV1.19.5&apos;].toString(); }
		pv1[index].visitNumber.assigningFacility = {};
		if (seg[&apos;PV1.19&apos;][&apos;PV1.19.6&apos;][&apos;PV1.19.6.1&apos;].toString() != &quot;&quot;) { pv1[index].visitNumber.assigningFacility.namespaceId = seg[&apos;PV1.19&apos;][&apos;PV1.19.6&apos;][&apos;PV1.19.6.1&apos;].toString(); }
		if (seg[&apos;PV1.19&apos;][&apos;PV1.19.6&apos;][&apos;PV1.19.6.2&apos;].toString() != &quot;&quot;) { pv1[index].visitNumber.assigningFacility.universalId = seg[&apos;PV1.19&apos;][&apos;PV1.19.6&apos;][&apos;PV1.19.6.2&apos;].toString(); }
		if (seg[&apos;PV1.19&apos;][&apos;PV1.19.6&apos;][&apos;PV1.19.6.3&apos;].toString() != &quot;&quot;) { pv1[index].visitNumber.assigningFacility.universalIdType = seg[&apos;PV1.19&apos;][&apos;PV1.19.6&apos;][&apos;PV1.19.6.3&apos;].toString(); }
		if (Object.keys(pv1[index].visitNumber.assigningFacility).length == 0) {
			if (seg[&apos;PV1.19&apos;][&apos;PV1.19.6&apos;].toString() != &quot;&quot;) { pv1[index].visitNumber.assigningFacility.namespaceId = seg[&apos;PV1.19&apos;][&apos;PV1.19.6&apos;].toString(); }
			else delete pv1[index].visitNumber.assigningFacility;
		}
		if (Object.keys(pv1[index].visitNumber).length == 0) {
			delete pv1[index].visitNumber;
		}
		
		// PV1.20, financialClass
		pv1[index].financialClass = {};
		if (seg[&apos;PV1.20&apos;][&apos;PV1.20.1&apos;].toString() != &quot;&quot;) {pv1[index].financialClass.financialClass = seg[&apos;PV1.20&apos;][&apos;PV1.20.1&apos;].toString(); }
		if (seg[&apos;PV1.20&apos;][&apos;PV1.20.2&apos;].toString() != &quot;&quot;) {pv1[index].financialClass.effectiveDate = seg[&apos;PV1.20&apos;][&apos;PV1.20.2&apos;].toString(); }
		if (Object.keys(pv1[index].financialClass).length == 0) {
			delete pv1[index].financialClass;
		}

		// PV1.21, chargePriceIndicator
		if (seg[&apos;PV1.21&apos;][&apos;PV1.21.1&apos;].toString() != &quot;&quot;) { pv1[index].chargePriceIndicator = seg[&apos;PV1.21&apos;][&apos;PV1.21.1&apos;].toString(); }

		// PV1.22, courtesyCode
		if (seg[&apos;PV1.22&apos;][&apos;PV1.22.1&apos;].toString() != &quot;&quot;) { pv1[index].courtesyCode = seg[&apos;PV1.22&apos;][&apos;PV1.22.1&apos;].toString(); }

		// PV1.23, creditRating
		if (seg[&apos;PV1.23&apos;][&apos;PV1.23.1&apos;].toString() != &quot;&quot;) { pv1[index].creditRating = seg[&apos;PV1.23&apos;][&apos;PV1.23.1&apos;].toString(); }

		// PV1.24, contractCode
		pv1[index].contractCode = [];
		for each (field in seg[&apos;PV1.24&apos;]) {
			if (field[&apos;PV1.24.1&apos;].toString() != &quot;&quot;) {
				pv1[index].contractCode.push(field[&apos;PV1.24.1&apos;].toString());
			}
		}
		if (pv1[index].contractCode.length == 0) {
			delete pv1[index].contractCode;
		}

		// PV1.25, contractEffectiveDate
		pv1[index].contractEffectiveDate = [];
		for each (field in seg[&apos;PV1.25&apos;]) {
			if (field[&apos;PV1.25.1&apos;].toString() != &quot;&quot;) {
				pv1[index].contractEffectiveDate.push(field[&apos;PV1.25.1&apos;].toString());
			}
		}
		if (pv1[index].contractEffectiveDate.length == 0) {
			delete pv1[index].contractEffectiveDate;
		}

		// PV1.26, contractAmount
		pv1[index].contractAmount = [];
		for each (field in seg[&apos;PV1.26&apos;]) {
			if (field[&apos;PV1.26.1&apos;].toString() != &quot;&quot;) {
				pv1[index].contractAmount.push(field[&apos;PV1.26.1&apos;].toString());
			}
		}
		if (pv1[index].contractAmount.length == 0) {
			delete pv1[index].contractAmount;
		}

		// PV1.27, contractPeriod
		pv1[index].contractPeriod = [];
		for each (field in seg[&apos;PV1.27&apos;]) {
			if (field[&apos;PV1.27.1&apos;].toString() != &quot;&quot;) {
				pv1[index].contractPeriod.push(field[&apos;PV1.27.1&apos;].toString());
			}
		}
		if (pv1[index].contractPeriod.length == 0) {
			delete pv1[index].contractPeriod;
		}

		// PV1.28, interestCode
		if (seg[&apos;PV1.28&apos;][&apos;PV1.28.1&apos;].toString() != &quot;&quot;) { pv1[index].interestCode = seg[&apos;PV1.28&apos;][&apos;PV1.28.1&apos;].toString(); }

		// PV1.29, transferToBadDebtCode
		if (seg[&apos;PV1.29&apos;][&apos;PV1.29.1&apos;].toString() != &quot;&quot;) { pv1[index].transferToBadDebtCode = seg[&apos;PV1.29&apos;][&apos;PV1.29.1&apos;].toString(); }

		// PV1.30, transferToBadDebtDate
		if (seg[&apos;PV1.30&apos;][&apos;PV1.30.1&apos;].toString() != &quot;&quot;) { pv1[index].transferToBadDebtDate = seg[&apos;PV1.30&apos;][&apos;PV1.30.1&apos;].toString(); }

		// PV1.31, badDebtAgencyCode
		if (seg[&apos;PV1.31&apos;][&apos;PV1.31.1&apos;].toString() != &quot;&quot;) { pv1[index].badDebtAgencyCode = seg[&apos;PV1.31&apos;][&apos;PV1.31.1&apos;].toString(); }

		// PV1.32, badDebtTransferAmount
		if (seg[&apos;PV1.32&apos;][&apos;PV1.32.1&apos;].toString() != &quot;&quot;) { pv1[index].badDebtTransferAmount = seg[&apos;PV1.32&apos;][&apos;PV1.32.1&apos;].toString(); }

		// PV1.33, badDebtRecoveryAmount
		if (seg[&apos;PV1.33&apos;][&apos;PV1.33.1&apos;].toString() != &quot;&quot;) { pv1[index].badDebtRecoveryAmount = seg[&apos;PV1.33&apos;][&apos;PV1.33.1&apos;].toString(); }

		// PV1.34, deleteAccountIndicator
		if (seg[&apos;PV1.34&apos;][&apos;PV1.34.1&apos;].toString() != &quot;&quot;) { pv1[index].deleteAccountIndicator = seg[&apos;PV1.34&apos;][&apos;PV1.34.1&apos;].toString(); }

		// PV1.35, deleteAccountDate
		if (seg[&apos;PV1.35&apos;][&apos;PV1.35.1&apos;].toString() != &quot;&quot;) { pv1[index].deleteAccountDate = seg[&apos;PV1.35&apos;][&apos;PV1.35.1&apos;].toString(); }

		// PV1.36, dischargeDisposition
		if (seg[&apos;PV1.36&apos;][&apos;PV1.36.1&apos;].toString() != &quot;&quot;) { pv1[index].dischargeDisposition = seg[&apos;PV1.36&apos;][&apos;PV1.36.1&apos;].toString(); }

		// PV1.37, dischargedtoLocation
		pv1[index].dischargedtoLocation = {};
		if (seg[&apos;PV1.37&apos;][&apos;PV1.37.1&apos;].toString() != &quot;&quot;) { pv1[index].dischargedtoLocation.dischargeLocation = seg[&apos;PV1.37&apos;][&apos;PV1.37.1&apos;].toString(); }
		if (seg[&apos;PV1.37&apos;][&apos;PV1.37.2&apos;].toString() != &quot;&quot;) { pv1[index].dischargedtoLocation.effectiveDate = seg[&apos;PV1.37&apos;][&apos;PV1.37.2&apos;].toString(); }
		if (Object.keys(pv1[index].dischargedtoLocation).length == 0) {
			delete pv1[index].dischargedtoLocation;
		}

		// PV1.38, dietType
		if (seg[&apos;PV1.38&apos;][&apos;PV1.38.1&apos;].toString() != &quot;&quot;) { pv1[index].dietType = seg[&apos;PV1.38&apos;][&apos;PV1.38.1&apos;].toString(); }

		// PV1.39, servicingFacility
		if (seg[&apos;PV1.39&apos;][&apos;PV1.39.1&apos;].toString() != &quot;&quot;) { pv1[index].servicingFacility = seg[&apos;PV1.39&apos;][&apos;PV1.39.1&apos;].toString(); }

		// PV1.40, bedStatus
		if (seg[&apos;PV1.40&apos;][&apos;PV1.40.1&apos;].toString() != &quot;&quot;) { pv1[index].bedStatus = seg[&apos;PV1.40&apos;][&apos;PV1.40.1&apos;].toString(); }

		// PV1.41, accountStatus
		if (seg[&apos;PV1.41&apos;][&apos;PV1.41.1&apos;].toString() != &quot;&quot;) { pv1[index].accountStatus = seg[&apos;PV1.41&apos;][&apos;PV1.41.1&apos;].toString(); }

		// PV1.42, pendingLocation
		pv1[index].pendingLocation = {};
		if (seg[&apos;PV1.42&apos;][&apos;PV1.42.1&apos;].toString() != &quot;&quot;) { pv1[index].pendingLocation.pointOfCare = seg[&apos;PV1.42&apos;][&apos;PV1.42.1&apos;].toString(); }
		if (seg[&apos;PV1.42&apos;][&apos;PV1.42.2&apos;].toString() != &quot;&quot;) { pv1[index].pendingLocation.room = seg[&apos;PV1.42&apos;][&apos;PV1.42.2&apos;].toString(); }
		if (seg[&apos;PV1.42&apos;][&apos;PV1.42.3&apos;].toString() != &quot;&quot;) { pv1[index].pendingLocation.bed = seg[&apos;PV1.42&apos;][&apos;PV1.42.3&apos;].toString(); }
		pv1[index].pendingLocation.facility = {};
		if (seg[&apos;PV1.42&apos;][&apos;PV1.42.4&apos;][&apos;PV1.42.4.1&apos;].toString() != &quot;&quot;) { pv1[index].pendingLocation.facility.nameSpaceId =  seg[&apos;PV1.42&apos;][&apos;PV1.42.4&apos;][&apos;PV1.42.4.1&apos;].toString(); }
		if (seg[&apos;PV1.42&apos;][&apos;PV1.42.4&apos;][&apos;PV1.42.4.2&apos;].toString() != &quot;&quot;) { pv1[index].pendingLocation.facility.universalId =  seg[&apos;PV1.42&apos;][&apos;PV1.42.4&apos;][&apos;PV1.42.4.2&apos;].toString(); }
		if (seg[&apos;PV1.42&apos;][&apos;PV1.42.4&apos;][&apos;PV1.42.4.3&apos;].toString() != &quot;&quot;) { pv1[index].pendingLocation.facility.universalIdType =  seg[&apos;PV1.42&apos;][&apos;PV1.42.4&apos;][&apos;PV1.42.4.3&apos;].toString(); }
		if (Object.keys(pv1[index].pendingLocation.facility).length == 0) {
			if (seg[&apos;PV1.42&apos;][&apos;PV1.42.4&apos;].toString() != &quot;&quot;) { pv1[index].pendingLocation.facility.nameSpaceId = seg[&apos;PV1.42&apos;][&apos;PV1.42.4&apos;].toString(); }
			else delete pv1[index].pendingLocation.facility;
		}
		if (seg[&apos;PV1.42&apos;][&apos;PV1.42.5&apos;].toString() != &quot;&quot;) { pv1[index].pendingLocation.locationStatus = seg[&apos;PV1.42&apos;][&apos;PV1.42.5&apos;].toString(); }
		if (seg[&apos;PV1.42&apos;][&apos;PV1.42.6&apos;].toString() != &quot;&quot;) { pv1[index].pendingLocation.personLocationType = seg[&apos;PV1.42&apos;][&apos;PV1.42.6&apos;].toString(); }
		if (seg[&apos;PV1.42&apos;][&apos;PV1.42.7&apos;].toString() != &quot;&quot;) { pv1[index].pendingLocation.building = seg[&apos;PV1.42&apos;][&apos;PV1.42.7&apos;].toString(); }
		if (seg[&apos;PV1.42&apos;][&apos;PV1.42.8&apos;].toString() != &quot;&quot;) { pv1[index].pendingLocation.floor = seg[&apos;PV1.42&apos;][&apos;PV1.42.8&apos;].toString(); }
		if (seg[&apos;PV1.42&apos;][&apos;PV1.42.9&apos;].toString() != &quot;&quot;) { pv1[index].pendingLocation.locationDescription = seg[&apos;PV1.42&apos;][&apos;PV1.42.9&apos;].toString(); }
		if (Object.keys(pv1[index].pendingLocation).length == 0) {
			delete pv1[index].pendingLocation;
		}

		// PV1.43, priorTemporaryLocation
		pv1[index].priorTemporaryLocation = {};
		if (seg[&apos;PV1.43&apos;][&apos;PV1.43.1&apos;].toString() != &quot;&quot;) { pv1[index].priorTemporaryLocation.pointOfCare = seg[&apos;PV1.43&apos;][&apos;PV1.43.1&apos;].toString(); }
		if (seg[&apos;PV1.43&apos;][&apos;PV1.43.2&apos;].toString() != &quot;&quot;) { pv1[index].priorTemporaryLocation.room = seg[&apos;PV1.43&apos;][&apos;PV1.43.2&apos;].toString(); }
		if (seg[&apos;PV1.43&apos;][&apos;PV1.43.3&apos;].toString() != &quot;&quot;) { pv1[index].priorTemporaryLocation.bed = seg[&apos;PV1.43&apos;][&apos;PV1.43.3&apos;].toString(); }
		pv1[index].priorTemporaryLocation.facility = {};
		if (seg[&apos;PV1.43&apos;][&apos;PV1.43.4&apos;][&apos;PV1.43.4.1&apos;].toString() != &quot;&quot;) { pv1[index].priorTemporaryLocation.facility.nameSpaceId =  seg[&apos;PV1.43&apos;][&apos;PV1.43.4&apos;][&apos;PV1.43.4.1&apos;].toString(); }
		if (seg[&apos;PV1.43&apos;][&apos;PV1.43.4&apos;][&apos;PV1.43.4.2&apos;].toString() != &quot;&quot;) { pv1[index].priorTemporaryLocation.facility.universalId =  seg[&apos;PV1.43&apos;][&apos;PV1.43.4&apos;][&apos;PV1.43.4.2&apos;].toString(); }
		if (seg[&apos;PV1.43&apos;][&apos;PV1.43.4&apos;][&apos;PV1.43.4.3&apos;].toString() != &quot;&quot;) { pv1[index].priorTemporaryLocation.facility.universalIdType =  seg[&apos;PV1.43&apos;][&apos;PV1.43.4&apos;][&apos;PV1.43.4.3&apos;].toString(); }
		if (Object.keys(pv1[index].priorTemporaryLocation.facility).length == 0) {
			if (seg[&apos;PV1.43&apos;][&apos;PV1.43.4&apos;].toString() != &quot;&quot;) { pv1[index].priorTemporaryLocation.facility.nameSpaceId = seg[&apos;PV1.43&apos;][&apos;PV1.43.4&apos;].toString(); }
			else delete pv1[index].priorTemporaryLocation.facility;
		}
		if (seg[&apos;PV1.43&apos;][&apos;PV1.43.5&apos;].toString() != &quot;&quot;) { pv1[index].priorTemporaryLocation.locationStatus = seg[&apos;PV1.43&apos;][&apos;PV1.43.5&apos;].toString(); }
		if (seg[&apos;PV1.43&apos;][&apos;PV1.43.6&apos;].toString() != &quot;&quot;) { pv1[index].priorTemporaryLocation.personLocationType = seg[&apos;PV1.43&apos;][&apos;PV1.43.6&apos;].toString(); }
		if (seg[&apos;PV1.43&apos;][&apos;PV1.43.7&apos;].toString() != &quot;&quot;) { pv1[index].priorTemporaryLocation.building = seg[&apos;PV1.43&apos;][&apos;PV1.43.7&apos;].toString(); }
		if (seg[&apos;PV1.43&apos;][&apos;PV1.43.8&apos;].toString() != &quot;&quot;) { pv1[index].priorTemporaryLocation.floor = seg[&apos;PV1.43&apos;][&apos;PV1.43.8&apos;].toString(); }
		if (seg[&apos;PV1.43&apos;][&apos;PV1.43.9&apos;].toString() != &quot;&quot;) { pv1[index].priorTemporaryLocation.locationDescription = seg[&apos;PV1.43&apos;][&apos;PV1.43.9&apos;].toString(); }
		if (Object.keys(pv1[index].priorTemporaryLocation).length == 0) {
			delete pv1[index].priorTemporaryLocation;
		}

		// PV1.44, admitDateTime
		if (seg[&apos;PV1.44&apos;][&apos;PV1.44.1&apos;].toString() != &quot;&quot;) { pv1[index].admitDateTime = seg[&apos;PV1.44&apos;][&apos;PV1.44.1&apos;].toString(); }

		// PV1.45, dischargeDateTime
		if (seg[&apos;PV1.45&apos;][&apos;PV1.45.1&apos;].toString() != &quot;&quot;) { pv1[index].dischargeDateTime = seg[&apos;PV1.45&apos;][&apos;PV1.45.1&apos;].toString(); }

		// PV1.46, currentPatientBalance
		if (seg[&apos;PV1.46&apos;][&apos;PV1.46.1&apos;].toString() != &quot;&quot;) { pv1[index].currentPatientBalance = seg[&apos;PV1.46&apos;][&apos;PV1.46.1&apos;].toString(); }

		// PV1.47, totalCharges
		if (seg[&apos;PV1.47&apos;][&apos;PV1.47.1&apos;].toString() != &quot;&quot;) { pv1[index].totalCharges = seg[&apos;PV1.47&apos;][&apos;PV1.47.1&apos;].toString(); }

		// PV1.48, totalAdjustments
		if (seg[&apos;PV1.48&apos;][&apos;PV1.48.1&apos;].toString() != &quot;&quot;) { pv1[index].totalAdjustments = seg[&apos;PV1.48&apos;][&apos;PV1.48.1&apos;].toString(); }

		// PV1.49, totalPayments
		if (seg[&apos;PV1.49&apos;][&apos;PV1.49.1&apos;].toString() != &quot;&quot;) { pv1[index].totalPayments = seg[&apos;PV1.49&apos;][&apos;PV1.49.1&apos;].toString(); }

		// PV1.50, alternateVisitID
		pv1[index].alternateVisitID = {};
		if (seg[&apos;PV1.50&apos;][&apos;PV1.50.1&apos;].toString() != &quot;&quot;) { pv1[index].alternateVisitID.id = seg[&apos;PV1.50&apos;][&apos;PV1.50.1&apos;].toString(); }
		if (seg[&apos;PV1.50&apos;][&apos;PV1.50.2&apos;].toString() != &quot;&quot;) { pv1[index].alternateVisitID.identifierCheckDigit = seg[&apos;PV1.50&apos;][&apos;PV1.50.2&apos;].toString(); }
		if (seg[&apos;PV1.50&apos;][&apos;PV1.50.3&apos;].toString() != &quot;&quot;) { pv1[index].alternateVisitID.codeIdentifyingCheckDigitScheme = seg[&apos;PV1.50&apos;][&apos;PV1.50.3&apos;].toString(); }
		pv1[index].alternateVisitID.assigningAuthority = {};
		if (seg[&apos;PV1.50&apos;][&apos;PV1.50.4&apos;][&apos;PV1.50.4.1&apos;].toString() != &quot;&quot;) { pv1[index].alternateVisitID.assigningAuthority.namespaceId = seg[&apos;PV1.50&apos;][&apos;PV1.50.4&apos;][&apos;PV1.50.4.1&apos;].toString(); }
		if (seg[&apos;PV1.50&apos;][&apos;PV1.50.4&apos;][&apos;PV1.50.4.2&apos;].toString() != &quot;&quot;) { pv1[index].alternateVisitID.assigningAuthority.universalId = seg[&apos;PV1.50&apos;][&apos;PV1.50.4&apos;][&apos;PV1.50.4.2&apos;].toString(); }
		if (seg[&apos;PV1.50&apos;][&apos;PV1.50.4&apos;][&apos;PV1.50.4.3&apos;].toString() != &quot;&quot;) { pv1[index].alternateVisitID.assigningAuthority.universalIdType = seg[&apos;PV1.50&apos;][&apos;PV1.50.4&apos;][&apos;PV1.50.4.3&apos;].toString(); }
		if (Object.keys(pv1[index].alternateVisitID.assigningAuthority).length == 0) {
			if (seg[&apos;PV1.50&apos;][&apos;PV1.50.4&apos;].toString() != &quot;&quot;) { pv1[index].alternateVisitID.assigningAuthority.namespaceId = seg[&apos;PV1.50&apos;][&apos;PV1.50.4&apos;].toString(); }
			else delete pv1[index].alternateVisitID.assigningAuthority;
		}
		if (seg[&apos;PV1.50&apos;][&apos;PV1.50.5&apos;].toString() != &quot;&quot;) { pv1[index].alternateVisitID.idTypeCode = seg[&apos;PV1.50&apos;][&apos;PV1.50.5&apos;].toString(); }
		pv1[index].alternateVisitID.assigningFacility = {};
		if (seg[&apos;PV1.50&apos;][&apos;PV1.50.6&apos;][&apos;PV1.50.6.1&apos;].toString() != &quot;&quot;) { pv1[index].alternateVisitID.assigningFacility.namespaceId = seg[&apos;PV1.50&apos;][&apos;PV1.50.6&apos;][&apos;PV1.50.6.1&apos;].toString(); }
		if (seg[&apos;PV1.50&apos;][&apos;PV1.50.6&apos;][&apos;PV1.50.6.2&apos;].toString() != &quot;&quot;) { pv1[index].alternateVisitID.assigningFacility.universalId = seg[&apos;PV1.50&apos;][&apos;PV1.50.6&apos;][&apos;PV1.50.6.2&apos;].toString(); }
		if (seg[&apos;PV1.50&apos;][&apos;PV1.50.6&apos;][&apos;PV1.50.6.3&apos;].toString() != &quot;&quot;) { pv1[index].alternateVisitID.assigningFacility.universalIdType = seg[&apos;PV1.50&apos;][&apos;PV1.50.6&apos;][&apos;PV1.50.6.3&apos;].toString(); }
		if (Object.keys(pv1[index].alternateVisitID.assigningFacility).length == 0) {
			if (seg[&apos;PV1.50&apos;][&apos;PV1.50.6&apos;].toString() != &quot;&quot;) { pv1[index].alternateVisitID.assigningFacility.namespaceId = seg[&apos;PV1.50&apos;][&apos;PV1.50.6&apos;].toString(); }
			else delete pv1[index].alternateVisitID.assigningFacility;
		}
		if (Object.keys(pv1[index].alternateVisitID).length == 0) {
			delete pv1[index].alternateVisitID;
		}

		// PV1.51, visitIndicator
		if (seg[&apos;PV1.51&apos;][&apos;PV1.51.1&apos;].toString() != &quot;&quot;) { pv1[index].visitIndicator = seg[&apos;PV1.51&apos;][&apos;PV1.51.1&apos;].toString(); }

		// PV1.52, otherHealthcareProvider
		pv1[index].otherHealthcareProvider = {};
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.1&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.id = seg[&apos;PV1.52&apos;][&apos;PV1.52.1&apos;].toString(); }
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.2&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.lastName = seg[&apos;PV1.52&apos;][&apos;PV1.52.2&apos;].toString(); }
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.3&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.firstName = seg[&apos;PV1.52&apos;][&apos;PV1.52.3&apos;].toString(); }
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.4&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.middleInitOrName = seg[&apos;PV1.52&apos;][&apos;PV1.52.4&apos;].toString(); }
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.5&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.suffix = seg[&apos;PV1.52&apos;][&apos;PV1.52.5&apos;].toString(); }
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.6&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.prefix = seg[&apos;PV1.52&apos;][&apos;PV1.52.6&apos;].toString(); }
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.7&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.degree = seg[&apos;PV1.52&apos;][&apos;PV1.52.7&apos;].toString(); }
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.8&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.sourceTable = seg[&apos;PV1.52&apos;][&apos;PV1.52.8&apos;].toString(); }
		pv1[index].otherHealthcareProvider.assigningAuthority = {};
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.9&apos;][&apos;PV1.52.9.1&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.assigningAuthority.id = seg[&apos;PV1.52&apos;][&apos;PV1.52.9&apos;][&apos;PV1.52.9.1&apos;].toString(); }
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.9&apos;][&apos;PV1.52.9.2&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.assigningAuthority.universalId = seg[&apos;PV1.52&apos;][&apos;PV1.52.9&apos;][&apos;PV1.52.9.2&apos;].toString(); }
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.9&apos;][&apos;PV1.52.9.3&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.assigningAuthority.universalIdType = seg[&apos;PV1.52&apos;][&apos;PV1.52.9&apos;][&apos;PV1.52.9.3&apos;].toString(); }
		if (Object.keys(pv1[index].otherHealthcareProvider.assigningAuthority).length == 0) {
			if (seg[&apos;PV1.52&apos;][&apos;PV1.52.9&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.assigningAuthority.id = seg[&apos;PV1.52&apos;][&apos;PV1.52.9&apos;].toString(); }
			else delete pv1[index].otherHealthcareProvider.assigningAuthority;
		}
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.10&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.nameTypeCode = seg[&apos;PV1.52&apos;][&apos;PV1.52.10&apos;].toString(); }
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.11&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.identifierCheckDigit = seg[&apos;PV1.52&apos;][&apos;PV1.52.11&apos;].toString(); }
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.12&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.codeIdentifyingCheckDigitScheme = seg[&apos;PV1.52&apos;][&apos;PV1.52.12&apos;].toString(); }
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.13&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.identifierTypeCode = seg[&apos;PV1.52&apos;][&apos;PV1.52.13&apos;].toString(); }
		pv1[index].otherHealthcareProvider.assigningFacility = {};
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.14&apos;][&apos;PV1.52.14.1&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.assigningFacility.id = seg[&apos;PV1.52&apos;][&apos;PV1.52.14&apos;][&apos;PV1.52.14.1&apos;].toString(); }
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.14&apos;][&apos;PV1.52.14.2&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.assigningFacility.universalId = seg[&apos;PV1.52&apos;][&apos;PV1.52.14&apos;][&apos;PV1.52.14.2&apos;].toString(); }
		if (seg[&apos;PV1.52&apos;][&apos;PV1.52.14&apos;][&apos;PV1.52.14.3&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.assigningFacility.universalIdType = seg[&apos;PV1.52&apos;][&apos;PV1.52.14&apos;][&apos;PV1.52.14.3&apos;].toString(); }
		if (Object.keys(pv1[index].otherHealthcareProvider.assigningFacility).length == 0) {
			if (seg[&apos;PV1.52&apos;][&apos;PV1.52.14&apos;].toString() != &quot;&quot;) { pv1[index].otherHealthcareProvider.assigningFacility.id = seg[&apos;PV1.52&apos;][&apos;PV1.52.14&apos;].toString(); }
			else delete pv1[index].otherHealthcareProvider.assigningFacility;
		}
		if (Object.keys(pv1[index].otherHealthcareProvider).length == 0) {
			delete pv1[index].otherHealthcareProvider;
		}

		// clean up PV1 and increment index
		if (Object.keys(pv1[index]).length == 0) {
			delete pv1[index];
		} else {
			index++;
		}
	}
}

// Optional: save a copy of the completed PV1 segment for reference later
//channelMap.put(&quot;pv1&quot;, pv1); // uncomment to save

// If it has content, add the PV1 segment to the hl7JSON object
if (pv1 &amp;&amp; Object.keys(pv1).length != 0) {
	var hl7JSON = JSON.parse($(&apos;hl7JSON&apos;));
	hl7JSON.content.PV1 = pv1;
	channelMap.put(&quot;hl7JSON&quot;, JSON.stringify(hl7JSON));
}</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
        <com.mirth.connect.plugins.javascriptstep.JavaScriptStep version="3.8.1">
          <name>TXA (Document notification), OBX (Observation), and related NTE (Note) Segments</name>
          <sequenceNumber>5</sequenceNumber>
          <enabled>true</enabled>
          <script>// TXA
var txa;
if (msg[&apos;TXA&apos;].length() &gt; 0) {
	txa = [];
	var index = 0;
	for each (seg in msg.TXA) {
		txa[index] = {};

		// TXA.1, setID
		if (seg[&apos;TXA.1&apos;][&apos;TXA.1.1&apos;].toString() != &quot;&quot;) { txa[index].setID = seg[&apos;TXA.1&apos;][&apos;TXA.1.1&apos;].toString(); }

	    // TXA.2, documentType
	    if (seg[&apos;TXA.2&apos;][&apos;TXA.2.1&apos;].toString() != &quot;&quot;) { txa[index].documentType = seg[&apos;TXA.2&apos;][&apos;TXA.2.1&apos;].toString(); }

	    // TXA.3, documentContentPresentation
	    if (seg[&apos;TXA.3&apos;][&apos;TXA.3.1&apos;].toString() != &quot;&quot;) { txa[index].documentContentPresentation = seg[&apos;TXA.3&apos;][&apos;TXA.3.1&apos;].toString(); }

	    // TXA.4, activityDateTime
	    if (seg[&apos;TXA.4&apos;][&apos;TXA.4.1&apos;].toString() != &quot;&quot;) { txa[index].activityDateTime = seg[&apos;TXA.4&apos;][&apos;TXA.4.1&apos;].toString(); }

	    // TXA.5, primaryActivityProviderCodeName
	    txa[index].primaryActivityProviderCodeName = {};
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.1&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.id = seg[&apos;TXA.5&apos;][&apos;TXA.5.1&apos;].toString(); }
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.2&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.lastName = seg[&apos;TXA.5&apos;][&apos;TXA.5.2&apos;].toString(); }
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.3&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.firstName = seg[&apos;TXA.5&apos;][&apos;TXA.5.3&apos;].toString(); }
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.4&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.middleInitOrName = seg[&apos;TXA.5&apos;][&apos;TXA.5.4&apos;].toString(); }
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.5&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.suffix = seg[&apos;TXA.5&apos;][&apos;TXA.5.5&apos;].toString(); }
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.6&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.prefix = seg[&apos;TXA.5&apos;][&apos;TXA.5.6&apos;].toString(); }
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.7&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.degree = seg[&apos;TXA.5&apos;][&apos;TXA.5.7&apos;].toString(); }
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.8&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.sourceTable = seg[&apos;TXA.5&apos;][&apos;TXA.5.8&apos;].toString(); }
		txa[index].primaryActivityProviderCodeName.assigningAuthority = {};
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.9&apos;][&apos;TXA.5.9.1&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.assigningAuthority.id = seg[&apos;TXA.5&apos;][&apos;TXA.5.9&apos;][&apos;TXA.5.9.1&apos;].toString(); }
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.9&apos;][&apos;TXA.5.9.2&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.assigningAuthority.universalId = seg[&apos;TXA.5&apos;][&apos;TXA.5.9&apos;][&apos;TXA.5.9.2&apos;].toString(); }
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.9&apos;][&apos;TXA.5.9.3&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.assigningAuthority.universalIdType = seg[&apos;TXA.5&apos;][&apos;TXA.5.9&apos;][&apos;TXA.5.9.3&apos;].toString(); }
		if (Object.keys(txa[index].primaryActivityProviderCodeName.assigningAuthority).length == 0) {
			if (seg[&apos;TXA.5&apos;][&apos;TXA.5.9&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.assigningAuthority.id = seg[&apos;TXA.5&apos;][&apos;TXA.5.9&apos;].toString(); }
			else delete txa[index].primaryActivityProviderCodeName.assigningAuthority;
		}
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.10&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.nameTypeCode = seg[&apos;TXA.5&apos;][&apos;TXA.5.10&apos;].toString(); }
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.11&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.identifierCheckDigit = seg[&apos;TXA.5&apos;][&apos;TXA.5.11&apos;].toString(); }
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.12&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.codeIdentifyingCheckDigitScheme = seg[&apos;TXA.5&apos;][&apos;TXA.5.12&apos;].toString(); }
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.13&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.identifierTypeCode = seg[&apos;TXA.5&apos;][&apos;TXA.5.13&apos;].toString(); }
		txa[index].primaryActivityProviderCodeName.assigningFacility = {};
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.14&apos;][&apos;TXA.5.14.1&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.assigningFacility.id = seg[&apos;TXA.5&apos;][&apos;TXA.5.14&apos;][&apos;TXA.5.14.1&apos;].toString(); }
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.14&apos;][&apos;TXA.5.14.2&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.assigningFacility.universalId = seg[&apos;TXA.5&apos;][&apos;TXA.5.14&apos;][&apos;TXA.5.14.2&apos;].toString(); }
		if (seg[&apos;TXA.5&apos;][&apos;TXA.5.14&apos;][&apos;TXA.5.14.3&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.assigningFacility.universalIdType = seg[&apos;TXA.5&apos;][&apos;TXA.5.14&apos;][&apos;TXA.5.14.3&apos;].toString(); }
		if (Object.keys(txa[index].primaryActivityProviderCodeName.assigningFacility).length == 0) {
			if (seg[&apos;TXA.5&apos;][&apos;TXA.5.14&apos;].toString() != &quot;&quot;) { txa[index].primaryActivityProviderCodeName.assigningFacility.id = seg[&apos;TXA.5&apos;][&apos;TXA.5.14&apos;].toString(); }
			else delete txa[index].primaryActivityProviderCodeName.assigningFacility;
		}
		if (Object.keys(txa[index].primaryActivityProviderCodeName).length == 0) {
			delete txa[index].primaryActivityProviderCodeName;
		}

	    // TXA.6, originationDateTime
	    if (seg[&apos;TXA.6&apos;][&apos;TXA.6.1&apos;].toString() != &quot;&quot;) { txa[index].originationDateTime = seg[&apos;TXA.6&apos;][&apos;TXA.6.1&apos;].toString(); }

	    // TXA.7, transcriptionDateTime
	    if (seg[&apos;TXA.7&apos;][&apos;TXA.7.1&apos;].toString() != &quot;&quot;) { txa[index].transcriptionDateTime = seg[&apos;TXA.7&apos;][&apos;TXA.7.1&apos;].toString(); }

	    // TXA.8, editDateTime
	    txa[index].editDateTime = [];
	    for each (field in seg[&apos;TXA.8&apos;]) {
	    	if (field[&apos;TXA.8.1&apos;].toString() != &quot;&quot;) {
	    		txa[index].editDateTime.push(field[&apos;TXA.8.1&apos;].toString());
	    	}
	    }
	    if (txa[index].editDateTime.length == 0) {
			delete txa[index].editDateTime;
		}
	    
	    // TXA.9, originatorCodeName
	    txa[index].originatorCodeName = {};
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.1&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.id = seg[&apos;TXA.9&apos;][&apos;TXA.9.1&apos;].toString(); }
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.2&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.lastName = seg[&apos;TXA.9&apos;][&apos;TXA.9.2&apos;].toString(); }
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.3&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.firstName = seg[&apos;TXA.9&apos;][&apos;TXA.9.3&apos;].toString(); }
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.4&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.middleInitOrName = seg[&apos;TXA.9&apos;][&apos;TXA.9.4&apos;].toString(); }
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.5&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.suffix = seg[&apos;TXA.9&apos;][&apos;TXA.9.5&apos;].toString(); }
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.6&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.prefix = seg[&apos;TXA.9&apos;][&apos;TXA.9.6&apos;].toString(); }
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.7&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.degree = seg[&apos;TXA.9&apos;][&apos;TXA.9.7&apos;].toString(); }
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.8&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.sourceTable = seg[&apos;TXA.9&apos;][&apos;TXA.9.8&apos;].toString(); }
		txa[index].originatorCodeName.assigningAuthority = {};
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.9&apos;][&apos;TXA.9.9.1&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.assigningAuthority.id = seg[&apos;TXA.9&apos;][&apos;TXA.9.9&apos;][&apos;TXA.9.9.1&apos;].toString(); }
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.9&apos;][&apos;TXA.9.9.2&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.assigningAuthority.universalId = seg[&apos;TXA.9&apos;][&apos;TXA.9.9&apos;][&apos;TXA.9.9.2&apos;].toString(); }
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.9&apos;][&apos;TXA.9.9.3&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.assigningAuthority.universalIdType = seg[&apos;TXA.9&apos;][&apos;TXA.9.9&apos;][&apos;TXA.9.9.3&apos;].toString(); }
		if (Object.keys(txa[index].originatorCodeName.assigningAuthority).length == 0) {
			if (seg[&apos;TXA.9&apos;][&apos;TXA.9.9&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.assigningAuthority.id = seg[&apos;TXA.9&apos;][&apos;TXA.9.9&apos;].toString(); }
			else delete txa[index].originatorCodeName.assigningAuthority;
		}
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.10&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.nameTypeCode = seg[&apos;TXA.9&apos;][&apos;TXA.9.10&apos;].toString(); }
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.11&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.identifierCheckDigit = seg[&apos;TXA.9&apos;][&apos;TXA.9.11&apos;].toString(); }
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.12&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.codeIdentifyingCheckDigitScheme = seg[&apos;TXA.9&apos;][&apos;TXA.9.12&apos;].toString(); }
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.13&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.identifierTypeCode = seg[&apos;TXA.9&apos;][&apos;TXA.9.13&apos;].toString(); }
		txa[index].originatorCodeName.assigningFacility = {};
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.14&apos;][&apos;TXA.9.14.1&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.assigningFacility.id = seg[&apos;TXA.9&apos;][&apos;TXA.9.14&apos;][&apos;TXA.9.14.1&apos;].toString(); }
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.14&apos;][&apos;TXA.9.14.2&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.assigningFacility.universalId = seg[&apos;TXA.9&apos;][&apos;TXA.9.14&apos;][&apos;TXA.9.14.2&apos;].toString(); }
		if (seg[&apos;TXA.9&apos;][&apos;TXA.9.14&apos;][&apos;TXA.9.14.3&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.assigningFacility.universalIdType = seg[&apos;TXA.9&apos;][&apos;TXA.9.14&apos;][&apos;TXA.9.14.3&apos;].toString(); }
		if (Object.keys(txa[index].originatorCodeName.assigningFacility).length == 0) {
			if (seg[&apos;TXA.9&apos;][&apos;TXA.9.14&apos;].toString() != &quot;&quot;) { txa[index].originatorCodeName.assigningFacility.id = seg[&apos;TXA.9&apos;][&apos;TXA.9.14&apos;].toString(); }
			else delete txa[index].originatorCodeName.assigningFacility;
		}
		if (Object.keys(txa[index].originatorCodeName).length == 0) {
			delete txa[index].originatorCodeName;
		}

	    // TXA.10, assignedDocumentAuthenticator
	    txa[index].assignedDocumentAuthenticator = [];
		for each (field in seg[&apos;TXA.10&apos;]) {
			var block = {};
			if (field[&apos;TXA.10.1&apos;].toString() != &quot;&quot;) { block.id = field[&apos;TXA.10.1&apos;].toString(); }
			if (field[&apos;TXA.10.2&apos;].toString() != &quot;&quot;) { block.lastName = field[&apos;TXA.10.2&apos;].toString(); }
			if (field[&apos;TXA.10.3&apos;].toString() != &quot;&quot;) { block.firstName = field[&apos;TXA.10.3&apos;].toString(); }
			if (field[&apos;TXA.10.4&apos;].toString() != &quot;&quot;) { block.middleInitOrName = field[&apos;TXA.10.4&apos;].toString(); }
			if (field[&apos;TXA.10.5&apos;].toString() != &quot;&quot;) { block.suffix = field[&apos;TXA.10.5&apos;].toString(); }
			if (field[&apos;TXA.10.6&apos;].toString() != &quot;&quot;) { block.prefix = field[&apos;TXA.10.6&apos;].toString(); }
			if (field[&apos;TXA.10.7&apos;].toString() != &quot;&quot;) { block.degree = field[&apos;TXA.10.7&apos;].toString(); }
			if (field[&apos;TXA.10.8&apos;].toString() != &quot;&quot;) { block.sourceTable = field[&apos;TXA.10.8&apos;].toString(); }
			block.assigningAuthority = {};
			if (field[&apos;TXA.10.9&apos;][&apos;TXA.10.9.1&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;TXA.10.9&apos;][&apos;TXA.10.9.1&apos;].toString(); }
			if (field[&apos;TXA.10.9&apos;][&apos;TXA.10.9.2&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalId = field[&apos;TXA.10.9&apos;][&apos;TXA.10.9.2&apos;].toString(); }
			if (field[&apos;TXA.10.9&apos;][&apos;TXA.10.9.3&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalIdType = field[&apos;TXA.10.9&apos;][&apos;TXA.10.9.3&apos;].toString(); }
			if (Object.keys(block.assigningAuthority).length == 0) {
				if (field[&apos;TXA.10.9&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;TXA.10.9&apos;].toString(); }
				else delete block.assigningAuthority;
			}
			if (field[&apos;TXA.10.10&apos;].toString() != &quot;&quot;) { block.nameTypeCode = field[&apos;TXA.10.10&apos;].toString(); }
			if (field[&apos;TXA.10.11&apos;].toString() != &quot;&quot;) { block.identifierCheckDigit = field[&apos;TXA.10.11&apos;].toString(); }
			if (field[&apos;TXA.10.12&apos;].toString() != &quot;&quot;) { block.codeIdentifyingCheckDigitScheme = field[&apos;TXA.10.12&apos;].toString(); }
			if (field[&apos;TXA.10.13&apos;].toString() != &quot;&quot;) { block.identifierTypeCode = field[&apos;TXA.10.13&apos;].toString(); }
			block.assigningFacility = {};
			if (field[&apos;TXA.10.14&apos;][&apos;TXA.10.14.1&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;TXA.10.14&apos;][&apos;TXA.10.14.1&apos;].toString(); }
			if (field[&apos;TXA.10.14&apos;][&apos;TXA.10.14.2&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalId = field[&apos;TXA.10.14&apos;][&apos;TXA.10.14.2&apos;].toString(); }
			if (field[&apos;TXA.10.14&apos;][&apos;TXA.10.14.3&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalIdType = field[&apos;TXA.10.14&apos;][&apos;TXA.10.14.3&apos;].toString(); }
			if (Object.keys(block.assigningFacility).length == 0) {
				if (field[&apos;TXA.10.14&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;TXA.10.14&apos;].toString(); }
				else delete block.assigningFacility;
			}
			if (Object.keys(block).length &gt; 0) {
				txa[index].assignedDocumentAuthenticator.push(block);
			}
		}
		if (txa[index].assignedDocumentAuthenticator.length == 0) {
			delete txa[index].assignedDocumentAuthenticator;
		}

	    // TXA.11, transcriptionistCodeName
	    txa[index].transcriptionistCodeName = {};
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.1&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.id = seg[&apos;TXA.11&apos;][&apos;TXA.11.1&apos;].toString(); }
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.2&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.lastName = seg[&apos;TXA.11&apos;][&apos;TXA.11.2&apos;].toString(); }
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.3&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.firstName = seg[&apos;TXA.11&apos;][&apos;TXA.11.3&apos;].toString(); }
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.4&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.middleInitOrName = seg[&apos;TXA.11&apos;][&apos;TXA.11.4&apos;].toString(); }
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.5&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.suffix = seg[&apos;TXA.11&apos;][&apos;TXA.11.5&apos;].toString(); }
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.6&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.prefix = seg[&apos;TXA.11&apos;][&apos;TXA.11.6&apos;].toString(); }
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.7&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.degree = seg[&apos;TXA.11&apos;][&apos;TXA.11.7&apos;].toString(); }
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.8&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.sourceTable = seg[&apos;TXA.11&apos;][&apos;TXA.11.8&apos;].toString(); }
		txa[index].transcriptionistCodeName.assigningAuthority = {};
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.9&apos;][&apos;TXA.11.9.1&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.assigningAuthority.id = seg[&apos;TXA.11&apos;][&apos;TXA.11.9&apos;][&apos;TXA.11.9.1&apos;].toString(); }
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.9&apos;][&apos;TXA.11.9.2&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.assigningAuthority.universalId = seg[&apos;TXA.11&apos;][&apos;TXA.11.9&apos;][&apos;TXA.11.9.2&apos;].toString(); }
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.9&apos;][&apos;TXA.11.9.3&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.assigningAuthority.universalIdType = seg[&apos;TXA.11&apos;][&apos;TXA.11.9&apos;][&apos;TXA.11.9.3&apos;].toString(); }
		if (Object.keys(txa[index].transcriptionistCodeName.assigningAuthority).length == 0) {
			if (seg[&apos;TXA.11&apos;][&apos;TXA.11.9&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.assigningAuthority.id = seg[&apos;TXA.11&apos;][&apos;TXA.11.9&apos;].toString(); }
			else delete txa[index].transcriptionistCodeName.assigningAuthority;
		}
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.10&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.nameTypeCode = seg[&apos;TXA.11&apos;][&apos;TXA.11.10&apos;].toString(); }
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.11&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.identifierCheckDigit = seg[&apos;TXA.11&apos;][&apos;TXA.11.11&apos;].toString(); }
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.12&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.codeIdentifyingCheckDigitScheme = seg[&apos;TXA.11&apos;][&apos;TXA.11.12&apos;].toString(); }
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.13&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.identifierTypeCode = seg[&apos;TXA.11&apos;][&apos;TXA.11.13&apos;].toString(); }
		txa[index].transcriptionistCodeName.assigningFacility = {};
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.14&apos;][&apos;TXA.11.14.1&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.assigningFacility.id = seg[&apos;TXA.11&apos;][&apos;TXA.11.14&apos;][&apos;TXA.11.14.1&apos;].toString(); }
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.14&apos;][&apos;TXA.11.14.2&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.assigningFacility.universalId = seg[&apos;TXA.11&apos;][&apos;TXA.11.14&apos;][&apos;TXA.11.14.2&apos;].toString(); }
		if (seg[&apos;TXA.11&apos;][&apos;TXA.11.14&apos;][&apos;TXA.11.14.3&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.assigningFacility.universalIdType = seg[&apos;TXA.11&apos;][&apos;TXA.11.14&apos;][&apos;TXA.11.14.3&apos;].toString(); }
		if (Object.keys(txa[index].transcriptionistCodeName.assigningFacility).length == 0) {
			if (seg[&apos;TXA.11&apos;][&apos;TXA.11.14&apos;].toString() != &quot;&quot;) { txa[index].transcriptionistCodeName.assigningFacility.id = seg[&apos;TXA.11&apos;][&apos;TXA.11.14&apos;].toString(); }
			else delete txa[index].transcriptionistCodeName.assigningFacility;
		}
		if (Object.keys(txa[index].transcriptionistCodeName).length == 0) {
			delete txa[index].transcriptionistCodeName;
		}

	    // TXA.12, uniqueDocumentNumber
	    txa[index].uniqueDocumentNumber = {};
		if (seg[&apos;TXA.12&apos;][&apos;TXA.12.1&apos;].toString() != &quot;&quot;) { txa[index].uniqueDocumentNumber.id = seg[&apos;TXA.12&apos;][&apos;TXA.12.1&apos;].toString(); }
		if (seg[&apos;TXA.12&apos;][&apos;TXA.12.2&apos;].toString() != &quot;&quot;) { txa[index].uniqueDocumentNumber.namespaceId = seg[&apos;TXA.12&apos;][&apos;TXA.12.2&apos;].toString(); }
		if (seg[&apos;TXA.12&apos;][&apos;TXA.12.3&apos;].toString() != &quot;&quot;) { txa[index].uniqueDocumentNumber.universalId = seg[&apos;TXA.12&apos;][&apos;TXA.12.3&apos;].toString(); }
		if (seg[&apos;TXA.12&apos;][&apos;TXA.12.4&apos;].toString() != &quot;&quot;) { txa[index].uniqueDocumentNumber.universalIdType = seg[&apos;TXA.12&apos;][&apos;TXA.12.4&apos;].toString(); }
		if (Object.keys(txa[index].uniqueDocumentNumber).length == 0) {
			delete txa[index].uniqueDocumentNumber;
		}

	    // TXA.13, parentDocumentNumber
	    txa[index].parentDocumentNumber = {};
		if (seg[&apos;TXA.13&apos;][&apos;TXA.13.1&apos;].toString() != &quot;&quot;) { txa[index].parentDocumentNumber.id = seg[&apos;TXA.13&apos;][&apos;TXA.13.1&apos;].toString(); }
		if (seg[&apos;TXA.13&apos;][&apos;TXA.13.2&apos;].toString() != &quot;&quot;) { txa[index].parentDocumentNumber.namespaceId = seg[&apos;TXA.13&apos;][&apos;TXA.13.2&apos;].toString(); }
		if (seg[&apos;TXA.13&apos;][&apos;TXA.13.3&apos;].toString() != &quot;&quot;) { txa[index].parentDocumentNumber.universalId = seg[&apos;TXA.13&apos;][&apos;TXA.13.3&apos;].toString(); }
		if (seg[&apos;TXA.13&apos;][&apos;TXA.13.4&apos;].toString() != &quot;&quot;) { txa[index].parentDocumentNumber.universalIdType = seg[&apos;TXA.13&apos;][&apos;TXA.13.4&apos;].toString(); }
		if (Object.keys(txa[index].parentDocumentNumber).length == 0) {
			delete txa[index].parentDocumentNumber;
		}

	    // TXA.14, placerOrderNumber
	    txa[index].placerOrderNumber = [];
	    for each (field in seg[&apos;TXA.14&apos;]) {
	    	var block = {};
	    	if (field[&apos;TXA.14.1&apos;].toString() != &quot;&quot;) { block.id = field[&apos;TXA.14.1&apos;].toString(); }
	    	if (field[&apos;TXA.14.2&apos;].toString() != &quot;&quot;) { block.namespaceId = field[&apos;TXA.14.2&apos;].toString(); }
	    	if (field[&apos;TXA.14.3&apos;].toString() != &quot;&quot;) { block.universalId = field[&apos;TXA.14.3&apos;].toString(); }
	    	if (field[&apos;TXA.14.4&apos;].toString() != &quot;&quot;) { block.universalIdType = field[&apos;TXA.14.4&apos;].toString(); }
	    	if (Object.keys(block).length &gt; 0) {
	    		txa[index].placerOrderNumber.push(block);
	    	}
	    }
	    if (txa[index].placerOrderNumber.length == 0) {
	    	delete txa[index].placerOrderNumber;
	    }

	    // TXA.15, fillerOrderNumber
	    txa[index].fillerOrderNumber = {};
		if (seg[&apos;TXA.15&apos;][&apos;TXA.15.1&apos;].toString() != &quot;&quot;) { txa[index].fillerOrderNumber.id = seg[&apos;TXA.15&apos;][&apos;TXA.15.1&apos;].toString(); }
		if (seg[&apos;TXA.15&apos;][&apos;TXA.15.2&apos;].toString() != &quot;&quot;) { txa[index].fillerOrderNumber.namespaceId = seg[&apos;TXA.15&apos;][&apos;TXA.15.2&apos;].toString(); }
		if (seg[&apos;TXA.15&apos;][&apos;TXA.15.3&apos;].toString() != &quot;&quot;) { txa[index].fillerOrderNumber.universalId = seg[&apos;TXA.15&apos;][&apos;TXA.15.3&apos;].toString(); }
		if (seg[&apos;TXA.15&apos;][&apos;TXA.15.4&apos;].toString() != &quot;&quot;) { txa[index].fillerOrderNumber.universalIdType = seg[&apos;TXA.15&apos;][&apos;TXA.15.4&apos;].toString(); }
		if (Object.keys(txa[index].fillerOrderNumber).length == 0) {
			delete txa[index].fillerOrderNumber;
		}

	    // TXA.16, uniqueDocumentFileName
	    if (seg[&apos;TXA.16&apos;][&apos;TXA.16.1&apos;].toString() != &quot;&quot;) { txa[index].uniqueDocumentFileName = seg[&apos;TXA.16&apos;][&apos;TXA.16.1&apos;].toString(); }

	    // TXA.17, documentCompletionStatus
	    if (seg[&apos;TXA.17&apos;][&apos;TXA.17.1&apos;].toString() != &quot;&quot;) { txa[index].documentCompletionStatus = seg[&apos;TXA.17&apos;][&apos;TXA.17.1&apos;].toString(); }

	    // TXA.18, documentConfidentialityStatus
	    if (seg[&apos;TXA.18&apos;][&apos;TXA.18.1&apos;].toString() != &quot;&quot;) { txa[index].documentConfidentialityStatus = seg[&apos;TXA.18&apos;][&apos;TXA.18.1&apos;].toString(); }

	    // TXA.19, documentAvailabilityStatus
	    if (seg[&apos;TXA.19&apos;][&apos;TXA.19.1&apos;].toString() != &quot;&quot;) { txa[index].documentAvailabilityStatus = seg[&apos;TXA.19&apos;][&apos;TXA.19.1&apos;].toString(); }

	    // TXA.20, documentStorageStatus
	    if (seg[&apos;TXA.20&apos;][&apos;TXA.20.1&apos;].toString() != &quot;&quot;) { txa[index].documentStorageStatus = seg[&apos;TXA.20&apos;][&apos;TXA.20.1&apos;].toString(); }

	    // TXA.21, documentChangeReason
	    if (seg[&apos;TXA.21&apos;][&apos;TXA.21.1&apos;].toString() != &quot;&quot;) { txa[index].documentChangeReason = seg[&apos;TXA.21&apos;][&apos;TXA.21.1&apos;].toString(); }

	    // TXA.22, authenticationPersonTimeStamp
	    txa[index].authenticationPersonTimeStamp = [];
		for each (field in seg[&apos;TXA.22&apos;]) {
			var block = {};
			if (field[&apos;TXA.22.1&apos;].toString() != &quot;&quot;) { block.id = field[&apos;TXA.22.1&apos;].toString(); }
			if (field[&apos;TXA.22.2&apos;].toString() != &quot;&quot;) { block.lastName = field[&apos;TXA.22.2&apos;].toString(); }
			if (field[&apos;TXA.22.3&apos;].toString() != &quot;&quot;) { block.firstName = field[&apos;TXA.22.3&apos;].toString(); }
			if (field[&apos;TXA.22.4&apos;].toString() != &quot;&quot;) { block.middleInitOrName = field[&apos;TXA.22.4&apos;].toString(); }
			if (field[&apos;TXA.22.5&apos;].toString() != &quot;&quot;) { block.suffix = field[&apos;TXA.22.5&apos;].toString(); }
			if (field[&apos;TXA.22.6&apos;].toString() != &quot;&quot;) { block.prefix = field[&apos;TXA.22.6&apos;].toString(); }
			if (field[&apos;TXA.22.7&apos;].toString() != &quot;&quot;) { block.degree = field[&apos;TXA.22.7&apos;].toString(); }
			if (field[&apos;TXA.22.8&apos;].toString() != &quot;&quot;) { block.sourceTable = field[&apos;TXA.22.8&apos;].toString(); }
			block.assigningAuthority = {};
			if (field[&apos;TXA.22.9&apos;][&apos;TXA.22.9.1&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;TXA.22.9&apos;][&apos;TXA.22.9.1&apos;].toString(); }
			if (field[&apos;TXA.22.9&apos;][&apos;TXA.22.9.2&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalId = field[&apos;TXA.22.9&apos;][&apos;TXA.22.9.2&apos;].toString(); }
			if (field[&apos;TXA.22.9&apos;][&apos;TXA.22.9.3&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalIdType = field[&apos;TXA.22.9&apos;][&apos;TXA.22.9.3&apos;].toString(); }
			if (Object.keys(block.assigningAuthority).length == 0) {
				if (field[&apos;TXA.22.9&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;TXA.22.9&apos;].toString(); }
				else delete block.assigningAuthority;
			}
			if (field[&apos;TXA.22.10&apos;].toString() != &quot;&quot;) { block.nameTypeCode = field[&apos;TXA.22.10&apos;].toString(); }
			if (field[&apos;TXA.22.11&apos;].toString() != &quot;&quot;) { block.identifierCheckDigit = field[&apos;TXA.22.11&apos;].toString(); }
			if (field[&apos;TXA.22.12&apos;].toString() != &quot;&quot;) { block.codeIdentifyingCheckDigitScheme = field[&apos;TXA.22.12&apos;].toString(); }
			if (field[&apos;TXA.22.13&apos;].toString() != &quot;&quot;) { block.identifierTypeCode = field[&apos;TXA.22.13&apos;].toString(); }
			block.assigningFacility = {};
			if (field[&apos;TXA.22.14&apos;][&apos;TXA.22.14.1&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;TXA.22.14&apos;][&apos;TXA.22.14.1&apos;].toString(); }
			if (field[&apos;TXA.22.14&apos;][&apos;TXA.22.14.2&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalId = field[&apos;TXA.22.14&apos;][&apos;TXA.22.14.2&apos;].toString(); }
			if (field[&apos;TXA.22.14&apos;][&apos;TXA.22.14.3&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalIdType = field[&apos;TXA.22.14&apos;][&apos;TXA.22.14.3&apos;].toString(); }
			if (Object.keys(block.assigningFacility).length == 0) {
				if (field[&apos;TXA.22.14&apos;].toString() != &quot;&quot;) { block.assigningFacility.id  = field[&apos;TXA.22.14&apos;].toString(); }
				else delete block.assigningFacility;
			}
			if (Object.keys(block).length &gt; 0) {
				txa[index].authenticationPersonTimeStamp.push(block);
			}
		}
		if (txa[index].authenticationPersonTimeStamp.length == 0) {
			delete txa[index].authenticationPersonTimeStamp;
		}

	    // TXA.23, distributedCopiesCodeAndNameOfRecipients
	    txa[index].distributedCopiesCodeAndNameOfRecipients = [];
		for each (field in seg[&apos;TXA.23&apos;]) {
			var block = {};
			if (field[&apos;TXA.23.1&apos;].toString() != &quot;&quot;) { block.id = field[&apos;TXA.23.1&apos;].toString(); }
			if (field[&apos;TXA.23.2&apos;].toString() != &quot;&quot;) { block.lastName = field[&apos;TXA.23.2&apos;].toString(); }
			if (field[&apos;TXA.23.3&apos;].toString() != &quot;&quot;) { block.firstName = field[&apos;TXA.23.3&apos;].toString(); }
			if (field[&apos;TXA.23.4&apos;].toString() != &quot;&quot;) { block.middleInitOrName = field[&apos;TXA.23.4&apos;].toString(); }
			if (field[&apos;TXA.23.5&apos;].toString() != &quot;&quot;) { block.suffix = field[&apos;TXA.23.5&apos;].toString(); }
			if (field[&apos;TXA.23.6&apos;].toString() != &quot;&quot;) { block.prefix = field[&apos;TXA.23.6&apos;].toString(); }
			if (field[&apos;TXA.23.7&apos;].toString() != &quot;&quot;) { block.degree = field[&apos;TXA.23.7&apos;].toString(); }
			if (field[&apos;TXA.23.8&apos;].toString() != &quot;&quot;) { block.sourceTable = field[&apos;TXA.23.8&apos;].toString(); }
			block.assigningAuthority = {};
			if (field[&apos;TXA.23.9&apos;][&apos;TXA.23.9.1&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;TXA.23.9&apos;][&apos;TXA.23.9.1&apos;].toString(); }
			if (field[&apos;TXA.23.9&apos;][&apos;TXA.23.9.2&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalId = field[&apos;TXA.23.9&apos;][&apos;TXA.23.9.2&apos;].toString(); }
			if (field[&apos;TXA.23.9&apos;][&apos;TXA.23.9.3&apos;].toString() != &quot;&quot;) { block.assigningAuthority.universalIdType = field[&apos;TXA.23.9&apos;][&apos;TXA.23.9.3&apos;].toString(); }
			if (Object.keys(block.assigningAuthority).length == 0) {
				if (field[&apos;TXA.23.9&apos;].toString() != &quot;&quot;) { block.assigningAuthority.id = field[&apos;TXA.23.9&apos;].toString(); }
				else delete block.assigningAuthority;
			}
			if (field[&apos;TXA.23.10&apos;].toString() != &quot;&quot;) { block.nameTypeCode = field[&apos;TXA.23.10&apos;].toString(); }
			if (field[&apos;TXA.23.11&apos;].toString() != &quot;&quot;) { block.identifierCheckDigit = field[&apos;TXA.23.11&apos;].toString(); }
			if (field[&apos;TXA.23.12&apos;].toString() != &quot;&quot;) { block.codeIdentifyingCheckDigitScheme = field[&apos;TXA.23.12&apos;].toString(); }
			if (field[&apos;TXA.23.13&apos;].toString() != &quot;&quot;) { block.identifierTypeCode = field[&apos;TXA.23.13&apos;].toString(); }
			block.assigningFacility = {};
			if (field[&apos;TXA.23.14&apos;][&apos;TXA.23.14.1&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;TXA.23.14&apos;][&apos;TXA.23.14.1&apos;].toString(); }
			if (field[&apos;TXA.23.14&apos;][&apos;TXA.23.14.2&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalId = field[&apos;TXA.23.14&apos;][&apos;TXA.23.14.2&apos;].toString(); }
			if (field[&apos;TXA.23.14&apos;][&apos;TXA.23.14.3&apos;].toString() != &quot;&quot;) { block.assigningFacility.universalIdType = field[&apos;TXA.23.14&apos;][&apos;TXA.23.14.3&apos;].toString(); }
			if (Object.keys(block.assigningFacility).length == 0) {
				if (field[&apos;TXA.23.14&apos;].toString() != &quot;&quot;) { block.assigningFacility.id = field[&apos;TXA.23.14&apos;].toString(); }
				else delete block.assigningFacility;
			}
			if (Object.keys(block).length &gt; 0) {
				txa[index].distributedCopiesCodeAndNameOfRecipients.push(block);
			}
		}
		if (txa[index].distributedCopiesCodeAndNameOfRecipients.length == 0) {
			delete txa[index].distributedCopiesCodeAndNameOfRecipients;
		}

	    // OBX (TXA)
	    var obxGroup = getSegmentsAfter(msg,seg,&apos;OBX&apos;,false);
	    if (obxGroup.length &gt; 0) {
	    	txa[index].OBX = [];
	    	var indexOBX = 0;
	    	for each (obxSeg in obxGroup) {
	    		txa[index].OBX[indexOBX] = {};

	    		// OBX.1, setId
				if (obxSeg[&apos;OBX.1&apos;][&apos;OBX.1.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].setId = obxSeg[&apos;OBX.1&apos;][&apos;OBX.1.1&apos;].toString(); }

				// OBX.2, valueType
				if (obxSeg[&apos;OBX.2&apos;][&apos;OBX.2.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].valueType = obxSeg[&apos;OBX.2&apos;][&apos;OBX.2.1&apos;].toString(); }
				
				// OBX.3, identifier
				txa[index].OBX[indexOBX].identifier = {};
				if (obxSeg[&apos;OBX.3&apos;][&apos;OBX.3.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].identifier.id = obxSeg[&apos;OBX.3&apos;][&apos;OBX.3.1&apos;].toString(); }
				if (obxSeg[&apos;OBX.3&apos;][&apos;OBX.3.2&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].identifier.text = obxSeg[&apos;OBX.3&apos;][&apos;OBX.3.2&apos;].toString(); }
				if (obxSeg[&apos;OBX.3&apos;][&apos;OBX.3.3&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].identifier.codingSystem = obxSeg[&apos;OBX.3&apos;][&apos;OBX.3.3&apos;].toString(); }
				if (obxSeg[&apos;OBX.3&apos;][&apos;OBX.3.4&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].identifier.altId = obxSeg[&apos;OBX.3&apos;][&apos;OBX.3.4&apos;].toString(); }
				if (obxSeg[&apos;OBX.3&apos;][&apos;OBX.3.5&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].identifier.altText = obxSeg[&apos;OBX.3&apos;][&apos;OBX.3.5&apos;].toString(); }
				if (obxSeg[&apos;OBX.3&apos;][&apos;OBX.3.6&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].identifier.altCodingSystem = obxSeg[&apos;OBX.3&apos;][&apos;OBX.3.6&apos;].toString(); }
				if (Object.keys(txa[index].OBX[indexOBX].identifier).length == 0) {
					delete txa[index].OBX[indexOBX].identifier;
				}

				// OBX.4, subId
				if (obxSeg[&apos;OBX.4&apos;][&apos;OBX.4.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].subId = obxSeg[&apos;OBX.4&apos;][&apos;OBX.4.1&apos;].toString(); }
				
				// OBX.5, observationValue
				txa[index].OBX[indexOBX].observationValue = [];
				for each (field in obxSeg[&apos;OBX.5&apos;]) {
					if (field[&apos;OBX.5.1&apos;].toString() != &quot;&quot;) { 
						txa[index].OBX[indexOBX].observationValue.push(field[&apos;OBX.5.1&apos;].toString()); 
					} else if (field[&apos;OBX.5.5&apos;].toString() != &quot;&quot;) { 
						txa[index].OBX[indexOBX].observationValue.push(field[&apos;OBX.5.5&apos;].toString()); 
					}
				}
				if (txa[index].OBX[indexOBX].observationValue.length == 0) {
					delete txa[index].OBX[indexOBX].observationValue;
				}

				// OBX.6, units
				txa[index].OBX[indexOBX].units = {};
				if (obxSeg[&apos;OBX.6&apos;][&apos;OBX.6.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].units.id = obxSeg[&apos;OBX.6&apos;][&apos;OBX.6.1&apos;].toString(); }
				if (obxSeg[&apos;OBX.6&apos;][&apos;OBX.6.2&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].units.text = obxSeg[&apos;OBX.6&apos;][&apos;OBX.6.2&apos;].toString(); }
				if (obxSeg[&apos;OBX.6&apos;][&apos;OBX.6.3&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].units.codingSystem = obxSeg[&apos;OBX.6&apos;][&apos;OBX.6.3&apos;].toString(); }
				if (obxSeg[&apos;OBX.6&apos;][&apos;OBX.6.4&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].units.altId = obxSeg[&apos;OBX.6&apos;][&apos;OBX.6.4&apos;].toString(); }
				if (obxSeg[&apos;OBX.6&apos;][&apos;OBX.6.5&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].units.altText = obxSeg[&apos;OBX.6&apos;][&apos;OBX.6.5&apos;].toString(); }
				if (obxSeg[&apos;OBX.6&apos;][&apos;OBX.6.6&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].units.altCodingSystem = obxSeg[&apos;OBX.6&apos;][&apos;OBX.6.6&apos;].toString(); }
				if (Object.keys(txa[index].OBX[indexOBX].units).length == 0) {
					delete txa[index].OBX[indexOBX].units;
				}

				// OBX.7, referenceRange
				if (obxSeg[&apos;OBX.7&apos;][&apos;OBX.7.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].referenceRange = obxSeg[&apos;OBX.7&apos;][&apos;OBX.7.1&apos;].toString(); }
				
				// OBX.8, abnormalFlag
				txa[index].OBX[indexOBX].abnormalFlag = [];
				for each (field in obxSeg[&apos;OBX.9&apos;]) {
					if (field[&apos;OBX.9.1&apos;].toString() != &quot;&quot;) { 
						txa[index].OBX[indexOBX].abnormalFlag.push(field[&apos;OBX.9.1&apos;].toString()); 
					}
				}
				if (txa[index].OBX[indexOBX].abnormalFlag.length == 0) {
					delete txa[index].OBX[indexOBX].abnormalFlag;
				}

				// OBX.9, probability
				if (obxSeg[&apos;OBX.9&apos;][&apos;OBX.9.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].probability = obxSeg[&apos;OBX.9&apos;][&apos;OBX.9.1&apos;].toString(); }
				
				// OBX.10, natureOfAbnormal
				txa[index].OBX[indexOBX].natureOfAbnormal = [];
				for each (field in obxSeg[&apos;OBX.10&apos;]) {
					if (field[&apos;OBX.10.1&apos;].toString() != &quot;&quot;) { 
						txa[index].OBX[indexOBX].natureOfAbnormal.push(field[&apos;OBX.10.1&apos;].toString()); 
					}
				}
				if (txa[index].OBX[indexOBX].natureOfAbnormal.length == 0) {
					delete txa[index].OBX[indexOBX].natureOfAbnormal;
				}

				// OBX.11, observeResultStatus
				if (obxSeg[&apos;OBX.11&apos;][&apos;OBX.11.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].observeResultStatus = obxSeg[&apos;OBX.11&apos;][&apos;OBX.11.1&apos;].toString(); }
				
				// OBX.12, effectiveDateLastNormalValue
				if (obxSeg[&apos;OBX.12&apos;][&apos;OBX.12.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].effectiveDateLastNormalValue = obxSeg[&apos;OBX.12&apos;][&apos;OBX.12.1&apos;].toString(); }
				
				// OBX.13, definedAccessChecks
				if (obxSeg[&apos;OBX.13&apos;][&apos;OBX.13.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].definedAccessChecks = obxSeg[&apos;OBX.13&apos;][&apos;OBX.13.1&apos;].toString(); }
				
				// OBX.14, observationDateTime
				if (obxSeg[&apos;OBX.14&apos;][&apos;OBX.14.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].observationDateTime = obxSeg[&apos;OBX.14&apos;][&apos;OBX.14.1&apos;].toString(); }
				
				// OBX.15, producersId
				txa[index].OBX[indexOBX].producersId = {};
				if (obxSeg[&apos;OBX.15&apos;][&apos;OBX.15.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].producersId.id = obxSeg[&apos;OBX.15&apos;][&apos;OBX.15.1&apos;].toString(); }
				if (obxSeg[&apos;OBX.15&apos;][&apos;OBX.15.2&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].producersId.text = obxSeg[&apos;OBX.15&apos;][&apos;OBX.15.2&apos;].toString(); }
				if (obxSeg[&apos;OBX.15&apos;][&apos;OBX.15.3&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].producersId.codingSystem = obxSeg[&apos;OBX.15&apos;][&apos;OBX.15.3&apos;].toString(); }
				if (obxSeg[&apos;OBX.15&apos;][&apos;OBX.15.4&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].producersId.altId = obxSeg[&apos;OBX.15&apos;][&apos;OBX.15.4&apos;].toString(); }
				if (obxSeg[&apos;OBX.15&apos;][&apos;OBX.15.5&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].producersId.altText = obxSeg[&apos;OBX.15&apos;][&apos;OBX.15.5&apos;].toString(); }
				if (obxSeg[&apos;OBX.15&apos;][&apos;OBX.15.6&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].producersId.altCodingSystem = obxSeg[&apos;OBX.15&apos;][&apos;OBX.15.6&apos;].toString(); }
				if (Object.keys(txa[index].OBX[indexOBX].producersId).length == 0) {
					delete txa[index].OBX[indexOBX].producersId;
				}

				// OBX.16, responsibleObserver
				txa[index].OBX[indexOBX].responsibleObserver = {};
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.id = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.1&apos;].toString(); }
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.2&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.lastName = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.2&apos;].toString(); }
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.3&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.firstName = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.3&apos;].toString(); }
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.4&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.middleInitOrName = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.4&apos;].toString(); }
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.5&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.suffix = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.5&apos;].toString(); }
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.6&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.prefix = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.6&apos;].toString(); }
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.7&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.degree = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.7&apos;].toString(); }
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.8&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.sourceTable = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.8&apos;].toString(); }
				txa[index].OBX[indexOBX].responsibleObserver.assigningAuthority = {};
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.9&apos;][&apos;OBX.16.9.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.assigningAuthority.id = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.9&apos;][&apos;OBX.16.9.1&apos;].toString(); }
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.9&apos;][&apos;OBX.16.9.2&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.assigningAuthority.universalId = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.9&apos;][&apos;OBX.16.9.2&apos;].toString(); }
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.9&apos;][&apos;OBX.16.9.3&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.assigningAuthority.universalIdType = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.9&apos;][&apos;OBX.16.9.3&apos;].toString(); }
				if (Object.keys(txa[index].OBX[indexOBX].responsibleObserver.assigningAuthority).length == 0) {
					if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.9&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.assigningAuthority.id = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.9&apos;].toString(); }
					else delete txa[index].OBX[indexOBX].responsibleObserver.assigningAuthority;
				}
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.10&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.nameTypeCode = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.10&apos;].toString(); }
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.11&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.identifierCheckDigit = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.11&apos;].toString(); }
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.12&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.codeIdentifyingCheckDigitScheme = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.12&apos;].toString(); }
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.13&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.identifierTypeCode = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.13&apos;].toString(); }
				txa[index].OBX[indexOBX].responsibleObserver.assigningFacility = {};
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.14&apos;][&apos;OBX.16.14.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.assigningFacility.id = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.14&apos;][&apos;OBX.16.14.1&apos;].toString(); }
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.14&apos;][&apos;OBX.16.14.2&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.assigningFacility.universalId = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.14&apos;][&apos;OBX.16.14.2&apos;].toString(); }
				if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.14&apos;][&apos;OBX.16.14.3&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.assigningFacility.universalIdType = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.14&apos;][&apos;OBX.16.14.3&apos;].toString(); }
				if (Object.keys(txa[index].OBX[indexOBX].responsibleObserver.assigningFacility).length == 0) {
					if (obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.14&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].responsibleObserver.assigningFacility.id = obxSeg[&apos;OBX.16&apos;][&apos;OBX.16.14&apos;].toString(); }
					else delete txa[index].OBX[indexOBX].responsibleObserver.assigningFacility;
				}
				if (Object.keys(txa[index].OBX[indexOBX].responsibleObserver).length == 0) {
					delete txa[index].OBX[indexOBX].responsibleObserver;
				}

				// OBX.17, observationMethod
				txa[index].OBX[indexOBX].observationMethod = [];
				for each (field in obxSeg[&apos;OBX.17&apos;]) {
					var block = {};
					if (field[&apos;OBX.17.1&apos;].toString() != &quot;&quot;) { block.id = field[&apos;OBX.17.1&apos;].toString(); }
					if (field[&apos;OBX.17.2&apos;].toString() != &quot;&quot;) { block.text = field[&apos;OBX.17.2&apos;].toString(); }
					if (field[&apos;OBX.17.3&apos;].toString() != &quot;&quot;) { block.codingSystem = field[&apos;OBX.17.3&apos;].toString(); }
					if (field[&apos;OBX.17.4&apos;].toString() != &quot;&quot;) { block.altId = field[&apos;OBX.17.4&apos;].toString(); }
					if (field[&apos;OBX.17.5&apos;].toString() != &quot;&quot;) { block.altText = field[&apos;OBX.17.5&apos;].toString(); }
					if (field[&apos;OBX.17.6&apos;].toString() != &quot;&quot;) { block.altCodingSystem = field[&apos;OBX.17.6&apos;].toString(); }
					if (Object.keys(block).length &gt; 0) {
						txa[index].OBX[indexOBX].observationMethod.push(block);
					}
				}
				if (txa[index].OBX[indexOBX].observationMethod.length == 0) {
					delete txa[index].OBX[indexOBX].observationMethod;
				}

				// NTE (OBX)
				var nteGroup = getSegmentsAfter(msg,obxSeg,&apos;NTE&apos;,true);
				if (nteGroup.length &gt; 0) {
					txa[index].OBX[indexOBX].NTE = [];
					var indexNTE = 0;
					for each (nteSeg in nteGroup) {
						txa[index].OBX[indexOBX].NTE[indexNTE] = {};

						// NTE.1, setId
						if (nteSeg[&apos;NTE.1&apos;][&apos;NTE.1.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].NTE[indexNTE].setId = nteSeg[&apos;NTE.1&apos;][&apos;NTE.1.1&apos;].toString(); }

						// NTE.2, sourceOfComment
						if (nteSeg[&apos;NTE.2&apos;][&apos;NTE.2.1&apos;].toString() != &quot;&quot;) { txa[index].OBX[indexOBX].NTE[indexNTE].sourceOfComment = nteSeg[&apos;NTE.2&apos;][&apos;NTE.2.1&apos;].toString(); }

						// NTE.3, comment
						txa[index].OBX[indexOBX].NTE[indexNTE].comment = [];
						for each (field in nteSeg[&apos;NTE.3&apos;]) {
							var block = {};
							if (field[&apos;NTE.3.1&apos;].toString() != &quot;&quot;) { 
								txa[index].OBX[indexOBX].NTE[indexNTE].comment.push(field[&apos;NTE.3.1&apos;].toString());
							}
						}
						if (txa[index].OBX[indexOBX].NTE[indexNTE].comment.length == 0) {
							delete txa[index].OBX[indexOBX].NTE[indexNTE].comment;
						}

						// clean up NTE and increment index
						if (txa[index].OBX[indexOBX].NTE.length == 0) {
							delete txa[index].OBX[indexOBX].NTE;
						} else {
							indexNTE++;
						}
					}
				}

				// clean up OBX and increment index
				if (Object.keys(txa[index].OBX[indexOBX]).length == 0) {
					delete txa[index].OBX[indexOBX];
				} else {
					indexOBX++;
				}
	    	}
	    }

	    // clean up TXA and increment index
	    if (Object.keys(txa[index]).length == 0) {
			delete txa[index];
		} else {
			index++;
		}
	}
}

// Optional: save a copy of the completed TXA segment for reference later
//channelMap.put(&quot;txa&quot;, txa); // uncomment to save

// If it has content, add the TXA segment to the hl7JSON object
if (txa &amp;&amp; Object.keys(txa).length != 0) {
	var hl7JSON = JSON.parse($(&apos;hl7JSON&apos;));
	hl7JSON.content.TXA = txa;
	channelMap.put(&quot;hl7JSON&quot;, JSON.stringify(hl7JSON));
}</script>
        </com.mirth.connect.plugins.javascriptstep.JavaScriptStep>
      </elements>
      <inboundTemplate encoding="base64"></inboundTemplate>
      <outboundTemplate encoding="base64"></outboundTemplate>
      <inboundDataType>HL7V2</inboundDataType>
      <outboundDataType>HL7V2</outboundDataType>
      <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.8.1">
        <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.8.1">
          <handleRepetitions>true</handleRepetitions>
          <handleSubcomponents>true</handleSubcomponents>
          <useStrictParser>false</useStrictParser>
          <useStrictValidation>false</useStrictValidation>
          <stripNamespaces>true</stripNamespaces>
          <segmentDelimiter>\r</segmentDelimiter>
          <convertLineBreaks>true</convertLineBreaks>
        </serializationProperties>
        <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.8.1">
          <useStrictParser>false</useStrictParser>
          <useStrictValidation>false</useStrictValidation>
          <segmentDelimiter>\r</segmentDelimiter>
        </deserializationProperties>
        <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.8.1">
          <splitType>MSH_Segment</splitType>
          <batchScript></batchScript>
        </batchProperties>
        <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.8.1">
          <segmentDelimiter>\r</segmentDelimiter>
          <successfulACKCode>AA</successfulACKCode>
          <successfulACKMessage></successfulACKMessage>
          <errorACKCode>AE</errorACKCode>
          <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
          <rejectedACKCode>AR</rejectedACKCode>
          <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
          <msh15ACKAccept>false</msh15ACKAccept>
          <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
        </responseGenerationProperties>
        <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.8.1">
          <successfulACKCode>AA,CA</successfulACKCode>
          <errorACKCode>AE,CE</errorACKCode>
          <rejectedACKCode>AR,CR</rejectedACKCode>
          <validateMessageControlId>true</validateMessageControlId>
          <originalMessageControlId>Destination_Encoded</originalMessageControlId>
          <originalIdMapVariable></originalIdMapVariable>
        </responseValidationProperties>
      </inboundProperties>
      <outboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.8.1">
        <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.8.1">
          <handleRepetitions>true</handleRepetitions>
          <handleSubcomponents>true</handleSubcomponents>
          <useStrictParser>false</useStrictParser>
          <useStrictValidation>false</useStrictValidation>
          <stripNamespaces>true</stripNamespaces>
          <segmentDelimiter>\r</segmentDelimiter>
          <convertLineBreaks>true</convertLineBreaks>
        </serializationProperties>
        <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.8.1">
          <useStrictParser>false</useStrictParser>
          <useStrictValidation>false</useStrictValidation>
          <segmentDelimiter>\r</segmentDelimiter>
        </deserializationProperties>
        <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.8.1">
          <splitType>MSH_Segment</splitType>
          <batchScript></batchScript>
        </batchProperties>
        <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.8.1">
          <segmentDelimiter>\r</segmentDelimiter>
          <successfulACKCode>AA</successfulACKCode>
          <successfulACKMessage></successfulACKMessage>
          <errorACKCode>AE</errorACKCode>
          <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
          <rejectedACKCode>AR</rejectedACKCode>
          <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
          <msh15ACKAccept>false</msh15ACKAccept>
          <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
        </responseGenerationProperties>
        <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.8.1">
          <successfulACKCode>AA,CA</successfulACKCode>
          <errorACKCode>AE,CE</errorACKCode>
          <rejectedACKCode>AR,CR</rejectedACKCode>
          <validateMessageControlId>true</validateMessageControlId>
          <originalMessageControlId>Destination_Encoded</originalMessageControlId>
          <originalIdMapVariable></originalIdMapVariable>
        </responseValidationProperties>
      </outboundProperties>
    </transformer>
    <filter version="3.8.1">
      <elements/>
    </filter>
    <transportName>Channel Reader</transportName>
    <mode>SOURCE</mode>
    <enabled>true</enabled>
    <waitForPrevious>true</waitForPrevious>
  </sourceConnector>
  <destinationConnectors>
    <connector version="3.8.1">
      <metaDataId>1</metaDataId>
      <name>Internal Test</name>
      <properties class="com.mirth.connect.connectors.vm.VmDispatcherProperties" version="3.8.1">
        <pluginProperties/>
        <destinationConnectorProperties version="3.8.1">
          <queueEnabled>false</queueEnabled>
          <sendFirst>false</sendFirst>
          <retryIntervalMillis>10000</retryIntervalMillis>
          <regenerateTemplate>false</regenerateTemplate>
          <retryCount>0</retryCount>
          <rotate>false</rotate>
          <includeFilterTransformer>false</includeFilterTransformer>
          <threadCount>1</threadCount>
          <threadAssignmentVariable></threadAssignmentVariable>
          <validateResponse>false</validateResponse>
          <resourceIds class="linked-hash-map">
            <entry>
              <string>Default Resource</string>
              <string>[Default Resource]</string>
            </entry>
          </resourceIds>
          <queueBufferSize>1000</queueBufferSize>
          <reattachAttachments>true</reattachAttachments>
        </destinationConnectorProperties>
        <channelId>none</channelId>
        <channelTemplate>${hl7JSON}</channelTemplate>
        <mapVariables/>
      </properties>
      <transformer version="3.8.1">
        <elements/>
        <inboundDataType>HL7V2</inboundDataType>
        <outboundDataType>JSON</outboundDataType>
        <inboundProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DataTypeProperties" version="3.8.1">
          <serializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2SerializationProperties" version="3.8.1">
            <handleRepetitions>true</handleRepetitions>
            <handleSubcomponents>true</handleSubcomponents>
            <useStrictParser>false</useStrictParser>
            <useStrictValidation>false</useStrictValidation>
            <stripNamespaces>true</stripNamespaces>
            <segmentDelimiter>\r</segmentDelimiter>
            <convertLineBreaks>true</convertLineBreaks>
          </serializationProperties>
          <deserializationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2DeserializationProperties" version="3.8.1">
            <useStrictParser>false</useStrictParser>
            <useStrictValidation>false</useStrictValidation>
            <segmentDelimiter>\r</segmentDelimiter>
          </deserializationProperties>
          <batchProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2BatchProperties" version="3.8.1">
            <splitType>MSH_Segment</splitType>
            <batchScript></batchScript>
          </batchProperties>
          <responseGenerationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseGenerationProperties" version="3.8.1">
            <segmentDelimiter>\r</segmentDelimiter>
            <successfulACKCode>AA</successfulACKCode>
            <successfulACKMessage></successfulACKMessage>
            <errorACKCode>AE</errorACKCode>
            <errorACKMessage>An Error Occurred Processing Message.</errorACKMessage>
            <rejectedACKCode>AR</rejectedACKCode>
            <rejectedACKMessage>Message Rejected.</rejectedACKMessage>
            <msh15ACKAccept>false</msh15ACKAccept>
            <dateFormat>yyyyMMddHHmmss.SSS</dateFormat>
          </responseGenerationProperties>
          <responseValidationProperties class="com.mirth.connect.plugins.datatypes.hl7v2.HL7v2ResponseValidationProperties" version="3.8.1">
            <successfulACKCode>AA,CA</successfulACKCode>
            <errorACKCode>AE,CE</errorACKCode>
            <rejectedACKCode>AR,CR</rejectedACKCode>
            <validateMessageControlId>true</validateMessageControlId>
            <originalMessageControlId>Destination_Encoded</originalMessageControlId>
            <originalIdMapVariable></originalIdMapVariable>
          </responseValidationProperties>
        </inboundProperties>
        <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.8.1">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.8.1">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </outboundProperties>
      </transformer>
      <responseTransformer version="3.8.1">
        <elements/>
        <inboundDataType>JSON</inboundDataType>
        <outboundDataType>JSON</outboundDataType>
        <inboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.8.1">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.8.1">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </inboundProperties>
        <outboundProperties class="com.mirth.connect.plugins.datatypes.json.JSONDataTypeProperties" version="3.8.1">
          <batchProperties class="com.mirth.connect.plugins.datatypes.json.JSONBatchProperties" version="3.8.1">
            <splitType>JavaScript</splitType>
            <batchScript></batchScript>
          </batchProperties>
        </outboundProperties>
      </responseTransformer>
      <filter version="3.8.1">
        <elements/>
      </filter>
      <transportName>Channel Writer</transportName>
      <mode>DESTINATION</mode>
      <enabled>true</enabled>
      <waitForPrevious>true</waitForPrevious>
    </connector>
  </destinationConnectors>
  <preprocessingScript>// Modify the message variable below to pre process data
return message;</preprocessingScript>
  <postprocessingScript>// This script executes once after a message has been processed
// Responses returned from here will be stored as &quot;Postprocessor&quot; in the response map
return;</postprocessingScript>
  <deployScript>// This script executes once when the channel is deployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</deployScript>
  <undeployScript>// This script executes once when the channel is undeployed
// You only have access to the globalMap and globalChannelMap here to persist data
return;</undeployScript>
  <properties version="3.8.1">
    <clearGlobalChannelMap>true</clearGlobalChannelMap>
    <messageStorageMode>DEVELOPMENT</messageStorageMode>
    <encryptData>false</encryptData>
    <removeContentOnCompletion>false</removeContentOnCompletion>
    <removeOnlyFilteredOnCompletion>false</removeOnlyFilteredOnCompletion>
    <removeAttachmentsOnCompletion>false</removeAttachmentsOnCompletion>
    <initialState>STARTED</initialState>
    <storeAttachments>false</storeAttachments>
    <metaDataColumns>
      <metaDataColumn>
        <name>SOURCE</name>
        <type>STRING</type>
        <mappingName>mirth_source</mappingName>
      </metaDataColumn>
      <metaDataColumn>
        <name>TYPE</name>
        <type>STRING</type>
        <mappingName>mirth_type</mappingName>
      </metaDataColumn>
    </metaDataColumns>
    <attachmentProperties version="3.8.1">
      <type>None</type>
      <properties/>
    </attachmentProperties>
    <resourceIds class="linked-hash-map">
      <entry>
        <string>Default Resource</string>
        <string>[Default Resource]</string>
      </entry>
    </resourceIds>
  </properties>
  <exportData>
    <metadata>
      <enabled>true</enabled>
      <lastModified>
        <time>1594332968516</time>
        <timezone>America/New_York</timezone>
      </lastModified>
      <pruningSettings>
        <archiveEnabled>true</archiveEnabled>
      </pruningSettings>
    </metadata>
    <codeTemplateLibraries>
      <codeTemplateLibrary version="3.8.1">
        <id>10e63131-3e24-4419-a268-ed823aba5790</id>
        <name>Datica Mirth OCI Code Template Library</name>
        <revision>29</revision>
        <lastModified>
          <time>1585663992236</time>
          <timezone>America/New_York</timezone>
        </lastModified>
        <description>This library contains code templates used by the Datica Mirth OCI channels</description>
        <includeNewChannels>true</includeNewChannels>
        <enabledChannelIds>
          <string>bb4528ac-8494-4b62-910e-dd83405c5dcf</string>
          <string>b8f0675d-97b0-41cd-bf75-a5069619e56b</string>
          <string>0caeca6e-94be-43d9-8278-0e63ea0480aa</string>
          <string>c954025a-7c8c-41f4-93f7-94893ee4003f</string>
          <string>3d22b49b-80aa-4550-aada-859d17216a81</string>
          <string>647fa65c-d0bb-4f32-a1f6-b218136ebdb8</string>
          <string>2b94012d-e828-4781-bbb8-a74211c9f3c3</string>
          <string>44ade9e2-d2ec-40f0-99cd-c2518f1aef0a</string>
          <string>1865908a-ac4d-46df-95a9-dc8788ed6f32</string>
          <string>2edfb44b-d53e-43c0-9cee-dfb8c5d28c80</string>
          <string>5c34ea76-16d6-4efd-904d-dae51791a451</string>
          <string>1b589f0e-fe63-4f2c-8cfb-749e73a7ec51</string>
          <string>12832ab3-cdac-485f-bf81-4c525359af88</string>
          <string>6f76aab4-3623-446c-8f29-19cd819a338b</string>
          <string>6546423b-30d4-46dc-92d7-3e651a542a42</string>
          <string>9ea79100-6511-40d5-8c58-893889f99d7b</string>
          <string>6a27e181-4776-46d7-b862-5cc4968ec8e7</string>
          <string>0d1bb633-29b1-4b89-983c-0fb4300f66e2</string>
          <string>4132ab48-24e7-4bdb-a7b5-b2b649ca3b73</string>
          <string>f40fdfb2-0d49-45e3-bc66-d4c263adef2d</string>
          <string>b150fdc2-ff19-4c5a-ab63-77e69a4ce761</string>
          <string>61fa63b6-3abd-44f1-9dd9-b338e55e2c29</string>
          <string>c85d92ce-701c-4f13-8a87-39b885bf9757</string>
          <string>2e070b65-6cd7-4408-b7de-ca903b46d589</string>
          <string>515eb748-bcc9-4b46-a086-be3174f3df41</string>
          <string>6044f941-f0ac-428d-bdf3-723a67bae513</string>
          <string>1192bb86-1f4d-4ca0-9343-e1b87d790154</string>
          <string>e252f43b-9fdd-400a-ba69-995e19a25de1</string>
          <string>0d245f0f-1239-46cb-96db-b6c03ee91b18</string>
          <string>2a9a3006-7c3c-4173-ac08-5e772f700113</string>
          <string>f6ba16ce-08cf-499f-8dac-143646aadd51</string>
          <string>45e134f2-5495-49b8-b86e-1d0cb95063a7</string>
        </enabledChannelIds>
        <disabledChannelIds>
          <string>8b69b2e3-4cb0-40f9-93e4-b56c33ba112d</string>
          <string>03fbd8a8-0215-47fb-8077-bdfea025f8be</string>
          <string>3a0d6cc3-aa81-405f-9030-9e6f1aaede1e</string>
          <string>e7c2be6b-fba1-4fa6-8960-0fe4e997b5bd</string>
          <string>7fa5ee0f-5da8-4460-b9b9-9ad791096261</string>
          <string>52e9904e-a3ec-44fa-ae8a-d660a6e10a42</string>
          <string>4c14f245-2cd7-4e51-9401-6a941fa948f5</string>
          <string>7a7a1307-a695-490f-9755-46ada428c159</string>
          <string>4108bf57-50de-4347-8719-64f582334aa0</string>
          <string>638e0505-abd0-405d-8422-8b6e0e84e238</string>
          <string>9ff5bb6e-6c76-4b3a-9e87-033a11dad4f6</string>
          <string>27b614a4-fbd6-41bc-b37f-d9454a0b73eb</string>
          <string>8f7a81c6-ab97-4335-b731-f3d2c715cada</string>
          <string>a605c468-d34f-4966-9c18-db8ce72e023f</string>
          <string>ab4e0274-be44-444a-8530-c08ae238cd93</string>
          <string>9391bf69-d2f7-4085-bff0-723ef11a9df5</string>
          <string>053386c8-3182-4620-bc1b-9d3974d34be8</string>
          <string>4b7b461d-8246-4797-a8f3-06f07d9efee4</string>
          <string>76e2dd55-419b-4f78-8cb4-b8eb687499f5</string>
          <string>866fbd5b-63a2-4211-b13f-dabd5601de7c</string>
          <string>184f26f3-f72c-4208-a66e-6ff4b78d0d98</string>
          <string>689629e8-f3d1-4ded-b2e8-b28264f74da6</string>
          <string>479ca566-d489-4f92-ac92-6bb019eecd27</string>
          <string>dce6c65a-511c-4d06-909e-6e9553281842</string>
          <string>651d65e5-1460-44d9-8b9d-ee983797f36e</string>
          <string>424319ec-4d06-44ae-b395-b0e0e3c161e5</string>
          <string>b9e4ec1b-3666-4a7c-a6e5-d44bf4acb58b</string>
          <string>423968eb-01ad-465f-891a-250444e65d13</string>
          <string>fc6b053f-f078-477d-b317-e55aa12e8d1a</string>
          <string>3076fe92-da8c-46f1-b162-4498433c82c3</string>
          <string>0a73e2f2-ef41-4e08-afde-3f0a445106eb</string>
          <string>06f51744-9fe3-4c9c-a100-0497fc79a5b1</string>
          <string>14fd925a-eaab-457c-9d8b-18803350fb1a</string>
          <string>ae2cac45-d0d6-404f-9530-3fc44e2369cc</string>
          <string>6a029d79-d96f-4437-b9ef-10b2f345dd5d</string>
          <string>4da26cfa-8b26-4353-9928-f33f024bc8a6</string>
          <string>217689ee-ddf7-4085-9261-3e030e95293a</string>
          <string>a20be57d-4b14-4932-88fd-b3264b444fdf</string>
          <string>3dde045a-c514-4cd7-b6d5-5576155177d5</string>
          <string>a99f3b5a-07f0-400d-ae09-c195cf2a59c5</string>
          <string>70d1e94a-bc04-413e-8510-f534075deb79</string>
          <string>f2231b87-3c49-498a-962d-03503bc04147</string>
          <string>6d5edbe0-3c33-4a60-b78b-08e32afdb880</string>
          <string>af777014-3696-4fad-8f98-293e7d65a90c</string>
          <string>17f3958e-1207-47ba-aab9-5aab3ef15476</string>
          <string>8729b803-b38a-46f6-be11-5169facc2632</string>
          <string>015db3f7-825c-484e-86b2-33b9e79b727c</string>
          <string>2a032710-3d63-450a-b0bf-c0099bb29aab</string>
          <string>4bf5438f-232a-487a-9581-c796f605654d</string>
          <string>60254522-dc8c-43d6-bb41-ac66897c0d43</string>
          <string>1f7adc36-6fa0-47f3-9228-d55c8a988ac0</string>
          <string>5c88d795-4958-4147-b151-b84111a83d89</string>
          <string>d94f8c71-b05b-4446-813d-be17058a6480</string>
          <string>a48610e7-1f18-467b-bb69-b3ac5c2b8c04</string>
          <string>29361ad8-00dc-45c7-ab61-7b2e07023969</string>
          <string>f893da87-8e5f-48b8-9280-c384ff3bcc99</string>
          <string>83eb8d17-1892-4bfd-b19b-e28e0ca03b69</string>
          <string>1d2d8815-0962-4986-b731-b1f49a733db8</string>
          <string>ab1f0813-77a3-4b4e-90be-a472e999a047</string>
          <string>07b13575-8803-4340-92e8-40bc9f160fc8</string>
          <string>6f4013b1-cbc4-412b-9984-2204fe7746da</string>
          <string>660f2bb8-3471-47a4-9299-98a985017333</string>
          <string>30573bec-3215-4dc8-becb-091ab5485be0</string>
          <string>46214349-f697-4c7b-8d26-44fd409efc53</string>
          <string>f6b6cbe4-cdca-42f0-ac74-dfa7e49a27c6</string>
          <string>abf6afe4-de93-44e8-b59c-1c967d045b38</string>
          <string>9966294e-7c31-4f52-9d2f-2fd705e583a9</string>
          <string>f1246189-09ae-4ecb-b73e-35d9d4a21876</string>
          <string>e00c4162-2e90-440a-8e99-1543a0d8472d</string>
          <string>0fa23c6d-b057-44bc-a4b3-f4019fea0c5e</string>
          <string>9901adbe-50a3-431f-8b18-b93375093c6f</string>
          <string>c43b6a54-5476-4eb7-82c7-b741009c4031</string>
          <string>3c90fc7c-1aa1-4381-83a1-116e3e6bdd61</string>
          <string>f590b560-ca56-45de-8716-1432f7b6efc5</string>
          <string>a7091b52-5045-47d3-84ae-e5a6579e2943</string>
          <string>aa0e5130-6ffd-4960-a1f4-a9cefd1af050</string>
          <string>3511e706-3d3c-4174-a65f-0905688e9f22</string>
          <string>9977e3d2-2184-4e4f-8815-f9b42830dd51</string>
          <string>3fc61612-3fc3-4a64-b42f-2975a71f66b7</string>
          <string>f47f2edc-2a29-4fc4-9de6-a9efa9fcbb38</string>
          <string>f1b9e55e-698d-4d5a-a6fd-d8bc75f7251f</string>
          <string>b1e2fe6b-4991-40ff-a9f4-4ce5abed0109</string>
          <string>6c07f763-a93a-47ae-a1d8-2580fc0f5ccc</string>
          <string>c8f5ba67-7d41-4abf-b4f5-dd122b441f36</string>
          <string>2dcc02c1-0e50-44e2-aa63-46b5bbb6d31c</string>
          <string>698bc4ea-c9c7-4af3-9cbc-0ae9f27665bd</string>
          <string>20ebe877-0a55-4589-8daa-bbc66f8c1746</string>
          <string>104680bd-a293-4edc-a33a-ecfeec069da5</string>
          <string>99beb09b-6d76-4fc1-aa07-8e53472b7036</string>
          <string>782cfee5-4ca6-49c3-ae7f-dd76a5e4df48</string>
          <string>d0b3a0e3-01ff-4ce5-a4a7-748c7413e51f</string>
          <string>20b589b6-4167-4f8d-b8ab-242f62a28452</string>
          <string>993fe87c-697f-4259-b59f-ebd7e3913ac8</string>
          <string>640344b6-2d0e-4858-bd43-ef58d9329f75</string>
          <string>93aa0bb7-a3e4-488d-98ec-d14ba49d1c9c</string>
          <string>d51e8dea-3e2a-49d4-9475-21db46ed1559</string>
          <string>c67da354-57e3-401f-b684-2190b92335ac</string>
          <string>4ad918f5-1323-44a9-b3ec-fce83e062b9d</string>
          <string>b4c20126-17c5-4c11-a76e-7fa2aaf94cbe</string>
          <string>220aeb9b-3050-43ff-bd41-7e38cec5010e</string>
          <string>e8667ddb-063e-48cf-a163-f2d50944296b</string>
          <string>2de6bc63-2d0c-4891-8662-05331cdbc135</string>
          <string>e340c788-a921-4bab-92d9-ff8e0a640575</string>
          <string>7223dcc0-41c9-4cba-872f-3cb8ca724ea3</string>
          <string>a74ae7d3-b6c3-49b5-840f-0aafbac3fa6b</string>
          <string>b92f73d2-fb74-4a63-bec5-c8464bc22653</string>
          <string>b340b685-f8f8-4df2-a03e-82efe8d9afcf</string>
          <string>a8454dfe-aa8e-469f-a5bc-fe30fd3d3033</string>
          <string>ef90d21a-b975-45f9-8426-83de2de99188</string>
          <string>fd282052-cae0-4b01-9f4a-2a68f8d4fd8a</string>
          <string>cadedffd-7184-4c62-9ed9-5cf36ccb32b8</string>
          <string>98d6cd83-c049-44d8-ad48-1c44d95ce6f2</string>
          <string>fc7fa005-2346-4dc2-9fb2-faaa090c556f</string>
          <string>1045246c-704d-445d-8733-86aa16205994</string>
          <string>0d6774d6-8663-4513-8a78-fea5ebe69bbc</string>
          <string>b56f9561-3659-4e4d-a03c-723b2daf9f49</string>
          <string>6548b06b-0e02-4375-8749-b61e5a016ed2</string>
          <string>76656822-9750-4ba0-8b42-8efc01f75230</string>
          <string>1cb576e1-6c80-457b-a7d7-9406113157a3</string>
          <string>86e5d119-ef36-4eb6-852e-701228076b51</string>
          <string>748de96b-9101-47d0-88aa-c18344c194ca</string>
          <string>6704e9fc-7f6f-4e67-bfd4-527ba1a8b186</string>
          <string>749d6b73-ced6-4638-a7ad-4049c811a35c</string>
          <string>412610bb-4ac3-4229-8929-f7969018a9dd</string>
          <string>04ef8a88-576f-42ab-a637-5383776a0b60</string>
          <string>8cfa82cc-ee8a-428a-9fff-e32b2439b9c8</string>
          <string>6d6a6667-6c83-476a-a0f6-dd8d524dd887</string>
          <string>fbd5a175-ad41-44f6-95d3-bd898a3f3fb8</string>
          <string>a6bb0a27-6db8-4218-9478-a1600bae3a7b</string>
          <string>2d2c762c-2f17-482e-af65-1b979c758250</string>
          <string>1a7d6d5f-97a9-4e77-80eb-cfb94fa445c6</string>
          <string>4dcf348b-f385-4889-8e10-580092be907f</string>
          <string>ab7f86cd-94ff-4237-bef9-3e45057821ba</string>
          <string>fd891108-6b82-4ca9-a0ac-0d163926ae0a</string>
          <string>bc5b7a3d-b86d-48d1-81fd-a5f92303defb</string>
          <string>4c9b4da2-faf1-45b3-9cdf-bec2f81bf308</string>
          <string>55de7d91-8e2e-473b-9ca1-09aa47254a75</string>
          <string>add3dd62-61ff-4c63-a4a5-59b97c22c830</string>
          <string>ce9ebf65-8647-46bb-83aa-f1acb687c877</string>
        </disabledChannelIds>
        <codeTemplates>
          <codeTemplate version="3.8.1">
            <id>b9651842-7ccb-4761-aedf-a9a1461dd5f7</id>
            <name>Convert HL7 Date Format to ISO</name>
            <revision>2</revision>
            <lastModified>
              <time>1508796641140</time>
              <timezone>America/New_York</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	Converts standard HL7 v2.x date format to human-readable ISO date format
*/

/*
	Author: Datica Inc.
	toISODate: Returns an ISO-formatted date string with specified timezone offset

	Arguments
	---------
		Required
		--------
			hl7DateString:		An HL7-formatted date string (ex: &quot;yyyyMMddHHmmss&quot;

		Optional
		--------
			timezome:			A timezone identifier string corresponding to one of the java.util.TimeZone values (ex: &quot;US/Central&quot;)
*/

function toISODate( hl7DateString, timezone ) {
	var isoDate;
	var dateString;
	var hl7Formatter;
	var isoFormatter = new Packages.java.text.SimpleDateFormat(&quot;yyyy-MM-dd&apos;T&apos;HH:mm:ssZ&quot;);

	if (timezone) {
		isoFormatter.setTimeZone(Packages.java.util.TimeZone.getTimeZone(timezone));
	}
	
	if ( hl7DateString != null &amp;&amp; !isNaN(hl7DateString.substring(0,13)) &amp;&amp; hl7DateString.length &gt; 14 ) {
		hl7Formatter = new Packages.java.text.SimpleDateFormat(&quot;yyyyMMddHHmmssZ&quot;);
	}
	else if ( hl7DateString != null &amp;&amp; !isNaN(hl7DateString) &amp;&amp; hl7DateString &gt; 0 &amp;&amp; hl7DateString.length == 14 ) {
		hl7Formatter = new Packages.java.text.SimpleDateFormat(&quot;yyyyMMddHHmmss&quot;);
	} 
	else if ( hl7DateString != null &amp;&amp; !isNaN(hl7DateString) &amp;&amp; hl7DateString &gt; 0 &amp;&amp; hl7DateString.length == 12 ) {
		hl7Formatter = new Packages.java.text.SimpleDateFormat(&quot;yyyyMMddHHmm&quot;);
	} 
	else if ( hl7DateString != null &amp;&amp; !isNaN(hl7DateString) &amp;&amp; hl7DateString &gt; 0 &amp;&amp; hl7DateString.length == 8 ) {
		hl7Formatter = new Packages.java.text.SimpleDateFormat(&quot;yyyyMMdd&quot;);
	} 
	else dateString = hl7DateString;
	
	try {
		if (hl7Formatter) {
			isoDate = hl7Formatter.parse(hl7DateString);
			isoDate = isoFormatter.format(isoDate);
			dateString = new String(isoDate);
		}
	} catch (err) {
		dateString = hl7DateString;
	} finally {
		return dateString;
	}
}</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="3.8.1">
            <id>95e528b7-1e7f-490e-86da-7c14b23ee4f3</id>
            <name>Convert ISO Date Format to HL7</name>
            <revision>2</revision>
            <lastModified>
              <time>1508796641299</time>
              <timezone>America/New_York</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	Converts ISO date format to HL7 v2 format
*/

/*
	Author: Datica Inc.
	toHL7Date: Returns an HL7-formatted date string with specified timezone offset

	Arguments
	---------
		Required
		--------
			isoDateString:		An ISO-formatted date string (ex: &quot;yyyy-MM-ddTHH:mm:ssZ&quot;

		Optional
		--------
			timezome:			A timezone identifier string corresponding to one of the java.util.TimeZone values (ex: &quot;US/Central&quot;)
*/

function toHL7Date( isoDateString, timezone ) 
{
	var hl7Date;
	var dateString;
	var isoFormatter;
	var hl7Formatter;

	// ISO Date Format: yyyy-MM-dd&apos;T&apos;HH:mm:ss&apos;Z&apos;
	if ( isoDateString != null &amp;&amp; isoDateString.length &lt;= 25 &amp;&amp; isoDateString.length &gt;= 22) {
		isoFormatter = new Packages.java.text.SimpleDateFormat(&quot;yyyy-MM-dd&apos;T&apos;HH:mm:ssZ&quot;);
		hl7Formatter = new Packages.java.text.SimpleDateFormat(&quot;yyyyMMddHHmmssZ&quot;);
		if (timezone) {
			hl7Formatter.setTimeZone(Packages.java.util.TimeZone.getTimeZone(timezone));
		}
	}
	// ISO Date Format: yyyy-MM-dd HH:mm:ss
	else if ( isoDateString != null &amp;&amp; isoDateString.length == 19 ) {
		isoFormatter = new Packages.java.text.SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);
		hl7Formatter = new Packages.java.text.SimpleDateFormat(&quot;yyyyMMddHHmmss&quot;);
	}
	// ISO Date Format: yyyy-MM-dd HH:mm
	else if ( isoDateString != null &amp;&amp; isoDateString.length == 16 ) {
		isoFormatter = new Packages.java.text.SimpleDateFormat(&quot;yyyy-MM-dd HH:mm&quot;);
		hl7Formatter = new Packages.java.text.SimpleDateFormat(&quot;yyyyMMddHHmm&quot;);	
	} 
	// ISO Date Format: yyyy-MM-dd
	else if ( isoDateString != null &amp;&amp; isoDateString.length == 10 ) {
		isoFormatter = new Packages.java.text.SimpleDateFormat(&quot;yyyy-MM-dd&quot;);
		hl7Formatter = new Packages.java.text.SimpleDateFormat(&quot;yyyyMMdd&quot;);	
	}
	// None of the above, return original date string.
	else dateString = isoDateString;

	try {
		if (isoFormatter) {
			hl7Date = isoFormatter.parse(isoDateString);
			hl7Date = hl7Formatter.format(hl7Date);
			dateString = new String(hl7Date);
		}
	} catch (err) {
		dateString = isoDateString;
	} finally {
		return dateString;
	}
}</code>
            </properties>
          </codeTemplate>
          <codeTemplate version="3.8.1">
            <id>4cb42e06-7c9a-4fd2-bcb5-b9f4053a9c19</id>
            <name>Get Segments After a Particular Segment</name>
            <revision>1</revision>
            <lastModified>
              <time>1508796287930</time>
              <timezone>America/New_York</timezone>
            </lastModified>
            <contextSet>
              <delegate>
                <contextType>DESTINATION_FILTER_TRANSFORMER</contextType>
                <contextType>DESTINATION_RESPONSE_TRANSFORMER</contextType>
                <contextType>SOURCE_RECEIVER</contextType>
                <contextType>DESTINATION_DISPATCHER</contextType>
                <contextType>SOURCE_FILTER_TRANSFORMER</contextType>
              </delegate>
            </contextSet>
            <properties class="com.mirth.connect.model.codetemplates.BasicCodeTemplateProperties">
              <type>FUNCTION</type>
              <code>/**
	Returns an array of segments with the specified name that come after a given segment in the message.
*/
/*
	Author: Nick Rupley
	Date Modified: 2/13/2013
	getSegmentsAfter: Returns an array of segments with the specified name that come after a given segment in the message.

	Arguments
	---------
		Required
		--------
			root:			The root HL7Message node of the message, or the parent of the segment node.
			startSeg:		The segment AFTER which to start collecting segments.
			segName:		The name (String or RegExp) of the segments you want to collect.

		Optional
		--------
			consecutiveInd:	If true, indicates that the segments are expected to come directly after startSeg. 
							If false, segments are collected until another segment with the same name as startSeg is encountered.
							Defaults to false.
			stopSegNames:	An array of segment names that, when encountered, stop the collection of segments.
*/

function getSegmentsAfter(root, startSeg, segName, consecutiveInd, stopSegNames) {
	function test(str) {
		return segName instanceof RegExp ? segName.test(str) : segName === str;
	}

	// The index to start collection is the next one up from the starting segment
	var index = startSeg.childIndex()+1;
	// The return array
	var out = [];
	// Boolean placeholder to stop iteration
	var done = false;
	// Object that will contain all of the stopSegNames strings, bound to a truthy value (1)
	var stopNames = {};
	// Indicates whether we have any stop segments
	var stopNamesInd = false;
	// If stopSegNames is defined
	if (stopSegNames !== undefined &amp;&amp; stopSegNames !== null) {
		// Set our indicator to true
		stopNamesInd = true;
		// Add each string in the array to our object
		for each (name in stopSegNames)
			stopNames[name] = 1;
	}

	// Iterate through each child in the root, starting at the segment after startSeg, and
	// ending at the final segment, or when the done flag is set to true.
	while (index &lt; root.children().length() &amp;&amp; !done) {
		// If a stop segment is encountered, stop iteration
		if (stopNamesInd &amp;&amp; root.children()[index].name().toString() in stopNames)
			done = true;
		// If a segment with the same name as startSeg is encountered, stop iteration
		else if (root.children()[index].name().toString() == startSeg.name().toString() &amp;&amp; !consecutiveInd)
			done = true;
		// If we&apos;re only collecting consecutive segments and we encounter a segment with a name other than segName, stop iteration
		else if (!test(root.children()[index].name().toString()) &amp;&amp; consecutiveInd)
			done = true;
		// If all previous tests passed, and the current segment has a name of segName, then add it to our array
		else if (test(root.children()[index].name().toString()))
			out.push(root.children()[index]);
		// Increment our index counter
		index++;
	}

	// Return the output array
	return out;
}</code>
            </properties>
          </codeTemplate>
        </codeTemplates>
      </codeTemplateLibrary>
    </codeTemplateLibraries>
  </exportData>
</channel>